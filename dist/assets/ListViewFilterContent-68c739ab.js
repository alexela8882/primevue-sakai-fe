import{r as g,B as ae,a3 as te,s as A,E as de,G as ie,c as y,o as s,d as b,w as O,g as oe,e as d,t as c,j as v,F as D,k as S,i,m as w,a1 as U,f,I as se,J as ue}from"./index-5970bb5d.js";const ne={class:"relative flex flex-column gap-4 text-600"},re=d("div",null,"Filter by",-1),ve={class:"text-lg text-800"},fe=["onClick"],me={class:"text-lg text-800"},ce={key:0,class:"font-italic"},pe={class:"flex flex-wrap mt-2 text-xs white-space-nowrap"},ye={key:0},be={key:1,class:"flex flex-wrap"},_e={key:0},xe={class:"flex justify-content-between"},ge={class:"filter-by-owner flex flex-column p-3 text-600 gap-3"},ke=d("div",{class:"text-xl text-color-secondary"},"Filter by",-1),Ve={class:"flex flex-column gap-3"},we={class:"flex align-items-center"},Ne=["for"],Fe={class:"flex align-items-center"},Ce=["for"],Oe={class:"flex align-items-center justify-content-end"},he={class:"filter-by-owner flex flex-column p-3 text-600 gap-3"},Me={class:"text-xl font-bold text-color-secondary"},Be={class:"flex flex-column gap-3"},Te={key:0},je={for:"isBool",class:"ml-2"},Le={key:2},$e=d("label",{for:"isNull",class:"ml-2"}," Is Null ",-1),qe={class:"flex justify-content-end gap-2"},Ae={class:"sticky top-0"},Se={__name:"ListViewFilterContent",props:{baseModule:Object,module:Object},emits:["apply-filters"],setup(o,{emit:I}){const E=se(()=>ue(()=>import("./LookupField-a2d1b5c4.js"),["assets/LookupField-a2d1b5c4.js","assets/index-5970bb5d.js","assets/index-40ff91a8.css","assets/LookupField-373edde0.css"])),_=o,P=I,N=g(!1),p=g(!1),h=g(!1),k=g(!1),x=g(!1),F=g(_.module.viewFilters.find(t=>t.isDefault)),e=g({queryType:null,mode:"edit",queryType:F.value.queryType,filters:F.value.filters,data:{mode:"new",uuid:null,field:null,operator:null,value:null,isNull:!1},default:{uuid:null,field:null,operator:null,value:null,isNull:!1}}),M=ae(),B=te(),{_getFieldDetailsById:u}=A(M),{addViewFilter:T}=M,{getPicklist:n}=A(B),{fetchPicklist:z}=B,R=()=>{e.value.data=Object.assign({},e.value.default),e.value.data.mode="new",k.value=!1,x.value=!0},G=(t,l)=>{let r=u.value({fields:_.module.fields,_id:t.field_id}),m=u.value({fields:n.value&&n.value.filter_operators.values,_id:t.operator_id});Object.assign(e.value.data,{uuid:t.uuid,field:r,operator:m,value:t.values,isNull:t.isNull}),e.value.data.mode="edit",k.value=!1,x.value=!0},j=async()=>{p.value=!0;let t=Object.assign({},{uuid:e.value.data.uuid,field_id:e.value.data.field._id,operator_id:e.value.data.operator._id,values:e.value.data.value,isNull:e.value.data.isNull});const l=Object.assign({},{mode:e.value.mode,baseModule:_.baseModule,viewFilter:_.module.viewFilters.find(m=>m.isDefault)._id,type:"filters",data:{mode:e.value.data.mode,queryType:e.value.queryType,filters:t}}),r=await T(l);r&&r.status===200&&(l.data.mode==="new"?J(r.data):H(r.data.filters[0]))},J=t=>{e.value.filters instanceof Array||(e.value.filters=[]),e.value.filters.push(t),x.value=!x.value,p.value=!1},H=t=>{e.value.filters.map(l=>{l.uuid===t.uuid&&Object.assign(l,t)}),p.value=!1},K=()=>{k.value=!0,x.value=!1},C=async t=>{await z(t)},Q=t=>{e.value.data.value=null},W=async()=>{N.value=!0;const t=Object.assign({},{mode:e.value.mode,baseModule:_.baseModule,viewFilter:_.module.viewFilters.find(r=>r.isDefault)._id,type:"filters",data:{queryType:e.value.queryType}}),l=await T(t);l&&l.status===200&&P("apply-filters",F.value),N.value=!1};return de(async()=>{Object.keys(n.value).length===0&&(h.value=!0,C("filter_operators"),h.value=!1),e.value.filters instanceof Array&&e.value.filters.length>0&&e.value.filters.map(t=>{const l=u.value({fields:_.module.fields,_id:t.field_id});C(l.listName)})}),ie(()=>e.value,(t,l)=>{t.data.field&&t.data.field.field_type.name==="picklist"&&C(t.data.field.listName)},{deep:!0}),(t,l)=>{const r=y("RadioButton"),m=y("Button"),L=y("Dropdown"),$=y("Checkbox"),X=y("Calendar"),Y=y("MultiSelect"),Z=y("inputText"),ee=y("Card");return s(),b(ee,{style:{overflow:"hidden"},class:""},{title:O(()=>[oe("Filters")]),content:O(()=>[d("div",null,[d("div",ne,[d("div",{onClick:K,class:"flex flex-column gap-2 p-3 border-1 border-400 hover:border-600 hover:surface-100 border-round-md cursor-pointer"},[re,d("div",ve,c(e.value.queryType),1)]),e.value.filters instanceof Array&&e.value.filters.length>=1?(s(!0),v(D,{key:0},S(e.value.filters,(a,q)=>(s(),v("div",{onClick:V=>G(a,q),key:q,class:"flex flex-column gap-2 p-3 border-1 border-400 hover:border-600 bg-orange-100 hover:bg-orange-200 border-round-md cursor-pointer"},[d("div",null,c(i(u)({fields:o.module.fields,_id:a.field_id}).label),1),d("div",me,[i(n).filter_operators?(s(),v("div",ce,c(i(n).filter_operators.values.find(V=>V._id===a.operator_id).label),1)):w("",!0),d("div",pe,[a.isNull?(s(),v("div",ye," Null ")):(s(),v("div",be,[i(u)({fields:o.module.fields,_id:a.field_id}).field_type.name==="text"||i(u)({fields:o.module.fields,_id:a.field_id}).field_type.name==="boolean"||i(u)({fields:o.module.fields,_id:a.field_id}).field_type.name==="date"?(s(),v("div",_e,c(a.values),1)):i(u)({fields:o.module.fields,_id:a.field_id}).field_type.name==="picklist"||i(u)({fields:o.module.fields,_id:a.field_id}).field_type.name==="lookupModel"?(s(!0),v(D,{key:1},S(a.values,(V,le)=>(s(),v("div",{key:le,severity:"secondary"},[d("div",null,c(i(u)({fields:i(n)[i(u)({fields:o.module.fields,_id:a.field_id}).listName]&&i(n)[i(u)({fields:o.module.fields,_id:a.field_id}).listName].values,_id:V})&&i(u)({fields:i(n)[i(u)({fields:o.module.fields,_id:a.field_id}).listName]&&i(n)[i(u)({fields:o.module.fields,_id:a.field_id}).listName].values,_id:V}).value)+",Â  ",1)]))),128)):w("",!0)]))])])],8,fe))),128)):w("",!0),d("div",xe,[d("a",{onClick:l[0]||(l[0]=a=>R()),href:"javascript:void(0);"},"add filter")])])]),(s(),b(U,{to:`${k.value?".ddt-div-1":".hidden-div"}`},[d("div",ge,[ke,d("div",Ve,[d("div",we,[f(r,{modelValue:e.value.queryType,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.queryType=a),inputId:`All ${o.baseModule.name}`,value:"all"},null,8,["modelValue","inputId"]),d("label",{for:`All ${o.baseModule.name}`,class:"ml-2"},"All "+c(o.baseModule.name),9,Ne)]),d("div",Fe,[f(r,{modelValue:e.value.queryType,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.queryType=a),inputId:`My ${o.baseModule.name}`,value:"owned"},null,8,["modelValue","inputId"]),d("label",{for:`My ${o.baseModule.name}`,class:"ml-2"},"My "+c(o.baseModule.name),9,Ce)]),d("div",Oe,[f(m,{onClick:l[3]||(l[3]=a=>k.value=!1),label:"DONE",outlined:"",size:"large"})])])])],8,["to"])),(s(),b(U,{to:`${x.value?".ddt-div-1":".hidden-div"}`},[d("div",he,[d("div",Me,c(e.value.data.mode=="new"?"Add filter":"Edit filter"),1),d("div",Be,[f(L,{modelValue:e.value.data.field,"onUpdate:modelValue":l[4]||(l[4]=a=>e.value.data.field=a),onChange:l[5]||(l[5]=a=>Q(a)),options:o.module.fields,optionLabel:"label",placeholder:"Select a field",class:"w-full",filter:""},null,8,["modelValue","options"]),f(L,{modelValue:e.value.data.operator,"onUpdate:modelValue":l[6]||(l[6]=a=>e.value.data.operator=a),options:i(n).filter_operators&&i(n).filter_operators.values,optionLabel:"label",placeholder:"Select an operator",class:"w-full"},null,8,["modelValue","options"]),e.value.data.field&&e.value.data.field.field_type.name==="boolean"?(s(),v("div",Te,[f($,{modelValue:e.value.data.value,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.data.value=a),binary:"",variant:"filled",inputId:"isBool",disabled:e.value.data.isNull},null,8,["modelValue","disabled"]),d("label",je,c(e.value.data.value instanceof Array?e.value.data.value[0]:e.value.data.value),1)])):e.value.data.field&&e.value.data.field.field_type.name==="date"?(s(),b(X,{key:1,modelValue:e.value.data.value,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.data.value=a),disabled:e.value.data.isNull},null,8,["modelValue","disabled"])):w("",!0),e.value.data.field&&e.value.data.field.field_type.name==="lookupModel"?(s(),v("div",Le,[f(i(E),{modelValue:e.value.data.value,"onUpdate:modelValue":l[9]||(l[9]=a=>e.value.data.value=a),field:e.value.data.field,keyName:"",formField:!1,inline:!0,module:o.module.name,optionValue:"_id",onLoad:!0,entity:e.value.data.field.entity.name},null,8,["modelValue","field","module","entity"])])):e.value.data.field&&e.value.data.field.field_type.name==="picklist"?(s(),b(Y,{key:3,modelValue:e.value.data.value,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.data.value=a),options:i(n)[e.value.data.field.listName]&&i(n)[e.value.data.field.listName].values,optionLabel:"value",optionValue:"_id",placeholder:"Select",maxSelectedLabels:3,disabled:e.value.data.isNull,class:"w-full"},null,8,["modelValue","options","disabled"])):e.value.data.field&&e.value.data.field.field_type.name==="text"?(s(),b(Z,{key:4,modelValue:e.value.data.value,"onUpdate:modelValue":l[11]||(l[11]=a=>e.value.data.value=a),disabled:e.value.data.isNull},null,8,["modelValue","disabled"])):w("",!0),d("div",null,[f($,{modelValue:e.value.data.isNull,"onUpdate:modelValue":l[12]||(l[12]=a=>e.value.data.isNull=a),binary:"",variant:"filled",inputId:"isNull"},null,8,["modelValue"]),$e])]),d("div",qe,[f(m,{onClick:l[13]||(l[13]=a=>x.value=!1),disabled:p.value,outlined:"",label:"Cancel",severity:"secondary",size:"small"},null,8,["disabled"]),e.value.data.mode==="new"?(s(),b(m,{key:0,onClick:l[14]||(l[14]=a=>j()),disabled:!e.value.data.field||!e.value.data.operator||p.value,loading:p.value,outlined:"",label:"Done",size:"small"},null,8,["disabled","loading"])):(s(),b(m,{key:1,onClick:l[15]||(l[15]=a=>j()),disabled:!e.value.data.field||!e.value.data.operator||p.value,loading:p.value,outlined:"",label:"Update",size:"small"},null,8,["disabled","loading"]))])])],8,["to"]))]),footer:O(()=>[d("div",Ae,[f(m,{onClick:l[16]||(l[16]=a=>W()),loading:N.value,label:"Apply filter",size:"small"},null,8,["loading"])])]),_:1})}}};export{Se as default};
