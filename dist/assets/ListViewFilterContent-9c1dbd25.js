import{r as w,B as Q,a3 as W,s as N,E as X,G as Y,c,o as s,j as v,e as t,f as _,t as m,F as $,k as S,i as o,m as V,d as p,a1 as D}from"./index-73861dd0.js";const Z=t("div",{class:"p-3"},[t("div",{class:"text-3xl text-color-secondary"},"Filters")],-1),ee={class:"flex flex-column gap-4 p-3 text-600 cursor-pointer"},le=t("div",null,"Filter by",-1),ae={class:"text-lg text-800"},te=["onClick"],de={class:"text-lg text-800"},oe={key:0,class:"font-italic"},ie={class:"flex flex-wrap mt-2"},se={key:0},ue={key:1},ne={key:2,class:""},re={class:"flex justify-content-between"},ve={class:"filter-by-owner flex flex-column p-3 text-600 gap-3"},fe=t("div",{class:"text-xl text-color-secondary"},"Filter by",-1),ce={class:"flex flex-column gap-3"},me={class:"flex align-items-center"},pe=["for"],ye={class:"flex align-items-center"},_e=["for"],be={class:"flex align-items-center justify-content-end"},xe={class:"filter-by-owner flex flex-column p-3 text-600 gap-3"},ge={class:"text-xl font-bold text-color-secondary"},ke={class:"flex flex-column gap-3"},we={class:"flex justify-content-end gap-2"},he={__name:"ListViewFilterContent",props:{baseModule:Object,module:Object},setup(i){const g=i,f=w(!1),C=w(!1),k=w(!1),y=w(!1),e=w({query_type:null,mode:"edit",filters:g.module.viewFilters.find(d=>d.isDefault).filters,data:{mode:"new",uuid:null,field:null,operator:null,value:null,isNull:!1},default:{uuid:null,field:null,operator:null,value:null,isNull:!1}}),F=Q(),M=W(),{_getFieldDetailsById:u}=N(F),{addViewFilter:L}=F,{getPicklist:n}=N(M),{fetchPicklist:U}=M,q=()=>{e.value.data=Object.assign({},e.value.default),e.value.data.mode="new",k.value=!1,y.value=!0},A=(d,l)=>{console.log(d.uuid);let r=u.value({fields:g.module.fields,_id:d.field_id}),b=u.value({fields:n.value&&n.value.filter_operators.values,_id:d.operator_id});Object.assign(e.value.data,{uuid:d.uuid,field:r,operator:b,value:d.values}),e.value.data.mode="edit",k.value=!1,y.value=!0},B=async()=>{f.value=!0;let d=Object.assign({},{uuid:e.value.data.uuid,field_id:e.value.data.field._id,operator_id:e.value.data.operator._id,values:e.value.data.field.field_type.name==="text"?[e.value.data.value]:e.value.data.value});const l=Object.assign({},{mode:e.value.mode,baseModule:g.baseModule,viewFilter:g.module.viewFilters.find(b=>b.isDefault)._id,type:"filters",data:{mode:e.value.data.mode,filters:d}}),r=await L(l);r&&r.status===200&&(console.log(l),console.log(r.data),l.data.mode==="new"?I(r.data):T(r.data.filters[0]))},I=d=>{e.value.filters.push(d),y.value=!y.value,f.value=!1},T=d=>{e.value.filters.map(l=>{l.uuid===d.uuid&&Object.assign(l,d)}),f.value=!1},z=()=>{k.value=!0,y.value=!1},O=async d=>{await U(d)},E=d=>{e.value.data.value=null};return X(async()=>{e.value.query_type="all",Object.keys(n.value).length===0&&(C.value=!0,O("filter_operators"),C.value=!1),e.value.filters.length>0&&e.value.filters.map(d=>{const l=u.value({fields:g.module.fields,_id:d.field_id});O(l.listName)})}),Y(()=>e.value,(d,l)=>{d.data.field&&d.data.field.field_type.name==="picklist"&&O(d.data.field.listName)},{deep:!0}),(d,l)=>{const r=c("divider"),b=c("RadioButton"),h=c("Button"),j=c("Dropdown"),P=c("Checkbox"),R=c("Calendar"),G=c("MultiSelect"),H=c("inputText");return s(),v("div",null,[t("div",null,[Z,_(r,{class:"py-0 my-0"}),t("div",ee,[t("div",{onClick:z,class:"flex flex-column gap-2 p-3 border-1 border-400 hover:border-600 hover:surface-100 border-round-md"},[le,t("div",ae,m(e.value.query_type),1)]),e.value.filters.length>=1?(s(!0),v($,{key:0},S(e.value.filters,(a,J)=>(s(),v("div",{onClick:x=>A(a),key:J,class:"flex flex-column gap-2 p-3 border-1 border-400 hover:border-600 bg-orange-100 hover:bg-orange-200 border-round-md"},[t("div",null,m(o(u)({fields:i.module.fields,_id:a.field_id}).label),1),t("div",de,[o(n).filter_operators?(s(),v("div",oe,m(o(n).filter_operators.values.find(x=>x._id===a.operator_id).label),1)):V("",!0),t("div",ie,[(s(!0),v($,null,S(a.values,(x,K)=>(s(),v("div",{key:K,severity:"secondary",class:"text-xs white-space-nowrap"},[o(u)({fields:i.module.fields,_id:a.field_id}).field_type.name==="text"?(s(),v("div",se,m(x),1)):V("",!0),o(u)({fields:i.module.fields,_id:a.field_id}).field_type.name==="boolean"?(s(),v("div",ue," Test ")):V("",!0),o(u)({fields:i.module.fields,_id:a.field_id}).field_type.name==="picklist"||o(u)({fields:i.module.fields,_id:a.field_id}).field_type.name==="lookupModel"?(s(),v("div",ne,m(o(u)({fields:o(n)[o(u)({fields:i.module.fields,_id:a.field_id}).listName]&&o(n)[o(u)({fields:i.module.fields,_id:a.field_id}).listName].values,_id:x})&&o(u)({fields:o(n)[o(u)({fields:i.module.fields,_id:a.field_id}).listName]&&o(n)[o(u)({fields:i.module.fields,_id:a.field_id}).listName].values,_id:x}).value)+",Â  ",1)):V("",!0)]))),128))])])],8,te))),128)):V("",!0),t("div",re,[t("a",{onClick:l[0]||(l[0]=a=>q()),href:"javascript:void(0);"},"add filter"),t("a",{onClick:l[1]||(l[1]=a=>e.value.filters=[]),href:"javascript:void(0);"},"remove all")])])]),(s(),p(D,{to:`${k.value?".ddt-div-1":".hidden-div"}`},[t("div",ve,[fe,t("div",ce,[t("div",me,[_(b,{modelValue:e.value.query_type,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.query_type=a),inputId:`All ${i.baseModule.name}`,value:"all"},null,8,["modelValue","inputId"]),t("label",{for:`All ${i.baseModule.name}`,class:"ml-2"},"All "+m(i.baseModule.name),9,pe)]),t("div",ye,[_(b,{modelValue:e.value.query_type,"onUpdate:modelValue":l[3]||(l[3]=a=>e.value.query_type=a),inputId:`My ${i.baseModule.name}`,value:"owned"},null,8,["modelValue","inputId"]),t("label",{for:`My ${i.baseModule.name}`,class:"ml-2"},"My "+m(i.baseModule.name),9,_e)]),t("div",be,[_(h,{onClick:l[4]||(l[4]=a=>k.value=!1),label:"DONE",outlined:"",size:"large"})])])])],8,["to"])),(s(),p(D,{to:`${y.value?".ddt-div-1":".hidden-div"}`},[t("div",xe,[t("div",ge,m(e.value.data.mode=="new"?"Add filter":"Edit filter"),1),t("div",ke,[_(j,{modelValue:e.value.data.field,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.data.field=a),onChange:l[6]||(l[6]=a=>E()),options:i.module.fields,optionLabel:"label",placeholder:"Select a field",class:"w-full",filter:""},null,8,["modelValue","options"]),_(j,{modelValue:e.value.data.operator,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.data.operator=a),options:o(n).filter_operators&&o(n).filter_operators.values,optionLabel:"label",placeholder:"Select an operator",class:"w-full"},null,8,["modelValue","options"]),e.value.data.field&&e.value.data.field.field_type.name==="boolean"?(s(),p(P,{key:0,modelValue:e.value.data.value,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.data.value=a),binary:"",variant:"filled"},null,8,["modelValue"])):e.value.data.field&&e.value.data.field.field_type.name==="date"?(s(),p(R,{key:1,modelValue:e.value.data.value,"onUpdate:modelValue":l[9]||(l[9]=a=>e.value.data.value=a)},null,8,["modelValue"])):e.value.data.field&&(e.value.data.field.field_type.name==="lookupModel"||e.value.data.field.field_type.name==="picklist")?(s(),p(G,{key:2,modelValue:e.value.data.value,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.data.value=a),options:o(n)[e.value.data.field.listName]&&o(n)[e.value.data.field.listName].values,optionLabel:"value",optionValue:"_id",placeholder:"Select",maxSelectedLabels:3,class:"w-full"},null,8,["modelValue","options"])):(s(),p(H,{key:3,modelValue:e.value.data.value,"onUpdate:modelValue":l[11]||(l[11]=a=>e.value.data.value=a)},null,8,["modelValue"]))]),t("div",we,[_(h,{onClick:l[12]||(l[12]=a=>y.value=!1),disabled:f.value,outlined:"",label:"Cancel",severity:"secondary",size:"large"},null,8,["disabled"]),e.value.data.mode==="new"?(s(),p(h,{key:0,onClick:B,disabled:!e.value.data.field||!e.value.data.operator||f.value,loading:f.value,outlined:"",label:"Done",size:"large"},null,8,["disabled","loading"])):(s(),p(h,{key:1,onClick:l[13]||(l[13]=a=>B()),disabled:!e.value.data.field||!e.value.data.operator||f.value,loading:f.value,outlined:"",label:"Update",size:"large"},null,8,["disabled","loading"]))])])],8,["to"]))])}}};export{he as default};
