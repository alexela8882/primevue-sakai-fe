import{M as y,a as E,r as d,O as G,B as P,s as O,v as o,q as g}from"./index-557ccd93.js";const V=y("moduleDetailStore",()=>{E();const b=d(!0),h=d(!0),$=G(),R=P(),{jsonDbUrl:f}=O($),{getBaseModule:U,getModule:_,getModuleWithPermissions:k}=O(R),c=d({}),i=d([]),u=d([]),j=o(()=>c.value),N=o(()=>e=>p.value(e)),p=o(()=>e=>{let s=null;e?s=e:s=_.value.panels;const t=s.map((a,n)=>Object.assign({},{_id:a._id,controllerMethod:a.controllerMethod,entityName:a.entityName,highlight:a.highlight,label:a.label,mutable:a.mutable,panelName:a.panelName,sections:[],tabKey:a.tabKey}));return s.map((a,n)=>{a.sections.filter((r,m)=>{if(r.label){let l=Object.assign({},{sectionLabel:r.label,row:r.row,field_ids:r.field_ids,additional_fields:[]});t[n].sections.push(l)}else{const l=t[n].sections.slice(-1).pop();if(l){let C=Object.assign({},{ids:r.field_ids});l.additional_fields.push(C)}}})}),t}),I=o(()=>e=>c.value.data[e]),S=o(()=>e=>{i.value.find(s=>s._id===e)}),L=o(()=>i.value),T=o(()=>i.value.sort((s,t)=>s.panelOrder-t.panelOrder)),w=o(()=>e=>L.value.find(t=>t.cname===e)),v=o(()=>u.value),M=o(()=>u.value.sort((s,t)=>s.panelOrder-t.panelOrder)),B=o(()=>e=>v.value.find(t=>t.cname===e));return{_relatedLists:i,itemLoading:b,relatedListLoading:h,item:c,getItem:j,_getRelatedList:S,_getRelatedLists:L,_getRelatedOrderedLists:T,_getRelatedListsByCname:w,getRelatedLists:v,getRelatedOrderedLists:M,getRelatedListsByCname:B,_getItemPanels:N,getItemPanels:p,getItemValueByName:I,fetchItem:async e=>{b.value=!0;const s=`/modules/${e.name}/${e.pageid}`,t=await g(s,{method:"GET",headers:{"Content-Type":"application/json"}});t.status===200&&(c.value=t.data),b.value=!1},fetchItemRelatedList:async e=>{const s=`${f.value}/${e.moduleName}-related?cname=${e.panelName}`;`${e.moduleName}${e.base}${e.panelId}`;const t=await g(s,{method:"GET",headers:{"Content-Type":"application/json"}}).catch(a=>{console.log(a)});t&&t.status===200?t.data&&u.value.push(t.data[0]):u.value=[]},fetchItemRelatedLists:async e=>{h.value=!0,i.value=[];const s=e.moduleName,t=e.base;let a=e.relatedLists;`${f.value}${e.name}`,a.map(n=>i.value.push(n)),i.value.map(async n=>{const r=`/getShowRelatedList?module-name=${s}&base=${t}&panel=${n._id}`,m=await g(r,{method:"GET",headers:{"Content-Type":"application/json"}}).catch(l=>{console.log(l)});if(m&&m.status===200){let l=m.data;Object.assign(n,{...n,cname:l.cname,label:l.label,entityName:l.entityName,link:l.link,panelOrder:l.panelOrder,mutable:l.mutable,paginated:l.paginated,buttons:l.buttons,fields:l.fields,collection:l.collection})}else Object.assign(n,{...n,cname:null,label:null,entityName:null,link:null,panelOrder:null,mutable:null,paginated:null,buttons:[],fields:[],collection:[],permissions:[]})}),h.value=!1},paginateRelatedList:async e=>{console.log(e);const s=`/getShowRelatedList?module-name=${e.moduleName}&base=${e.base}&panel=${e.panel}&page=${e.page}&limit=${e.limit}`,t=await g(s,{method:"GET",headers:{"Content-Type":"application/json"}}).catch(a=>{console.log(a)});t&&t.status===200&&(console.log(t.data),i.value.map(a=>{a._id===e.panel?(console.log("matched"),Object.assign(a,t.data)):console.log("not matched")})),console.log(i.value)}}});export{V as u};
