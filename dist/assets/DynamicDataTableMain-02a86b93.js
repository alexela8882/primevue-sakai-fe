import{M as ke,O as xe,B as le,s as V,r as n,v as Q,q as Se,I as Ie,J as De,a as Ce,N as Ee,a3 as Me,a5 as Fe,a6 as Ne,G as Te,E as je,a7 as o,a8 as W,a9 as Le,c as h,o as s,j as r,f as p,w as k,e as y,g as P,t as x,m as F,d as X,x as Z,F as G,k as ee,i as D,n as ae,T as Re,y as Ve}from"./index-11690040.js";import{v as Be}from"./Validate-9b875981.js";const Oe=ke("moduleDynamicTableStore",()=>{const d=xe(),C=le(),{jsonDbUrl:u}=V(d);V(C);const N=n(!1),_=n([]),B=Q(()=>_.value),T=Q(()=>e=>{const b=_.value.find(j=>j.module===e);return b?b.content:null});return{getDropdownLists:B,getDropdown:T,fetchDropdownLists:async e=>{N.value=!0;const b=await Se(`${u.value}/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(b.status===200&&b.data&&!_.value.find(S=>S.module===e)){let S=Object.assign({},{module:e,content:b.data});_.value.push(S)}N.value=!1}}});const ze={key:0,style:{"white-space":"normal"}},Ae=["onDblclick"],Ue={key:0},$e={key:0},Pe={key:0,class:"mr-1"},Ge={key:1,class:"mr-1"},Je={href:"javascript:void(0);",style:{color:"red"}},qe={key:2,class:"mr-1"},He={href:"javascript:void(0);"},Ye={key:1},Ke={key:1,class:"edit-icon cursor-pointer pi pi-pencil ml-3"},Qe={key:2,class:"edit-icon cursor-pointer pi pi-lock ml-3"},We={key:0,class:"md:flex justify-content-between font-light"},Xe={class:"flex align-items-center px-3"},Ze={class:"text-sm text-color-secondary"},ea={class:"text-sm text-color-secondary"},aa=y("div",{class:"text-700"}," No records found ",-1),la={style:{overflow:"scroll","max-height":"100%"}},ta=y("div",{class:"ddt-div-1 shadow-4 bg-white"},null,-1),oa={key:0,style:{width:"100vw",position:"fixed",bottom:"0",left:"0",height:"54px","text-align":"center","margin-left":"90px",padding:"12px"},class:"shadow-2 align-items-center"},ua={__name:"DynamicDataTableMain",props:{mode:String,sidebar:Boolean,moduleId:String,moduleEntityName:String,moduleName:String,modulePermissions:{type:Array,default:[]},moduleLabel:String,data:Array,pagination:Object,pageItems:Array,rows:Number,pages:Number,viewFilter:Object,fields:Array,collectionLoading:Boolean},emits:["toggle-sidebar","paginate","limit-page"],setup(d,{emit:C}){const u=d,N=Ie(()=>De(()=>import("./Field-f44710c5.js"),["assets/Field-f44710c5.js","assets/index-11690040.js","assets/index-cb49da02.css","assets/Validate-9b875981.js","assets/Editor-2d0960bc.js","assets/Field-30426f23.css"])),_=n([]);if(u.viewFilter){let a=Object.assign({},{field:u.viewFilter.sortField,order:u.viewFilter.sortOrder=="ASC"?1:-1});_.value.push(a)}const B=Ce();n(),n(0);const T=n(null),O=n(null);n(!1);const e=n({rowId:null,field:null,rowIndex:null,columnIndex:null});Ee();const b=n(),j=n(),S=n();n(),n();const J=n(),L=n(),q=n(),te=le(),oe=Me(),ne=Oe(),{getModule:H,getCollection:na,getBaseModule:E,getEntity:ia}=V(te),{massUpdateRecords:ie}=oe;V(ne);const{validateField:se,errorChecker:de}=Be(),{transformLookupValue:z,transformFieldForSaving:ue}=Fe();n([{label:"View",icon:"pi pi-fw pi-search",command:()=>console.log(L.value)},{label:"Delete",icon:"pi pi-fw pi-times",command:()=>console.log(L.value)}]);const re=n([{label:"View",icon:"pi pi-reply",command:a=>{if(u.modulePermissions.includes("show")){const l=Object.assign({},{name:"modules.pages.detail",params:{name:u.moduleName,id:u.moduleId,pageid:q.value._id}});Ne.push(l)}else B.add({severity:"warn",summary:"Attention",detail:"You don't have permission please contact administrator.",life:1e4})}},{label:"Change Owner",icon:"pi pi-user",command:a=>{},visible:u.moduleEntityName===E.value.mainEntity},{label:"Update",icon:"pi pi-refresh",disabled:!u.modulePermissions.includes("update"),command:a=>{},visible:u.moduleEntityName===E.value.mainEntity},{label:"Delete",icon:"pi pi-times",disabled:!u.modulePermissions.includes("delete"),command:a=>{},visible:u.moduleEntityName===E.value.mainEntity}]),ce=n([{label:"10",value:10},{label:"15",value:15},{label:"20",value:20},{label:"25",value:25},{label:"30",value:30},{label:"35",value:35},{label:"40",value:40},{label:"45",value:45},{label:"50",value:50}]),i=n({values:{},errors:{}}),g=n({}),f=n(),Y=n(["owner_id","created_at","updated_at","created_by","updated_by"]),me=async(a,l,c)=>{C("paginate",{event:a,jump:l,per_page:c})},ve=async a=>{C("limit-page",a)},pe=a=>{},fe=(a,l)=>{S.value.toggle(a),q.value=l},ge=(a,l,c)=>{if(console.log(a),!o.includes(Y.value,l.name)&&(e.value.rowId=a.data._id,e.value.rowIndex=a.index,e.value.columnIndex=c,e.value.field=l,!o.has(i.value.values,a.data._id))){let m=o.cloneDeep(a.data);l.field_type.name=="lookupModel"&&(m[l.name]=z(m[l.name],l)),i.value.values[a.data._id]=o.cloneDeep(m),i.value.errors[a.data._id]={},i.value.errors[a.data._id][a.field]=[]}},ye=()=>{g.value={},i.value={},f.value=o.cloneDeep(u.data)};Te(()=>u.data,(a,l)=>{f.value=a}),je(async()=>{f.value=o.cloneDeep(u.data),console.log(f.value)}),W(T,a=>{a.target&&a.target.attributes.class.value!=="p-dropdown-item"&&C("toggle-sidebar",!1)}),document.addEventListener("keydown",function(a){a.key==="Escape"&&(console.log("Escape key pressed",a),A())}),W(O,a=>{let l=o.get(a,"target.classList",[]);console.log(a.target.parentElement.className,l),!o.includes(l,"p-inputtext")&&!o.includes(l,"el-input__inner")&&!o.includes(l,"el-select-dropdown__ite")&&!o.includes(l,"fieldInputSelection")&&!o.includes(l,"lookupSelected")&&!o.includes(l,"lookupInput")&&!o.includes(l,"lookupRemoveBtn")&&!o.includes(l,"lookupSelection")&&a.target.parentElement.className!="el-icon el-select__caret el-select__icon"?(console.log("click outside"),A()):console.log("clicked inside field")});const A=()=>{if(e.value.rowId!=null){let a=o.find(H.value.fields,{name:e.value.field.name});if(console.log(i.value.values[e.value.rowId][e.value.field.name]),i.value.errors[e.value.rowId][e.value.field.name]=se(i.value.values[e.value.rowId],a,H.value.fields),de(i.value.errors[e.value.rowId])){let c=o.findIndex(f.value,{_id:e.value.rowId}),m=i.value.values[e.value.rowId][e.value.field.name],w=f.value[c][e.value.field.name];e.value.field.field_type.name=="picklist"?m=o.isArray(i.value.values[e.value.rowId][e.value.field.name])?o.join(o.map(i.value.values[e.value.rowId][e.value.field.name],"value"),", "):i.value.values[e.value.rowId][e.value.field.name].value:e.value.field.field_type.name=="lookupModel"&&(m=z(i.value.values[e.value.rowId][e.value.field.name],e.value.field,!0),w=z(f.value[c][e.value.field.name],e.value.field,!0)),m!=w&&(console.log(e.value.field,m,w),e.value.field.field_type.name=="picklist"?(console.log("picklist changed",i.value.values[e.value.rowId][e.value.field.name].value),f.value[c][e.value.field.name]=i.value.values[e.value.rowId][e.value.field.name].value):f.value[c][e.value.field.name]=i.value.values[e.value.rowId][e.value.field.name],o.has(g.value,e.value.rowId)?o.has(g.value[e.value.rowId],e.value.field.name)||g.value[e.value.rowId].push(e.value.field.name):g.value[e.value.rowId]=[e.value.field.name]),e.value={rowId:null,field:null,rowIndex:null,columnIndex:null}}}},_e=n(!1),be=async()=>{_e.value=!0;let a=o.reduce(g.value,function(c,m,w){let R={_id:w};return o.forEach(m,function(M){R[M]=ue(i.value.values[w][M],o.find(u.fields,{name:M}))}),c.push(R),c},[]);(await ie(a,E.value.name)).status==200&&(g.value={},i.value={values:{},errors:{}})};return Le("form",i),(a,l)=>{const c=h("Column"),m=h("Button"),w=h("Menu"),R=h("Dropdown"),M=h("Divider"),we=h("Paginator"),he=h("DataTable"),K=h("el-button");return s(),r(G,null,[p(he,{selection:J.value,"onUpdate:selection":l[3]||(l[3]=t=>J.value=t),contextMenuSelection:L.value,"onUpdate:contextMenuSelection":l[4]||(l[4]=t=>L.value=t),multiSortMeta:_.value,"onUpdate:multiSortMeta":l[5]||(l[5]=t=>_.value=t),onRowContextmenu:pe,tableClass:"editable-cells-table module-table",value:f.value,loading:d.collectionLoading,stripedRows:"",resizableColumns:"",columnResizeMode:"fit",sortMode:"multiple",removableSort:"",scrollable:"",scrollHeight:"60vh",class:"dynamic-tbl",style:{"min-height":"60vh !important"}},{footer:k(()=>[d.pagination?(s(),r("div",We,[y("div",Xe,[y("div",Ze,[P(" Items per page: "),p(R,{onChange:l[0]||(l[0]=t=>ve(t)),modelValue:d.pagination.per_page,"onUpdate:modelValue":l[1]||(l[1]=t=>d.pagination.per_page=t),options:ce.value,optionLabel:"label",optionValue:"value",placeholder:"Select a page",class:"filled-dropdown"},null,8,["modelValue","options"])]),p(M,{type:"solid",layout:"vertical"}),y("div",ea,x(d.pagination.current_page)+" - "+x(d.pagination.total_pages)+" of "+x(d.pagination.total)+" items ",1)]),p(we,{onPage:l[2]||(l[2]=t=>me(t,!1,d.pagination.per_page)),template:"JumpToPageDropdown PrevPageLink NextPageLink",rows:d.pagination&&d.pagination.per_page,totalRecords:d.pagination&&d.pagination.total,rowsPerPageOptions:[5,10,15,20,25,30],class:"custom-paginator"},null,8,["rows","totalRecords"])])):F("",!0)]),empty:k(()=>[aa]),default:k(()=>[d.mode==="edit"?(s(),X(c,{key:0,frozen:"",headerClass:"custom-header bg-primary-100 text-color-secondary",style:Z(`min-width: 60px; ${b.value}`),bodyClass:"text-center py-1",selectionMode:"multiple"},null,8,["style"])):F("",!0),(s(!0),r(G,null,ee(d.fields,(t,U)=>(s(),X(c,{key:t._id,field:t.name,header:t.label,sortable:"",sorticon:"check",style:{"min-width":"200px !important"},bodyClass:`text-color-secondary ${t.field_type.name=="lookupModel"?"lookupColumn":""}`,headerClass:"bg-primary-100 text-color-secondary"},{body:k(v=>[e.value.rowId==v.data._id&&e.value.field.name==v.field?(s(),r("div",ze,[p(D(N),{ref_for:!0,ref_key:"fieldEditingRef",ref:O,config:t,keyName:v.data._id,inline:!0,type:"tableForm",module:D(E).name,onChangeValue:A},null,8,["config","keyName","module"])])):(s(),r("div",{key:1,class:ae(["py-2",{"cell-edited":D(o).find(g.value,function(I,$){if($==v.data._id&&D(o).includes(I,t.name))return!0})}]),onDblclick:I=>ge(v,t,U)},[y("div",{class:ae(["flex align-items-center px-2",v.data[t.name]?"justify-content-between":"justify-content-end"])},[v.data[t.name]?(s(),r("div",Ue,[t.relation?(s(),r("span",$e,[(s(!0),r(G,null,ee(t.relation.displayFieldName,(I,$)=>(s(),r("span",{key:$},[t.rules.ss_pop_up?(s(),r("span",Pe,x(v.data[t.name][I]),1)):t.rules.ss_dropdown?(s(),r("span",Ge,[y("a",Je,x(v.data[t.name][I]),1)])):(s(),r("span",qe,[y("a",He,x(v.data[t.name][I]),1)]))]))),128))])):(s(),r("span",Ye,x(v.data[t.name]),1))])):F("",!0),D(o).includes(Y.value,t.name)?(s(),r("i",Qe)):(s(),r("i",Ke))],2)],42,Ae))]),_:2},1032,["field","header","bodyClass"]))),128)),p(c,{frozen:"",alignFrozen:"right",exportable:!1,style:Z(`min-width: 60px; ${j.value}`),bodyClass:"text-color-secondary text-center py-1",headerClass:"bg-primary-100 text-color-secondary"},{body:k(t=>[p(m,{class:"menu-btn",icon:"pi pi-ellipsis-v",text:"",size:"small",onClick:U=>fe(U,t.data),"aria-haspopup":"true","aria-controls":"overlay_menu",style:{"font-size":".3rem",padding:"2px 0","background-color":"transparent"}},null,8,["onClick"]),p(w,{ref_key:"menu",ref:S,id:"overlay_menu","data-value":t,model:re.value,popup:!0},null,8,["data-value","model"])]),_:1},8,["style"]),p(Re,{name:"lvf-slide-fade"},{default:k(()=>[d.sidebar?(s(),r("div",{key:0,ref_key:"listViewFilterRef",ref:T,class:"ddt-slot-1 shadow-4 bg-white"},[y("div",la,[Ve(a.$slots,"list-view-filter")]),ta],512)):F("",!0)]),_:3})]),_:3},8,["selection","contextMenuSelection","multiSortMeta","value","loading"]),D(o).isEmpty(g.value)?F("",!0):(s(),r("div",oa,[p(K,{onClick:ye},{default:k(()=>[P("Cancel")]),_:1}),p(K,{type:"primary",onClick:be},{default:k(()=>[P("Save")]),_:1})]))],64)}}};export{ua as default};
