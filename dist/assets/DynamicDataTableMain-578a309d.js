import{M as ke,O as xe,B as le,s as j,r as o,v as Q,q as Se,I as Ie,J as De,a as Ce,N as Ee,a3 as Me,a5 as Fe,a6 as Ne,G as Te,E as Le,a7 as n,a8 as W,a9 as Re,c as h,o as s,j as r,f as p,w as k,e as y,g as P,t as x,m as F,d as X,x as Z,F as G,k as ee,i as D,n as ae,T as Ve,y as je}from"./index-b308c080.js";import{v as Be}from"./Validate-48a397ba.js";const Oe=ke("moduleDynamicTableStore",()=>{const d=xe(),C=le(),{jsonDbUrl:u}=j(d);j(C);const N=o(!1),b=o([]),B=Q(()=>b.value),T=Q(()=>e=>{const w=b.value.find(L=>L.module===e);return w?w.content:null});return{getDropdownLists:B,getDropdown:T,fetchDropdownLists:async e=>{N.value=!0;const w=await Se(`${u.value}/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(w.status===200&&w.data&&!b.value.find(S=>S.module===e)){let S=Object.assign({},{module:e,content:w.data});b.value.push(S)}N.value=!1}}});const ze={key:0,style:{"white-space":"normal"}},Ae=["onDblclick"],Ue={key:0},$e={key:0},Pe={key:0,class:"mr-1"},Ge={key:1,class:"mr-1"},Je={key:2,class:"mr-1"},qe={key:1},He={key:1,class:"edit-icon cursor-pointer pi pi-pencil ml-3"},Ye={key:2,class:"edit-icon cursor-pointer pi pi-lock ml-3"},Ke={key:0,class:"md:flex justify-content-between font-light"},Qe={class:"flex align-items-center px-3"},We={class:"text-sm text-color-secondary"},Xe={class:"text-sm text-color-secondary"},Ze=y("div",{class:"text-700"}," No records found ",-1),ea={style:{overflow:"scroll","max-height":"100%"}},aa=y("div",{class:"ddt-div-1 shadow-4 bg-white"},null,-1),la={key:0,style:{width:"100vw",position:"fixed",bottom:"0",left:"0",height:"54px","text-align":"center","margin-left":"90px",padding:"12px"},class:"shadow-2 align-items-center"},sa={__name:"DynamicDataTableMain",props:{mode:String,sidebar:Boolean,moduleId:String,moduleEntityName:String,moduleName:String,modulePermissions:{type:Array,default:[]},moduleLabel:String,data:Array,pagination:Object,pageItems:Array,rows:Number,pages:Number,viewFilter:Object,fields:Array,collectionLoading:Boolean},emits:["toggle-sidebar","paginate","limit-page"],setup(d,{emit:C}){const u=d,N=Ie(()=>De(()=>import("./Field-db1df2e6.js"),["assets/Field-db1df2e6.js","assets/index-b308c080.js","assets/index-cb49da02.css","assets/Validate-48a397ba.js","assets/Editor-31357411.js","assets/Field-30426f23.css"])),b=o([]);if(u.viewFilter){let a=Object.assign({},{field:u.viewFilter.sortField,order:u.viewFilter.sortOrder=="ASC"?1:-1});b.value.push(a)}const B=Ce();o(),o(0);const T=o(null),O=o(null);o(!1);const e=o({rowId:null,field:null,rowIndex:null,columnIndex:null});Ee();const w=o(),L=o(),S=o();o(),o();const J=o(),R=o(),q=o(),te=le(),ne=Me(),oe=Oe(),{getModule:H,getCollection:ta,getBaseModule:E,getEntity:na}=j(te),{massUpdateRecords:ie}=ne;j(oe);const{validateField:se,errorChecker:de}=Be(),{transformLookupValue:z,transformFieldForSaving:ue}=Fe();o([{label:"View",icon:"pi pi-fw pi-search",command:()=>console.log(R.value)},{label:"Delete",icon:"pi pi-fw pi-times",command:()=>console.log(R.value)}]);const re=o([{label:"View",icon:"pi pi-reply",command:a=>{if(u.modulePermissions.includes("show")){const l=Object.assign({},{name:"modules.pages.detail",params:{name:u.moduleName,id:u.moduleId,pageid:q.value._id}});Ne.push(l)}else B.add({severity:"warn",summary:"Attention",detail:"You don't have permission please contact administrator.",life:1e4})}},{label:"Change Owner",icon:"pi pi-user",command:a=>{},visible:u.moduleEntityName===E.value.mainEntity},{label:"Update",icon:"pi pi-refresh",disabled:!u.modulePermissions.includes("update"),command:a=>{},visible:u.moduleEntityName===E.value.mainEntity},{label:"Delete",icon:"pi pi-times",disabled:!u.modulePermissions.includes("delete"),command:a=>{},visible:u.moduleEntityName===E.value.mainEntity}]),ce=o([{label:"10",value:10},{label:"15",value:15},{label:"20",value:20},{label:"25",value:25},{label:"30",value:30},{label:"35",value:35},{label:"40",value:40},{label:"45",value:45},{label:"50",value:50}]),i=o({values:{},errors:{}}),g=o({}),f=o(),Y=o(["owner_id","created_at","updated_at","created_by","updated_by"]),me=async(a,l,c)=>{C("paginate",{event:a,jump:l,per_page:c})},ve=async a=>{C("limit-page",a)},pe=a=>{},fe=(a,l)=>{S.value.toggle(a),q.value=l},ge=(a,l,c)=>{if(console.log(a),!n.includes(Y.value,l.name)&&(e.value.rowId=a.data._id,e.value.rowIndex=a.index,e.value.columnIndex=c,e.value.field=l,!n.has(i.value.values,a.data._id))){let m=n.cloneDeep(a.data);l.field_type.name=="lookupModel"&&(m[l.name]=z(m[l.name],l)),i.value.values[a.data._id]=n.cloneDeep(m),i.value.errors[a.data._id]={},i.value.errors[a.data._id][a.field]=[]}},ye=()=>{g.value={},i.value={},f.value=n.cloneDeep(u.data)};Te(()=>u.data,(a,l)=>{f.value=a}),Le(async()=>{f.value=n.cloneDeep(u.data),console.log(f.value)}),W(T,a=>{a.target&&a.target.attributes.class.value!=="p-dropdown-item"&&C("toggle-sidebar",!1)}),document.addEventListener("keydown",function(a){a.key==="Escape"&&(console.log("Escape key pressed",a),A())}),W(O,a=>{let l=n.get(a,"target.classList",[]);console.log(a.target.parentElement.className,l),!n.includes(l,"p-inputtext")&&!n.includes(l,"el-input__inner")&&!n.includes(l,"el-select-dropdown__ite")&&!n.includes(l,"fieldInputSelection")&&!n.includes(l,"lookupSelected")&&!n.includes(l,"lookupInput")&&!n.includes(l,"lookupRemoveBtn")&&!n.includes(l,"lookupSelection")&&a.target.parentElement.className!="el-icon el-select__caret el-select__icon"?(console.log("click outside"),A()):console.log("clicked inside field")});const A=()=>{if(e.value.rowId!=null){let a=n.find(H.value.fields,{name:e.value.field.name});if(console.log(i.value.values[e.value.rowId][e.value.field.name]),i.value.errors[e.value.rowId][e.value.field.name]=se(i.value.values[e.value.rowId],a,H.value.fields),de(i.value.errors[e.value.rowId])){let c=n.findIndex(f.value,{_id:e.value.rowId}),m=i.value.values[e.value.rowId][e.value.field.name],_=f.value[c][e.value.field.name];e.value.field.field_type.name=="picklist"?m=n.isArray(i.value.values[e.value.rowId][e.value.field.name])?n.join(n.map(i.value.values[e.value.rowId][e.value.field.name],"value"),", "):i.value.values[e.value.rowId][e.value.field.name].value:e.value.field.field_type.name=="lookupModel"&&(m=z(i.value.values[e.value.rowId][e.value.field.name],e.value.field,!0),_=z(f.value[c][e.value.field.name],e.value.field,!0)),m!=_&&(console.log(e.value.field,m,_),e.value.field.field_type.name=="picklist"?(console.log("picklist changed",i.value.values[e.value.rowId][e.value.field.name].value),f.value[c][e.value.field.name]=i.value.values[e.value.rowId][e.value.field.name].value):f.value[c][e.value.field.name]=i.value.values[e.value.rowId][e.value.field.name],n.has(g.value,e.value.rowId)?n.has(g.value[e.value.rowId],e.value.field.name)||g.value[e.value.rowId].push(e.value.field.name):g.value[e.value.rowId]=[e.value.field.name]),e.value={rowId:null,field:null,rowIndex:null,columnIndex:null}}}},be=o(!1),we=async()=>{be.value=!0;let a=n.reduce(g.value,function(c,m,_){let V={_id:_};return n.forEach(m,function(M){V[M]=ue(i.value.values[_][M],n.find(u.fields,{name:M}))}),c.push(V),c},[]);(await ie(a,E.value.name)).status==200&&(g.value={},i.value={values:{},errors:{}})};return Re("form",i),(a,l)=>{const c=h("Column"),m=h("Button"),_=h("Menu"),V=h("Dropdown"),M=h("Divider"),_e=h("Paginator"),he=h("DataTable"),K=h("el-button");return s(),r(G,null,[p(he,{selection:J.value,"onUpdate:selection":l[3]||(l[3]=t=>J.value=t),contextMenuSelection:R.value,"onUpdate:contextMenuSelection":l[4]||(l[4]=t=>R.value=t),multiSortMeta:b.value,"onUpdate:multiSortMeta":l[5]||(l[5]=t=>b.value=t),onRowContextmenu:pe,tableClass:"editable-cells-table module-table",value:f.value,loading:d.collectionLoading,stripedRows:"",resizableColumns:"",columnResizeMode:"fit",sortMode:"multiple",removableSort:"",scrollable:"",scrollHeight:"60vh",class:"dynamic-tbl",style:{"min-height":"60vh !important"}},{footer:k(()=>[d.pagination?(s(),r("div",Ke,[y("div",Qe,[y("div",We,[P(" Items per page: "),p(V,{onChange:l[0]||(l[0]=t=>ve(t)),modelValue:d.pagination.per_page,"onUpdate:modelValue":l[1]||(l[1]=t=>d.pagination.per_page=t),options:ce.value,optionLabel:"label",optionValue:"value",placeholder:"Select a page",class:"filled-dropdown"},null,8,["modelValue","options"])]),p(M,{type:"solid",layout:"vertical"}),y("div",Xe,x(d.pagination.current_page)+" - "+x(d.pagination.total_pages)+" of "+x(d.pagination.total)+" items ",1)]),p(_e,{onPage:l[2]||(l[2]=t=>me(t,!1,d.pagination.per_page)),template:"JumpToPageDropdown PrevPageLink NextPageLink",rows:d.pagination&&d.pagination.per_page,totalRecords:d.pagination&&d.pagination.total,rowsPerPageOptions:[5,10,15,20,25,30],class:"custom-paginator"},null,8,["rows","totalRecords"])])):F("",!0)]),empty:k(()=>[Ze]),default:k(()=>[d.mode==="edit"?(s(),X(c,{key:0,frozen:"",headerClass:"custom-header bg-primary-100 text-color-secondary",style:Z(`min-width: 60px; ${w.value}`),bodyClass:"text-center py-1",selectionMode:"multiple"},null,8,["style"])):F("",!0),(s(!0),r(G,null,ee(d.fields,(t,U)=>(s(),X(c,{key:t._id,field:t.name,header:t.label,sortable:"",sorticon:"check",style:{"min-width":"200px !important"},bodyClass:`text-color-secondary ${t.field_type.name=="lookupModel"?"lookupColumn":""}`,headerClass:"bg-primary-100 text-color-secondary"},{body:k(v=>[e.value.rowId==v.data._id&&e.value.field.name==v.field?(s(),r("div",ze,[p(D(N),{ref_for:!0,ref_key:"fieldEditingRef",ref:O,config:t,keyName:v.data._id,inline:!0,type:"tableForm",module:D(E).name,onChangeValue:A},null,8,["config","keyName","module"])])):(s(),r("div",{key:1,class:ae(["py-2",{"cell-edited":D(n).find(g.value,function(I,$){if($==v.data._id&&D(n).includes(I,t.name))return!0})}]),onDblclick:I=>ge(v,t,U)},[y("div",{class:ae(["flex align-items-center px-2",v.data[t.name]?"justify-content-between":"justify-content-end"])},[v.data[t.name]?(s(),r("div",Ue,[t.relation?(s(),r("span",$e,[(s(!0),r(G,null,ee(t.relation.displayFieldName,(I,$)=>(s(),r("span",{key:$},[t.rules.ss_pop_up?(s(),r("span",Pe,x(v.data[t.name][I]),1)):t.rules.ss_dropdown?(s(),r("span",Ge,[y("span",null,x(v.data[t.name][I]),1)])):(s(),r("span",Je,[y("span",null,x(v.data[t.name][I]),1)]))]))),128))])):(s(),r("span",qe,x(v.data[t.name]),1))])):F("",!0),D(n).includes(Y.value,t.name)?(s(),r("i",Ye)):(s(),r("i",He))],2)],42,Ae))]),_:2},1032,["field","header","bodyClass"]))),128)),p(c,{frozen:"",alignFrozen:"right",exportable:!1,style:Z(`min-width: 60px; ${L.value}`),bodyClass:"text-color-secondary text-center py-1",headerClass:"bg-primary-100 text-color-secondary"},{body:k(t=>[p(m,{class:"menu-btn",icon:"pi pi-ellipsis-v",text:"",size:"small",onClick:U=>fe(U,t.data),"aria-haspopup":"true","aria-controls":"overlay_menu",style:{"font-size":".3rem",padding:"2px 0","background-color":"transparent"}},null,8,["onClick"]),p(_,{ref_key:"menu",ref:S,id:"overlay_menu","data-value":t,model:re.value,popup:!0},null,8,["data-value","model"])]),_:1},8,["style"]),p(Ve,{name:"lvf-slide-fade"},{default:k(()=>[d.sidebar?(s(),r("div",{key:0,ref_key:"listViewFilterRef",ref:T,class:"ddt-slot-1 shadow-4 bg-white"},[y("div",ea,[je(a.$slots,"list-view-filter")]),aa],512)):F("",!0)]),_:3})]),_:3},8,["selection","contextMenuSelection","multiSortMeta","value","loading"]),D(n).isEmpty(g.value)?F("",!0):(s(),r("div",la,[p(K,{onClick:ye},{default:k(()=>[P("Cancel")]),_:1}),p(K,{type:"primary",onClick:we},{default:k(()=>[P("Save")]),_:1})]))],64)}}};export{sa as default};
