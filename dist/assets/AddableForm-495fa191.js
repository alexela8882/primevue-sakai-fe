import{I as E,J as D,a3 as ee,B as ae,K as le,a4 as se,s as A,a as te,r as m,a7 as a,a9 as oe,E as ie,c as q,o as t,j as c,e as y,d as k,w as _,F as f,k as S,i as o,m as V,S as re,f as C,g as M}from"./index-73861dd0.js";import{v as ue}from"./Validate-9c4b9c6e.js";import{u as ne}from"./index-99c8d323.js";const de={class:"relative min-h-full p-3"},me={class:"sticky bottom-0 right-0 py-2 surface-50"},ce={class:"flex justify-content-end gap-2 px-3 py-1"},Ne={__name:"AddableForm",props:{moduleName:String,formPage:String},emits:["close"],setup(n,{emit:x}){const s=n,L=E(()=>D(()=>import("./Field-670a9f71.js"),["assets/Field-670a9f71.js","assets/index-73861dd0.js","assets/index-d5e7f8f7.css","assets/Validate-9c4b9c6e.js","assets/Editor-81b206c6.js","assets/Field-30426f23.css"])),B=E(()=>D(()=>import("./FormPanel-31d22ea1.js"),["assets/FormPanel-31d22ea1.js","assets/index-73861dd0.js","assets/index-d5e7f8f7.css","assets/FormPanel-d63a1f32.css"])),R=ee(),T=ne(),F=ae();le();const{formatLookupOptions:fe,getPicklistFields:ve,getLookupFields:ge,transformFormValues:w,transformDate:pe,transformForSaving:O,getAllHiddenFieldsAndPanels:j,controllingFieldChecker:ke,getAllDisabledFields:z,checkSetValRule:H}=se(),{fetchPicklist:_e,fetchLookup:he,saveQuickAdd:J}=R,{getItem:K}=A(T),{fetchModuleFields:Q,fetchModulePanels:W}=F,{getModuleByName:i}=A(F),{validateForm:G,errorChecker:I}=ue(),P=te(),U=m(a.fill(Array(10),1)),v=m(!0);m(!1);const e=m({fields:[],panels:[],values:{main:{}},lookup:{},errors:{main:{}},hidden:{fields:[],panels:[]},disabled:[],formSaving:!1});m([]),oe("form",e),ie(async()=>{a.isEmpty(i.value(s.moduleName).fields)&&await Q(i.value(s.moduleName).mainEntity),a.isEmpty(i.value(s.moduleName).panels)&&await W(s.moduleName);let r=a.cloneDeep(i.value(s.moduleName));e.value.fields=r.fields,e.value.panels=r.panels,X(),v.value=!1});const X=()=>{let r=a.chain(e.value.fields).filter({quick:!0}).map("_id").value(),g=s.formPage=="create"?null:K.value,d=w(e.value.fields,g,s.formPage),p=H(e.value.fields,d,i.value(s.moduleName).mainEntity);e.value.values.main=a.merge(a.cloneDeep(d),a.cloneDeep(p)),e.value.hidden=j(e.value.panels,e.value.fields,e.value.values.main,s.formPage),e.value.disabled=z(e.value.fields,e.value.values.main,s.formPage),a.forEach(e.value.panels,function(l,u){e.value.panels[u].quick=!1,a.forEach(l.sections,function(h,N){e.value.panels[u].sections[N].quick=!1;let b=h.field_ids[0];h.field_ids.length>1&&b.concat(h.field_ids[1]),a.filter(b,function($){if(a.includes(r,$))return!0}).length>0&&(e.value.panels[u].quick=!0,e.value.panels[u].sections[N].quick=!0)}),s.formPage=="create"&&(e.value.values[l.panelName]=[],e.value.errors[l.panelName]=[])})},Y=async()=>{if(e.value.formSaving=!0,e.value.errors.main=G(e.value.values.main,e.value.fields,!1),I(e.value.errors.main)){let g=O(e.value.values.main,e.value.fields,!1);(await J(g,i.value(s.moduleName))).status==200&&(P.add({severity:"success",summary:"Success Message",detail:"Record added",life:3e3}),e.value.formSaving=!1)}else P.add({severity:"error",summary:"Error Message",detail:"Please check the form again",life:3e3}),e.value.formSaving=!1},Z=()=>{x("close")};return(r,g)=>{const d=q("Skeleton"),p=q("el-button");return t(),c(f,null,[y("div",de,[v.value?V("",!0):(t(),k(re,{key:0},{fallback:_(()=>[(t(!0),c(f,null,S(U.value,(l,u)=>(t(),k(d,{key:u,height:"2rem",class:"mb-2",borderRadius:"16px"}))),128))]),default:_(()=>[o(a).filter(e.value.panels,{quick:!0}).length==1?(t(!0),c(f,{key:0},S(o(a).filter(e.value.fields,{quick:!0}),l=>(t(),c(f,{key:l._id},[o(a).includes(e.value.hidden.fields,l._id)?V("",!0):(t(),k(o(L),{key:0,keyName:"main",config:l,module:n.moduleName,formPage:n.formPage},null,8,["config","module","formPage"]))],64))),128)):(t(!0),c(f,{key:1},S(o(a).filter(e.value.panels,function(l){if(!o(a).includes(e.value.hidden.panels,l.panelName)&&o(a).endsWith(l.controllerMethod,"@index")&&l.quick)return!0}),l=>(t(),k(o(B),{key:l._id,panel:l,quickAdd:!0,module:n.moduleName,formPage:n.formPage},null,8,["panel","module","formPage"]))),128))]),_:1}))]),y("div",me,[y("div",ce,[C(p,{onClick:Z,disabled:v.value||e.value.formSaving},{default:_(()=>[M("Cancel")]),_:1},8,["disabled"]),C(p,{type:"primary",onClick:Y,disabled:v.value||e.value.formSaving,loading:e.value.formSaving},{default:_(()=>[M("Save")]),_:1},8,["disabled","loading"])])])],64)}}};export{Ne as default};
