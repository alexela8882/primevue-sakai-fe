import{I as x,J as E,a3 as te,B as oe,K as se,a5 as ie,s as N,a as ne,r as _,a7 as a,a9 as ue,E as re,Y as de,G as ce,c as L,o,j as n,e as P,F as u,k as p,d as k,m as h,w as S,i as t,S as me,f as T,g as w}from"./index-650769bc.js";import{v as fe}from"./Validate-af95fe20.js";import{u as ve}from"./index-df4ce26f.js";const ge={class:"relative min-h-full p-3"},_e={class:"sticky bottom-0 right-0 py-2 surface-50"},pe={class:"flex justify-content-end gap-2 px-3 py-1"},qe={__name:"Form",props:{config:Object},setup(r){const s=r,z=x(()=>E(()=>import("./Field-c29331f6.js"),["assets/Field-c29331f6.js","assets/index-650769bc.js","assets/index-cb49da02.css","assets/Validate-af95fe20.js","assets/Editor-be49785d.js","assets/Field-3940f18b.css"])),C=x(()=>E(()=>import("./FormPanel-0a578c7d.js"),["assets/FormPanel-0a578c7d.js","assets/index-650769bc.js","assets/index-cb49da02.css","assets/FormPanel-d63a1f32.css"])),B=x(()=>E(()=>import("./QuoteLineItem-d89b225c.js"),["assets/QuoteLineItem-d89b225c.js","assets/index-650769bc.js","assets/index-cb49da02.css"])),q=te(),O=ve(),D=oe(),I=se(),{formatLookupOptions:ke,getPicklistFields:he,getLookupFields:ye,transformFormValues:y,transformDate:Fe,transformForSaving:j,getAllHiddenFieldsAndPanels:W}=ie(),{fetchPicklist:Se,fetchLookup:be,saveForm:G,setFormReset:A,saveFormValues:H}=q,{getCachedFormData:J,getFormReset:M}=N(q),{getItem:b}=N(O),{fetchModuleFields:K,fetchModulePanels:Q}=D,{removeTab:U}=I,{getModuleByName:F}=N(D),{validateForm:Y,errorChecker:X}=fe(),R=ne(),V=_(a.fill(Array(10),1)),d=_(!0);_(!1);const e=_({fields:[],panels:[],values:{main:{}},lookup:{},errors:{main:{}},hidden:{fields:[],panels:[]},formName:s.config.name,formSaving:!1}),v=_();_([]),ue("form",e),re(async()=>{let i=J.value(s.config.name);v.value=a.includes(s.config.name,"edit")?"edit":"create",console.log("mounted",d.value),i?(e.value=a.merge(e.value,a.cloneDeep(i)),s.config.name==M.value&&(e.value.values.main=y(e.value.fields,b.value,v.value),A("")),d.value=!1):(a.isEmpty(F.value(s.config._module).fields)&&await K(s.config._module),a.isEmpty(F.value(s.config._module).panels)&&await Q(s.config._module),e.value.fields=F.value(s.config._module).fields,e.value.panels=F.value(s.config._module).panels,e.value.values.main=y(e.value.fields,b.value,v.value),Z(),d.value=!1)}),de(()=>{console.log("before unmount"),G(e.value)}),ce(()=>M.value,(i,g)=>{i==s.config.name&&(e.value.values.main=y(s.config.module.fields),A(""))});const Z=()=>{let i=a.chain(e.value.fields).filter({quick:!0}).map("_id").value();e.value.hidden=W(e.value.panels,e.value.fields,e.value.values.main,v.value),a.forEach(e.value.panels,function(g,c){e.value.panels[c].quick=!1,a.forEach(g.sections,function(f,l){e.value.panels[c].sections[l].quick=!1;let m=f.field_ids[0];f.field_ids.length>1&&m.concat(f.field_ids[1]),a.filter(m,function(le){if(a.includes(i,le))return!0}).length>0&&(e.value.panels[c].quick=!0,e.value.panels[c].sections[l].quick=!0)}),v.value=="create"&&(e.value.values[g.panelName]=[],e.value.errors[g.panelName]=[])}),console.log("done initialize")},$=()=>{d.value=!0;let i=a.includes(s.config.name,"edit")?"edit":"create";e.value.values.main=y(e.value.fields,b.value,i),d.value=!1},ee=async()=>{let i=a.get(s.config,"maximized",!1);if(e.value.formSaving=!0,e.value.errors.main=Y(e.value.values.main,e.value.fields,i),X(e.value.errors.main)){let c=j(e.value.values.main,e.value.fields,i);(await H(c,s.config.base_module)).status==200&&(R.add({severity:"success",summary:"Success Message",detail:"Record added",life:3e3}),e.value.formSaving=!1,ae(s.config))}else R.add({severity:"error",summary:"Error Message",detail:"Please check the form again",life:3e3}),e.value.formSaving=!1},ae=async i=>{await U(i)};return(i,g)=>{const c=L("Skeleton"),f=L("el-button");return o(),n(u,null,[P("div",ge,[d.value?(o(!0),n(u,{key:0},p(V.value,(l,m)=>(o(),k(c,{key:m,height:"2rem",class:"mb-2",borderRadius:"16px"}))),128)):h("",!0),d.value?h("",!0):(o(),k(me,{key:1},{fallback:S(()=>[(o(!0),n(u,null,p(V.value,(l,m)=>(o(),k(c,{key:m,height:"2rem",class:"mb-2",borderRadius:"16px"}))),128))]),default:S(()=>[t(a).filter(e.value.panels,{quick:!0}).length==1&&t(a).get(r.config,"maximized",!1)==!1?(o(!0),n(u,{key:0},p(t(a).filter(e.value.fields,{quick:!0}),l=>(o(),n(u,{key:l._id},[t(a).includes(e.value.hidden.fields,l.uniqueName)?h("",!0):(o(),k(t(z),{key:0,keyName:"main",config:l,module:r.config._module},null,8,["config","module"]))],64))),128)):(o(),n(u,{key:1},[(o(!0),n(u,null,p(t(a).filter(e.value.panels,function(l){if(!t(a).includes(e.value.hidden.panels,l.panelName)&&t(a).endsWith(l.controllerMethod,"@index")&&(t(a).get(r.config,"maximized",!1)==!1&&l.quick||t(a).get(r.config,"maximized",!1)==!0))return!0}),l=>(o(),k(t(C),{key:l._id,panel:l,quickAdd:!t(a).get(r.config,"maximized",!1),module:r.config._module},null,8,["panel","quickAdd","module"]))),128)),(o(!0),n(u,null,p(t(a).filter(e.value.panels,function(l){if(!t(a).includes(e.value.hidden.panels,l.panelName)&&t(a).endsWith(l.controllerMethod,"@show")&&t(a).get(r.config,"maximized",!1)==!0)return!0}),l=>(o(),n(u,{key:l._id},[t(a).includes(["SalesOpptItem"],l.entityName)?(o(!0),n(u,{key:0},p(l.sections,m=>(o(),n("div",{key:m._id,class:"flex flex-column px-1 py-2 mt-2"},[l.entityName=="SalesOpptItem"?(o(),k(t(B),{key:0,panel:l,module:r.config._module,formPage:v.value},null,8,["panel","module","formPage"])):h("",!0)]))),128)):h("",!0)],64))),128))],64))]),_:1}))]),P("div",_e,[P("div",pe,[T(f,{onClick:$,disabled:d.value||e.value.formSaving},{default:S(()=>[w("Reset")]),_:1},8,["disabled"]),T(f,{type:"primary",onClick:ee,disabled:d.value||e.value.formSaving,loading:e.value.formSaving},{default:S(()=>[w("Save")]),_:1},8,["disabled","loading"])])])],64)}}};export{qe as default};
