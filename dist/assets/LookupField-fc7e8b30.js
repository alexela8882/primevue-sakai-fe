import{B as Z,s as ee,a3 as te,r as n,E as le,bX as t,c as p,V as oe,W as ae,o as l,j as a,i as c,n as P,F as h,k as S,d as D,w as k,g as se,t as d,e as o,x as j,m as M,f as L,q}from"./index-6d47cf9b.js";import{h as ne}from"./Form-4b751528.js";const ce={class:"lookupField"},ie={key:1,class:"flex align-items-center",style:{width:"100%"}},ue={class:"flex justify-content-between",style:{width:"100%"}},re={class:"flex flex-colum ml-2"},pe=o("i",{class:"pi pi-times"},null,-1),de=[pe],me=o("i",{class:"pi pi-search"},null,-1),ve={class:"flex align-items-center"},_e={key:0,class:"font-medium"},fe={key:1,class:"text-sm text-color-secondary"},ge={class:"flex justify-content-center"},ye={class:"flex flex-column mt-1"},xe={__name:"LookupField",props:{field:Object},setup(z){const f=z,O=Z(),{getModules:R}=ee(O),I=te(),{fetchLookupPaginated:U}=I,{formatLookupOptions:A}=ne(),m=n({}),i=n(),x=n(""),B=n({}),F=n({}),v=n(!1),g=n(1),C=n(!0),u=n(!1),N=async e=>{v.value||(v.value=!0,b())};le(()=>{t.get(f.field,"rules.ms_pop_up",!1)&&(u.value=!0),m.value=t.find(R.value,{mainEntity:f.field.relation.entity_id.name})});const K=async e=>{g.value=e,b()},T=()=>{v.value=!1};let y=null;const b=async()=>{C.value=!0,y&&y.cancel("Previous search canceled"),y=q.CancelToken.source();try{let e=await U({fieldId:f.field.uniqueName,page:g.value,search:x.value,cancelToken:y});B.value=A(e,[],f.field),F.value=t.cloneDeep(t.get(e,"meta.pagination",{})),C.value=!1}catch(e){q.isCancel(e)?console.log("Request canceled:",e.message):console.error("Error fetching data:",e)}},W=async()=>{g.value=1,await b()},E=e=>{u.value?t.remove(i.value,function(_,V){return V==e}):i.value={}},X=e=>{u.value||T()};return(e,_)=>{const V=p("el-tag"),$=p("el-button"),G=p("el-input"),H=p("Skeleton"),J=p("Listbox"),Q=p("el-pagination"),Y=oe("click-outside");return ae((l(),a("div",ce,[c(t).isEmpty(i.value)?M("",!0):(l(),a("div",{key:0,class:P(["selectedValue",u.value?"multiple":"single flex align-items-center"]),onClick:N},[u.value?(l(!0),a(h,{key:0},S(i.value,(s,r)=>(l(),D(V,{class:"mr-1",closable:"",key:s.value,onClose:w=>E(r)},{default:k(()=>[se(d(s.value),1)]),_:2},1032,["onClose"]))),128)):(l(),a("div",ie,[o("div",{class:"material-icons text-white ml-2",style:j("background:"+c(t).get(m.value,"color","#0091D0"))},d(c(t).get(m.value,"icon","person")),5),o("div",ue,[o("span",re,d(i.value.value),1),o("span",{class:"flex flex-colum mr-2",onClick:E},de)])]))],2)),L(G,{modelValue:x.value,"onUpdate:modelValue":_[0]||(_[0]=s=>x.value=s),onClick:N,onKeyup:W,class:"lookupInput",placeholder:"Please input"},{append:k(()=>[L($,null,{default:k(()=>[me]),_:1})]),_:1},8,["modelValue"]),v.value?(l(),a("div",{key:1,class:P(["lookupOverlay p-overlaypanel p-component",{open:v.value==!0}])},[C.value?(l(!0),a(h,{key:0},S(c(t).fill(Array(10),"i"),(s,r)=>(l(),D(H,{key:r,height:"2rem",width:90,class:"m-2",borderRadius:"5px"}))),128)):(l(),D(J,{key:1,modelValue:i.value,"onUpdate:modelValue":[_[1]||(_[1]=s=>i.value=s),X],multiple:u.value,options:c(t).get(B.value,"options",[]),optionLabel:"firstName",listStyle:"max-height:300px"},{option:k(s=>[o("div",ve,[o("div",{class:"material-icons text-white mr-2",style:j("background:"+c(t).get(m.value,"color","#0091D0"))},d(c(t).get(m.value,"icon","person")),5),o("div",null,[(l(!0),a(h,null,S(s.option.poupDisplayValues,(r,w)=>(l(),a(h,{key:w},[w==0?(l(),a("span",_e,d(r),1)):(l(),a("div",fe,d(r),1))],64))),128))])])]),_:1},8,["modelValue","multiple","options"])),o("div",ge,[o("div",ye,[L(Q,{small:"",background:"",layout:"prev, pager, next","default-page-size":10,"current-page":g.value,total:c(t).get(F.value,"total",0),onCurrentChange:K},null,8,["current-page","total"])])])],2)):M("",!0)])),[[Y,T]])}}};export{xe as default};
