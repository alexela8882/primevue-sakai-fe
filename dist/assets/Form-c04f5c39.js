import{I as x,J as E,a3 as ue,B as re,K as de,a5 as ce,s as P,a as me,r as p,a7 as a,a9 as fe,E as ve,Y as ge,G as _e,c as L,o as s,j as u,e as D,d as k,w as F,F as f,k as y,i as o,m as S,S as pe,f as T,g as w}from"./index-8c23f094.js";import{v as ke}from"./Validate-e2824392.js";import{u as ye}from"./index-5cbb9eb0.js";const he={class:"relative min-h-full p-3"},Fe={class:"sticky bottom-0 right-0 py-2 surface-50"},Se={class:"flex justify-content-end gap-2 px-3 py-1"},Re={__name:"Form",props:{config:Object},setup(r){const t=r,z=x(()=>E(()=>import("./Field-49093c1b.js"),["assets/Field-49093c1b.js","assets/index-8c23f094.js","assets/index-cb49da02.css","assets/Validate-e2824392.js","assets/Editor-2f402121.js","assets/Field-30426f23.css"])),B=x(()=>E(()=>import("./FormPanel-0a972576.js"),["assets/FormPanel-0a972576.js","assets/index-8c23f094.js","assets/index-cb49da02.css","assets/FormPanel-d63a1f32.css"])),O=x(()=>E(()=>import("./QuoteLineItem-d8d02446.js"),["assets/QuoteLineItem-d8d02446.js","assets/index-8c23f094.js","assets/index-cb49da02.css"])),N=ue(),I=ye(),V=re(),j=de(),{formatLookupOptions:be,getPicklistFields:xe,getLookupFields:Ee,transformFormValues:h,transformDate:Pe,transformForSaving:W,getAllHiddenFieldsAndPanels:G,controllingFieldChecker:H,getAllDisabledFields:J,checkSetValRule:K}=ce(),{fetchPicklist:De,fetchLookup:Ne,saveForm:Q,setFormReset:A,saveFormValues:U}=N,{getCachedFormData:Y,getFormReset:q}=P(N),{getItem:b}=P(I),{fetchModuleFields:X,fetchModulePanels:Z}=V,{removeTab:$}=j,{getModuleByName:_}=P(V),{validateForm:ee,errorChecker:ae}=ke(),M=me(),le=p(a.fill(Array(10),1)),v=p(!0);p(!1);const e=p({fields:[],panels:[],values:{main:{}},lookup:{},errors:{main:{}},hidden:{fields:[],panels:[]},disabled:[],formName:t.config.name,formSaving:!1}),d=p();p([]),fe("form",e),ve(async()=>{console.log("mounted",v.value);let i=Y.value(t.config.name);if(d.value=a.includes(t.config.name,"edit")?"edit":"create",console.log("tmpData",i),i)e.value=a.merge(e.value,a.cloneDeep(i)),t.config.name==q.value&&(e.value.values.main=h(e.value.fields,b.value,d.value),A(""));else{a.isEmpty(_.value(t.config._module).fields)&&await X(t.config._module),a.isEmpty(_.value(t.config._module).panels)&&await Z(t.config._module);let c=_.value(t.config._module);e.value.fields=c.fields,e.value.panels=c.panels;let m=a.find(e.value.fields,{name:"sales_type_id"});if(m){let n=H(m,e.value.fields,_.value(t.config._module).mainEntity);console.log("form",n)}te()}v.value=!1}),ge(()=>{console.log("before unmount"),Q(e.value)}),_e(()=>q.value,(i,c)=>{i==t.config.name&&(e.value.values.main=h(t.config.module.fields),A(""))});const te=()=>{let i=a.chain(e.value.fields).filter({quick:!0}).map("_id").value(),c=h(e.value.fields,b.value,_.value(t.config._module).mainEntity,d.value),m=K(e.value.fields,c,_.value(t.config._module).mainEntity);e.value.values.main=a.merge(a.cloneDeep(c),a.cloneDeep(m)),console.log(c,m),e.value.hidden=G(e.value.panels,e.value.fields,e.value.values.main,d.value),e.value.disabled=J(e.value.fields,e.value.values.main,d.value),console.log("disabled",a.filter(e.value.fields,function(n){if(a.includes(e.value.disabled,n._id))return!0})),a.forEach(e.value.panels,function(n,l){e.value.panels[l].quick=!1,a.forEach(n.sections,function(g,R){e.value.panels[l].sections[R].quick=!1;let C=g.field_ids[0];g.field_ids.length>1&&C.concat(g.field_ids[1]),a.filter(C,function(ne){if(a.includes(i,ne))return!0}).length>0&&(e.value.panels[l].quick=!0,e.value.panels[l].sections[R].quick=!0)}),d.value=="create"&&(e.value.values[n.panelName]=[],e.value.errors[n.panelName]=[])}),console.log(v.value),console.log("done initialize")},oe=()=>{v.value=!0;let i=a.includes(t.config.name,"edit")?"edit":"create";e.value.values.main=h(e.value.fields,b.value,i),v.value=!1},ie=async()=>{let i=a.get(t.config,"maximized",!1);if(e.value.formSaving=!0,e.value.errors.main=ee(e.value.values.main,e.value.fields,i),ae(e.value.errors.main)){let m=W(e.value.values.main,e.value.fields,i);(await U(m,t.config.base_module)).status==200&&(M.add({severity:"success",summary:"Success Message",detail:"Record added",life:3e3}),e.value.formSaving=!1,se(t.config))}else M.add({severity:"error",summary:"Error Message",detail:"Please check the form again",life:3e3}),e.value.formSaving=!1},se=async i=>{await $(i)};return(i,c)=>{const m=L("Skeleton"),n=L("el-button");return s(),u(f,null,[D("div",he,[v.value?S("",!0):(s(),k(pe,{key:0},{fallback:F(()=>[(s(!0),u(f,null,y(le.value,(l,g)=>(s(),k(m,{key:g,height:"2rem",class:"mb-2",borderRadius:"16px"}))),128))]),default:F(()=>[o(a).filter(e.value.panels,{quick:!0}).length==1&&o(a).get(r.config,"maximized",!1)==!1?(s(!0),u(f,{key:0},y(o(a).filter(e.value.fields,{quick:!0}),l=>(s(),u(f,{key:l._id},[o(a).includes(e.value.hidden.fields,l._id)?S("",!0):(s(),k(o(z),{key:0,keyName:"main",config:l,module:r.config._module,formPage:d.value},null,8,["config","module","formPage"]))],64))),128)):(s(),u(f,{key:1},[(s(!0),u(f,null,y(o(a).filter(e.value.panels,function(l){if(!o(a).includes(e.value.hidden.panels,l.panelName)&&o(a).endsWith(l.controllerMethod,"@index")&&(o(a).get(r.config,"maximized",!1)==!1&&l.quick||o(a).get(r.config,"maximized",!1)==!0))return!0}),l=>(s(),k(o(B),{key:l._id,panel:l,quickAdd:!o(a).get(r.config,"maximized",!1),module:r.config._module,formPage:d.value},null,8,["panel","quickAdd","module","formPage"]))),128)),(s(!0),u(f,null,y(o(a).filter(e.value.panels,function(l){if(!o(a).includes(e.value.hidden.panels,l.panelName)&&o(a).endsWith(l.controllerMethod,"@show")&&o(a).get(r.config,"maximized",!1)==!0)return!0}),l=>(s(),u(f,{key:l._id},[o(a).includes(["SalesOpptItem"],l.entityName)?(s(!0),u(f,{key:0},y(l.sections,g=>(s(),u("div",{key:g._id,class:"flex flex-column px-1 py-2 mt-2"},[l.entityName=="SalesOpptItem"?(s(),k(o(O),{key:0,panel:l,module:r.config._module,formPage:d.value},null,8,["panel","module","formPage"])):S("",!0)]))),128)):S("",!0)],64))),128))],64))]),_:1}))]),D("div",Fe,[D("div",Se,[T(n,{onClick:oe,disabled:v.value||e.value.formSaving},{default:F(()=>[w("Reset")]),_:1},8,["disabled"]),T(n,{type:"primary",onClick:ie,disabled:v.value||e.value.formSaving,loading:e.value.formSaving},{default:F(()=>[w("Save")]),_:1},8,["disabled","loading"])])])],64)}}};export{Re as default};
