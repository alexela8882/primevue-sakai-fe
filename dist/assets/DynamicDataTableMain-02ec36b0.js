import{M as ke,O as xe,B as te,s as j,r as s,v as Q,q as Se,I as Ie,J as De,a as Ce,N as Ee,a3 as Me,a4 as Fe,a6 as Ne,G as Te,E as Le,a7 as o,a8 as W,a9 as Re,c as h,o as i,j as r,f as v,w as k,e as b,g as P,t as x,m as F,d as X,x as Z,F as G,k as ee,i as D,n as ae,T as Ve,y as je}from"./index-2f40471b.js";import{v as Be}from"./Validate-1e200014.js";const Oe=ke("moduleDynamicTableStore",()=>{const u=xe(),C=te(),{jsonDbUrl:d}=j(u);j(C);const N=s(!1),y=s([]),B=Q(()=>y.value),T=Q(()=>a=>{const w=y.value.find(L=>L.module===a);return w?w.content:null});return{getDropdownLists:B,getDropdown:T,fetchDropdownLists:async a=>{N.value=!0;const w=await Se(`${d.value}/${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(w.status===200&&w.data&&!y.value.find(S=>S.module===a)){let S=Object.assign({},{module:a,content:w.data});y.value.push(S)}N.value=!1}}});const ze={key:0,style:{"white-space":"normal"}},Ae=["onDblclick"],Ue={key:0},$e={key:0},Pe={key:0,class:"mr-1"},Ge={key:1,class:"mr-1"},Je={key:2,class:"mr-1"},qe={key:1},He={key:1,class:"edit-icon cursor-pointer pi pi-pencil ml-3"},Ye={key:2,class:"edit-icon cursor-pointer pi pi-lock ml-3"},Ke={key:0,class:"md:flex justify-content-between font-light"},Qe={class:"flex align-items-center px-3"},We={class:"text-sm text-color-secondary"},Xe={class:"text-sm text-color-secondary"},Ze=b("div",{class:"text-700"}," No records found ",-1),ea={style:{overflow:"scroll","max-height":"100%"}},aa=b("div",{class:"ddt-div-1 shadow-4 bg-white"},null,-1),ta={key:0,style:{width:"100vw",position:"fixed",bottom:"0",left:"0",height:"54px","text-align":"center","margin-left":"90px",padding:"12px"},class:"shadow-2 align-items-center"},ia={__name:"DynamicDataTableMain",props:{mode:String,sidebar:Boolean,moduleId:String,moduleEntityName:String,moduleName:String,modulePermissions:{type:Array,default:[]},moduleLabel:String,data:Array,pagination:Object,pageItems:Array,rows:Number,pages:Number,viewFilter:Object,fields:Array,collectionLoading:Boolean},emits:["toggle-sidebar","paginate","limit-page"],setup(u,{emit:C}){const d=u,N=Ie(()=>De(()=>import("./Field-ab9c6920.js"),["assets/Field-ab9c6920.js","assets/index-2f40471b.js","assets/index-d5e7f8f7.css","assets/Validate-1e200014.js","assets/Editor-8de1aada.js","assets/Field-30426f23.css"])),y=s([]);if(d.viewFilter){let e=Object.assign({},{field:d.viewFilter.sortField,order:d.viewFilter.sortOrder=="ASC"?1:-1});y.value.push(e)}const B=Ce();s(),s(0);const T=s(null),O=s(null);s(!1);const a=s({rowId:null,field:null,rowIndex:null,columnIndex:null});Ee();const w=s(),L=s(),S=s();s(),s();const J=s(),R=s(),q=s(),le=te(),oe=Me(),se=Oe(),{getModule:H,getCollection:la,getBaseModule:E,getEntity:oa}=j(le),{massUpdateRecords:ne}=oe;j(se);const{validateField:ie,errorChecker:ue}=Be(),{transformLookupValue:z,transformFieldForSaving:de}=Fe();s([{label:"View",icon:"pi pi-fw pi-search",command:()=>console.log(R.value)},{label:"Delete",icon:"pi pi-fw pi-times",command:()=>console.log(R.value)}]);const re=s([{label:"View",icon:"pi pi-reply",command:e=>{if(d.modulePermissions.includes("show")){const t=Object.assign({},{name:"modules.pages.detail",params:{name:d.moduleName,id:d.moduleId,pageid:q.value._id}});Ne.push(t)}else B.add({severity:"warn",summary:"Attention",detail:"You don't have permission please contact administrator.",life:1e4})}},{label:"Change Owner",icon:"pi pi-user",command:e=>{},visible:d.moduleEntityName===E.value.mainEntity},{label:"Update",icon:"pi pi-refresh",disabled:!d.modulePermissions.includes("update"),command:e=>{},visible:d.moduleEntityName===E.value.mainEntity},{label:"Delete",icon:"pi pi-times",disabled:!d.modulePermissions.includes("delete"),command:e=>{},visible:d.moduleEntityName===E.value.mainEntity}]),ce=s([{label:"10",value:10},{label:"15",value:15},{label:"20",value:20},{label:"25",value:25},{label:"30",value:30},{label:"35",value:35},{label:"40",value:40},{label:"45",value:45},{label:"50",value:50}]),n=s({values:{},errors:{}}),f=s({}),g=s(),Y=s(["owner_id","created_at","updated_at","created_by","updated_by"]),me=async(e,t,c)=>{C("paginate",{event:e,jump:t,per_page:c})},pe=async e=>{C("limit-page",e)},ve=e=>{},ge=(e,t)=>{S.value.toggle(e),q.value=t},fe=(e,t,c)=>{if(console.log(e),!o.includes(Y.value,t.name)&&(a.value.rowId=e.data._id,a.value.rowIndex=e.index,a.value.columnIndex=c,a.value.field=t,!o.has(n.value.values,e.data._id))){let m=o.cloneDeep(e.data);t.field_type.name=="lookupModel"&&(m[t.name]=z(m[t.name],t)),n.value.values[e.data._id]=o.cloneDeep(m),n.value.errors[e.data._id]={},n.value.errors[e.data._id][e.field]=[]}},be=()=>{f.value={},n.value={},g.value=o.cloneDeep(d.data)};Te(()=>d.data,(e,t)=>{g.value=e}),Le(async()=>{g.value=o.cloneDeep(d.data),console.log(g.value)}),W(T,e=>{if(e.target){if(e.target.attributes.class&&(e.target.attributes.class.value==="p-dropdown-item"||e.target.attributes.class.value==="p-dropdown-filter p-inputtext p-component"||e.target.attributes.class.value==="p-checkbox-box"||e.target.attributes.class.value==="p-checkbox-box p-focus"||e.target.attributes.class.value==="p-icon p-checkbox-icon undefined"||e.target.attributes.class.value==="p-multiselect-header"||e.target.attributes.class.value==="p-multiselect-empty-message"||e.target.attributes.class.value==="p-icon p-multiselect-close-icon"||e.target.attributes.class.value==="p-multiselect-close p-link"||e.target.attributes.class.value==="p-datepicker-other-month"||e.target.attributes.class.value==="p-datepicker-header"||e.target.attributes.class.value==="p-monthpicker-month"||e.target.attributes.class.value==="p-datepicker-month p-link"||e.target.attributes.class.value==="p-yearpicker-year"||e.target.attributes.class.value==="p-datepicker-year p-link"||e.target.attributes.class.value==="p-icon p-datepicker-prev-icon"||e.target.attributes.class.value==="p-icon p-datepicker-next-icon"||e.target.attributes.class.value==="p-datepicker-prev p-link"||e.target.attributes.class.value==="p-datepicker-next p-link"||e.target.attributes.class.value==="p-datepicker p-component p-ripple-disabled"||e.target.attributes.class.value==="p-datepicker-group")||e.target.attributes["data-pc-section"]&&(e.target.attributes["data-pc-section"].value==="item"||e.target.attributes["data-pc-section"].value==="filterinput"||e.target.attributes["data-pc-section"].value==="option"||e.target.attributes["data-pc-section"].value==="daylabel"))return;C("toggle-sidebar",!1)}}),document.addEventListener("keydown",function(e){e.key==="Escape"&&(console.log("Escape key pressed",e),A())}),W(O,e=>{let t=o.get(e,"target.classList",[]);console.log(e.target.parentElement.className,t),!o.includes(t,"p-inputtext")&&!o.includes(t,"el-input__inner")&&!o.includes(t,"el-select-dropdown__ite")&&!o.includes(t,"fieldInputSelection")&&!o.includes(t,"lookupSelected")&&!o.includes(t,"lookupInput")&&!o.includes(t,"lookupRemoveBtn")&&!o.includes(t,"lookupSelection")&&e.target.parentElement.className!="el-icon el-select__caret el-select__icon"?(console.log("click outside"),A()):console.log("clicked inside field")});const A=()=>{if(a.value.rowId!=null){let e=o.find(H.value.fields,{name:a.value.field.name});if(console.log(n.value.values[a.value.rowId][a.value.field.name]),n.value.errors[a.value.rowId][a.value.field.name]=ie(n.value.values[a.value.rowId],e,H.value.fields),ue(n.value.errors[a.value.rowId])){let c=o.findIndex(g.value,{_id:a.value.rowId}),m=n.value.values[a.value.rowId][a.value.field.name],_=g.value[c][a.value.field.name];a.value.field.field_type.name=="picklist"?m=o.isArray(n.value.values[a.value.rowId][a.value.field.name])?o.join(o.map(n.value.values[a.value.rowId][a.value.field.name],"value"),", "):n.value.values[a.value.rowId][a.value.field.name].value:a.value.field.field_type.name=="lookupModel"&&(m=z(n.value.values[a.value.rowId][a.value.field.name],a.value.field,!0),_=z(g.value[c][a.value.field.name],a.value.field,!0)),m!=_&&(console.log(a.value.field,m,_),a.value.field.field_type.name=="picklist"?(console.log("picklist changed",n.value.values[a.value.rowId][a.value.field.name].value),g.value[c][a.value.field.name]=n.value.values[a.value.rowId][a.value.field.name].value):g.value[c][a.value.field.name]=n.value.values[a.value.rowId][a.value.field.name],o.has(f.value,a.value.rowId)?o.has(f.value[a.value.rowId],a.value.field.name)||f.value[a.value.rowId].push(a.value.field.name):f.value[a.value.rowId]=[a.value.field.name]),a.value={rowId:null,field:null,rowIndex:null,columnIndex:null}}}},ye=s(!1),we=async()=>{ye.value=!0;let e=o.reduce(f.value,function(c,m,_){let V={_id:_};return o.forEach(m,function(M){V[M]=de(n.value.values[_][M],o.find(d.fields,{name:M}))}),c.push(V),c},[]);(await ne(e,E.value.name)).status==200&&(f.value={},n.value={values:{},errors:{}})};return Re("form",n),(e,t)=>{const c=h("Column"),m=h("Button"),_=h("Menu"),V=h("Dropdown"),M=h("Divider"),_e=h("Paginator"),he=h("DataTable"),K=h("el-button");return i(),r(G,null,[v(he,{selection:J.value,"onUpdate:selection":t[3]||(t[3]=l=>J.value=l),contextMenuSelection:R.value,"onUpdate:contextMenuSelection":t[4]||(t[4]=l=>R.value=l),multiSortMeta:y.value,"onUpdate:multiSortMeta":t[5]||(t[5]=l=>y.value=l),onRowContextmenu:ve,tableClass:"editable-cells-table module-table",value:g.value,loading:u.collectionLoading,stripedRows:"",resizableColumns:"",columnResizeMode:"fit",sortMode:"multiple",removableSort:"",scrollable:"",scrollHeight:"60vh",class:"dynamic-tbl",style:{"min-height":"60vh !important"}},{footer:k(()=>[u.pagination?(i(),r("div",Ke,[b("div",Qe,[b("div",We,[P(" Items per page: "),v(V,{onChange:t[0]||(t[0]=l=>pe(l)),modelValue:u.pagination.per_page,"onUpdate:modelValue":t[1]||(t[1]=l=>u.pagination.per_page=l),options:ce.value,optionLabel:"label",optionValue:"value",placeholder:"Select a page",class:"filled-dropdown"},null,8,["modelValue","options"])]),v(M,{type:"solid",layout:"vertical"}),b("div",Xe,x(u.pagination.current_page)+" - "+x(u.pagination.total_pages)+" of "+x(u.pagination.total)+" items ",1)]),v(_e,{onPage:t[2]||(t[2]=l=>me(l,!1,u.pagination.per_page)),template:"JumpToPageDropdown PrevPageLink NextPageLink",rows:u.pagination&&u.pagination.per_page,totalRecords:u.pagination&&u.pagination.total,rowsPerPageOptions:[5,10,15,20,25,30],class:"custom-paginator"},null,8,["rows","totalRecords"])])):F("",!0)]),empty:k(()=>[Ze]),default:k(()=>[u.mode==="edit"?(i(),X(c,{key:0,frozen:"",headerClass:"custom-header bg-primary-100 text-color-secondary",style:Z(`min-width: 60px; ${w.value}`),bodyClass:"text-center py-1",selectionMode:"multiple"},null,8,["style"])):F("",!0),(i(!0),r(G,null,ee(u.fields,(l,U)=>(i(),X(c,{key:l._id,field:l.name,header:l.label,sortable:"",sorticon:"check",style:{"min-width":"200px !important"},bodyClass:`text-color-secondary ${l.field_type.name=="lookupModel"?"lookupColumn":""}`,headerClass:"bg-primary-100 text-color-secondary"},{body:k(p=>[a.value.rowId==p.data._id&&a.value.field.name==p.field?(i(),r("div",ze,[v(D(N),{ref_for:!0,ref_key:"fieldEditingRef",ref:O,config:l,keyName:p.data._id,inline:!0,type:"tableForm",module:D(E).name,onChangeValue:A},null,8,["config","keyName","module"])])):(i(),r("div",{key:1,class:ae(["py-2",{"cell-edited":D(o).find(f.value,function(I,$){if($==p.data._id&&D(o).includes(I,l.name))return!0})}]),onDblclick:I=>fe(p,l,U)},[b("div",{class:ae(["flex align-items-center px-2",p.data[l.name]?"justify-content-between":"justify-content-end"])},[p.data[l.name]?(i(),r("div",Ue,[l.relation?(i(),r("span",$e,[(i(!0),r(G,null,ee(l.relation.displayFieldName,(I,$)=>(i(),r("span",{key:$},[l.rules.ss_pop_up?(i(),r("span",Pe,x(p.data[l.name][I]),1)):l.rules.ss_dropdown?(i(),r("span",Ge,[b("span",null,x(p.data[l.name][I]),1)])):(i(),r("span",Je,[b("span",null,x(p.data[l.name][I]),1)]))]))),128))])):(i(),r("span",qe,x(p.data[l.name]),1))])):F("",!0),D(o).includes(Y.value,l.name)?(i(),r("i",Ye)):(i(),r("i",He))],2)],42,Ae))]),_:2},1032,["field","header","bodyClass"]))),128)),v(c,{frozen:"",alignFrozen:"right",exportable:!1,style:Z(`min-width: 60px; ${L.value}`),bodyClass:"text-color-secondary text-center py-1",headerClass:"bg-primary-100 text-color-secondary"},{body:k(l=>[v(m,{class:"menu-btn",icon:"pi pi-ellipsis-v",text:"",size:"small",onClick:U=>ge(U,l.data),"aria-haspopup":"true","aria-controls":"overlay_menu",style:{"font-size":".3rem",padding:"2px 0","background-color":"transparent"}},null,8,["onClick"]),v(_,{ref_key:"menu",ref:S,id:"overlay_menu","data-value":l,model:re.value,popup:!0},null,8,["data-value","model"])]),_:1},8,["style"]),v(Ve,{name:"lvf-slide-fade"},{default:k(()=>[u.sidebar?(i(),r("div",{key:0,ref_key:"listViewFilterRef",ref:T,class:"ddt-slot-1 shadow-4 bg-white"},[b("div",ea,[je(e.$slots,"list-view-filter")]),aa],512)):F("",!0)]),_:3})]),_:3},8,["selection","contextMenuSelection","multiSortMeta","value","loading"]),D(o).isEmpty(f.value)?F("",!0):(i(),r("div",ta,[v(K,{onClick:be},{default:k(()=>[P("Cancel")]),_:1}),v(K,{type:"primary",onClick:we},{default:k(()=>[P("Save")]),_:1})]))],64)}}};export{ia as default};
