import{r as V,B as I,s as K,E as R,G as z,c as S,o as k,j as P,e,f as g,aa as F,i as l,t as u,m as A,n as X,w as D,g as Y,d as q,p as se}from"./index-8c23f094.js";import{u as Z,a as ee,c as T,b as le}from"./index.esm-6698ba71.js";const ie={class:"flex flex-column gap-4"},ae={class:"mt-4 flex justify-content-between"},oe={class:"p-float-label"},de=e("label",null,"Filter name *",-1),ne={class:"p-error text-sm my-2"},re={key:0,class:"hidden"},ce={class:"p-float-label"},ue=e("label",null,"View filters",-1),me={class:"flex align-items-center justify-content-between"},pe={class:"flex align-items-center gap-2"},be={class:"p-float-label"},ve=e("label",null,"Sort field *",-1),ge={class:"p-error text-sm my-2"},_e={class:"p-float-label"},fe=e("label",null,"Sort order *",-1),we={class:"p-error text-sm my-2"},Ve={class:"p-float-label"},ye=e("label",null,"Items per page *",-1),Fe={class:"p-error text-sm my-2"},Se={class:"flex flex-wrap p-2 align-items-center gap-3"},he={class:"flex-1 flex flex-column gap-2"},xe={class:"font-bold"},$e={__name:"TableSettings",props:{mode:String,baseModule:Object,module:Object,selectedViewFilter:String,saveTrigger:Number},setup(i){const s=i,m=V(!1),p=V(null),{values:O,errors:a,defineComponentBinds:r,isSubmitting:h,setFieldValue:o,handleSubmit:M}=Z({validationSchema:ee({filterName:T().label("Filter name").required(),sortField:T().label("Sort field").required(),sortOrder:T().label("Sort order").required(),pageSize:T().label("Items per page").required(),pickList:le().label("Pick list fields").min(1,"Please add at least 1 field").required()})}),f=V(null),w=r("filterName"),c=r("sortField"),y=r("sortOrder"),x=r("pageSize");r("pickList");const _=I(),{viewFiltersDialogLoading:B,viewFiltersDialog:E,viewFilterData:G,perPageItems:U,getBaseModule:N,_getDefaultViewFilter:H,__getViewFilter:J,_getViewFilters:C,getViewFilters:Q,getReconstructedViewFilter:W}=K(_),{addViewFilter:j}=_,n=M(async t=>{B.value=!0;const d=Object.assign({},{mode:s.mode,baseModule:s.baseModule,viewFilter:s.selectedViewFilter,type:"table",data:t});await j(d),B.value=!1,E.value=!1}),b=t=>{console.log(t),o("filterName",t.filterName),o("sortField",t.sortField?t.sortField:"created_at"),o("sortOrder",t.sortOrder),o("pageSize",t.pageSize?t.pageSize:15);const d=s.module.fields.filter(v=>!t.fields.some($=>$._id===v._id));p.value=[d,t.fields],o("pickList",t.fields.map(v=>v._id))};return R(()=>{B.value=!1,f.value=s.selectedViewFilter,s.mode==="new"?(p.value=[s.module.fields,[]],o("pageSize",15),o("sortOrder","ASC"),o("sortField","created_at")):s.mode==="edit-table"&&b(H.value(s.module))}),z(p,(t,d)=>{G.value.data.fields=t[1].map(v=>v._id),m.value&&o("pickList",t[1].map(v=>v._id))}),z(f,(t,d)=>{if(s.mode==="edit-table"){const v=J.value(t,s.module);b(v)}}),z(()=>s.saveTrigger,(t,d)=>{n()}),(t,d)=>{const v=S("InputText"),$=S("Dropdown"),te=S("PickList");return k(),P("form",ie,[e("div",ae,[e("div",null,[e("span",oe,[g(v,F(l(w),{class:`${l(a).filterName?"p-invalid":"border-primary"}`,style:{"min-width":"50vh"}}),null,16,["class"]),de]),e("div",ne,u(l(a).filterName||" "),1)]),i.mode==="edit-table"?(k(),P("div",re,[e("span",ce,[g($,{modelValue:f.value,"onUpdate:modelValue":d[0]||(d[0]=L=>f.value=L),options:l(C)(i.module),optionLabel:"filterName",optionValue:"_id",class:"w-full md:w-16rem mr-2"},null,8,["modelValue","options"]),ue])])):A("",!0)]),e("div",me,[e("div",pe,[e("div",null,[e("span",be,[g($,F(l(c),{options:i.module.fields,optionLabel:"label",optionValue:"name",dataKey:"_id",filter:"",class:["w-full md:w-12rem mr-2",`${l(a).sortField?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),ve]),e("div",ge,u(l(a).sortField||" "),1)]),e("div",null,[e("span",_e,[g($,F(l(y),{options:[{label:"Ascending",value:"ASC"},{label:"Descending",value:"DESC"}],optionLabel:"label",optionValue:"value",class:["w-full md:w-12rem mr-2",`${l(a).sortOrder?"p-invalid":"border-primary"}`]}),null,16,["class"]),fe]),e("div",we,u(l(a).sortOrder||" "),1)])]),e("div",null,[e("span",Ve,[g($,F(l(x),{options:l(U),optionLabel:"label",optionValue:"value",class:["w-full md:w-12rem mr-2",`${l(a).pageSize?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),ye]),e("div",Fe,u(l(a).pageSize||" "),1)])]),e("div",{class:X(["border-1 border-round-md p-4",`${l(a).pickList?"border-red-600":"border-primary"}`])},[e("div",{class:X(["text-sm mb-4",{"p-error":l(a).pickList}])},u(l(a).pickList||"View filter fields"),3),g(te,{modelValue:p.value,"onUpdate:modelValue":d[1]||(d[1]=L=>p.value=L),onSelectionChange:d[2]||(d[2]=L=>m.value=!0),responsive:"",listStyle:"height:342px",dataKey:"_id"},{sourceheader:D(()=>[Y(" Available Fields ")]),targetheader:D(()=>[Y(" Visible Fields ")]),item:D(L=>[e("div",Se,[e("div",he,[e("span",xe,u(L.item.label),1)])])]),_:1},8,["modelValue"])],2)])}}},Le={class:"flex flex-column gap-4"},ke={class:"flex flex-column gap-4 mx-auto mt-6"},De={class:"p-float-label"},Te=e("label",null,"Titles",-1),ze={class:"p-error text-sm my-2"},Me={class:"p-float-label"},Be=e("label",null,"Summarize By",-1),Oe={class:"p-error text-sm my-2"},Ne={class:"p-float-label"},Ce=e("label",null,"Group By *",-1),je={class:"p-error text-sm my-2"},qe={__name:"KanbanSettings",props:{mode:String,baseModule:Object,module:Object,selectedViewFilter:String,saveTrigger:Number},setup(i){const s=i,m=V(),p=V(null),{values:O,errors:a,defineComponentBinds:r,isSubmitting:h,setFieldValue:o,handleSubmit:M}=Z({validationSchema:ee({group_by:T().label("Group By").required(),title_ids:le().label("Titles").required()})}),f=r("title_ids"),w=r("summarize_by"),c=r("group_by"),y=I(),{viewFiltersDialogLoading:x,viewFiltersDialog:_,viewFilterData:B,perPageItems:E,getBaseModule:G,getDefaultViewFilter:U,__getViewFilter:N,_getViewFilters:H,getViewFilters:J,getReconstructedViewFilter:C}=K(y),{addViewFilter:Q}=y,W=M(async n=>{_.value=!1;const b=Object.assign({},{baseModule:s.baseModule,viewFilter:s.selectedViewFilter,type:"kanban",data:n});await Q(b),x.value=!1,_.value=!1}),j=n=>{let b=[];n.title_ids&&n.title_ids.length>0?b=n.title_ids:b=m.value.filter(t=>t.title).map(t=>t._id),o("title_ids",b),o("summarize_by",n.summarize_by),o("group_by",n.group_by)};return R(()=>{x.value=!1,p.value=s.selectedViewFilter;const n=N.value(s.selectedViewFilter,s.module);m.value=n.fields}),z(p,(n,b)=>{const t=N.value(n,s.module);j(C.value(t))}),z(()=>s.saveTrigger,(n,b)=>{W()}),(n,b)=>{const t=S("MultiSelect"),d=S("Dropdown");return k(),P("div",Le,[e("div",ke,[e("div",null,[e("span",De,[g(t,F(l(f),{options:m.value,optionLabel:"label",optionValue:"_id",filter:"",mutiple:"",class:["w-full md:w-22rem mr-2",`${l(a).title_ids?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),Te]),e("div",ze,u(l(a).title_ids||" "),1)]),e("div",null,[e("span",Me,[g(d,F(l(w),{options:m.value,optionLabel:"label",optionValue:"name",filter:"",class:["w-full md:w-22rem mr-2",`${l(a).summarize_by?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),Be]),e("div",Oe,u(l(a).summarize_by||" "),1)]),e("div",null,[e("span",Ne,[g(d,F(l(c),{options:m.value,optionLabel:"label",optionValue:"_id",filter:"",class:["w-full md:w-22rem mr-2",`${l(a).group_by?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),Ce]),e("div",je,u(l(a).group_by||" "),1)])])])}}};const Pe={class:"flex align-items-center text-2xl"},Ae={class:"material-icons mr-2"},Ie={class:"flex align-items-center justify-content-end my-2"},Ee={__name:"ViewFiltersDialogMain",props:{mode:String,selectedViewFilter:String,module:Object},setup(i){const s=i,m=V(0),p=V(0),O=V(!1),a=I(),{viewFiltersDialogLoading:r,viewFiltersDialog:h,getBaseModule:o,getViewFilters:M}=K(a),f=()=>{s.mode==="new"||s.mode==="edit-table"?m.value++:s.mode==="edit-kanban"&&p.value++};return R(()=>{}),(w,c)=>{const y=S("Button"),x=S("Dialog");return k(),q(x,{visible:l(h),"onUpdate:visible":c[3]||(c[3]=_=>se(h)?h.value=_:null),modal:"",maximizable:"",style:{width:"70vw"},class:"view-filter-dialog"},{header:D(()=>[e("div",Pe,[e("div",Ae,u(i.mode==="edit-table"?"table_chart":"view_kanban"),1),e("div",null,u(i.mode==="edit-table"||i.mode==="new"?"Table":"Kanban")+" Settings — "+u(l(o).label),1)])]),footer:D(()=>[e("div",Ie,[g(y,{onClick:c[2]||(c[2]=_=>h.value=!1),outlined:"",disabled:O.value||l(r),label:"Cancel",class:"border-round-3xl py-2 px-4 border-color-primary",size:"small"},null,8,["disabled"]),g(y,{onClick:f,disabled:l(r),loading:l(r),label:"Save",class:"reddot-primary border-round-3xl py-2 px-4 text-surface-50"},null,8,["disabled","loading"])])]),default:D(()=>[i.mode==="new"||i.mode==="edit-table"?(k(),q($e,{key:0,mode:i.mode,baseModule:l(o),module:i.module,selectedViewFilter:i.selectedViewFilter,saveTrigger:m.value,onSaveLoading:c[0]||(c[0]=_=>w.saveLoad(w.payload))},null,8,["mode","baseModule","module","selectedViewFilter","saveTrigger"])):A("",!0),i.mode==="edit-kanban"?(k(),q(qe,{key:1,mode:i.mode,baseModule:l(o),module:i.module,selectedViewFilter:i.selectedViewFilter,saveTrigger:p.value,onSaveLoading:c[1]||(c[1]=_=>w.saveLoad(w.payload))},null,8,["mode","baseModule","module","selectedViewFilter","saveTrigger"])):A("",!0)]),_:1},8,["visible"])}}};export{Ee as default};
