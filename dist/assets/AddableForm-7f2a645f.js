import{a3 as ae,B as le,K as se,a4 as te,s as E,a as oe,r as m,a8 as a,aa as ie,E as re,c as D,o as t,j as c,e as y,d as k,w as _,F as f,k as S,i as o,m as A,S as ue,f as q,g as V,I as C,J as M}from"./index-b43f83a8.js";import{v as ne}from"./Validate-c6556af2.js";import{u as de}from"./index-d3eb398d.js";const me={class:"relative min-h-full p-3"},ce={class:"sticky bottom-0 right-0 py-2 surface-50"},fe={class:"flex justify-content-end gap-2 px-3 py-1"},be={__name:"AddableForm",props:{moduleName:String,formPage:String},emits:["close"],setup(n,{emit:x}){const L=C(()=>M(()=>import("./Field-c7122498.js"),["assets/Field-c7122498.js","assets/index-b43f83a8.js","assets/index-40ff91a8.css","assets/Validate-c6556af2.js","assets/Editor-5af227ca.js","assets/Field-30426f23.css"])),B=C(()=>M(()=>import("./FormPanel-5ef18d5d.js"),["assets/FormPanel-5ef18d5d.js","assets/index-b43f83a8.js","assets/index-40ff91a8.css","assets/FormPanel-d63a1f32.css"])),s=n,R=x,T=ae(),w=de(),F=le();se();const{formatLookupOptions:ve,getPicklistFields:ge,getLookupFields:pe,transformFormValues:O,transformDate:ke,transformForSaving:j,getAllHiddenFieldsAndPanels:z,controllingFieldChecker:_e,getAllDisabledFields:H,checkSetValRule:J}=te(),{fetchPicklist:he,fetchLookup:ye,saveQuickAdd:K}=T,{getItem:Q}=E(w),{fetchModuleFields:W,fetchModulePanels:G}=F,{getModuleByName:i}=E(F),{validateForm:I,errorChecker:U}=ne(),P=oe(),X=m(a.fill(Array(10),1)),v=m(!0);m(!1);const e=m({fields:[],panels:[],values:{main:{}},lookup:{},errors:{main:{}},hidden:{fields:[],panels:[]},disabled:[],formSaving:!1});m([]),ie("form",e),re(async()=>{a.isEmpty(i.value(s.moduleName).fields)&&await W(i.value(s.moduleName).mainEntity),a.isEmpty(i.value(s.moduleName).panels)&&await G(s.moduleName);let r=a.cloneDeep(i.value(s.moduleName));e.value.fields=r.fields,e.value.panels=r.panels,Y(),v.value=!1});const Y=()=>{let r=a.chain(e.value.fields).filter({quick:!0}).map("_id").value(),g=s.formPage=="create"?null:Q.value,d=O(e.value.fields,g,s.formPage),p=J(e.value.fields,d,i.value(s.moduleName).mainEntity);e.value.values.main=a.merge(a.cloneDeep(d),a.cloneDeep(p)),e.value.hidden=z(e.value.panels,e.value.fields,e.value.values.main,s.formPage),e.value.disabled=H(e.value.fields,e.value.values.main,s.formPage),a.forEach(e.value.panels,function(l,u){e.value.panels[u].quick=!1,a.forEach(l.sections,function(h,N){e.value.panels[u].sections[N].quick=!1;let b=h.field_ids[0];h.field_ids.length>1&&b.concat(h.field_ids[1]),a.filter(b,function(ee){if(a.includes(r,ee))return!0}).length>0&&(e.value.panels[u].quick=!0,e.value.panels[u].sections[N].quick=!0)}),s.formPage=="create"&&(e.value.values[l.panelName]=[],e.value.errors[l.panelName]=[])})},Z=async()=>{if(e.value.formSaving=!0,e.value.errors.main=I(e.value.values.main,e.value.fields,!1),U(e.value.errors.main)){let g=j(e.value.values.main,e.value.fields,!1);(await K(g,i.value(s.moduleName))).status==200&&(P.add({severity:"success",summary:"Success Message",detail:"Record added",life:3e3}),e.value.formSaving=!1)}else P.add({severity:"error",summary:"Error Message",detail:"Please check the form again",life:3e3}),e.value.formSaving=!1},$=()=>{R("close")};return(r,g)=>{const d=D("Skeleton"),p=D("el-button");return t(),c(f,null,[y("div",me,[v.value?A("",!0):(t(),k(ue,{key:0},{fallback:_(()=>[(t(!0),c(f,null,S(X.value,(l,u)=>(t(),k(d,{key:u,height:"2rem",class:"mb-2",borderRadius:"16px"}))),128))]),default:_(()=>[o(a).filter(e.value.panels,{quick:!0}).length==1?(t(!0),c(f,{key:0},S(o(a).filter(e.value.fields,{quick:!0}),l=>(t(),c(f,{key:l._id},[o(a).includes(e.value.hidden.fields,l._id)?A("",!0):(t(),k(o(L),{key:0,keyName:"main",config:l,module:n.moduleName,formPage:n.formPage},null,8,["config","module","formPage"]))],64))),128)):(t(!0),c(f,{key:1},S(o(a).filter(e.value.panels,function(l){if(!o(a).includes(e.value.hidden.panels,l.panelName)&&o(a).endsWith(l.controllerMethod,"@index")&&l.quick)return!0}),l=>(t(),k(o(B),{key:l._id,panel:l,quickAdd:!0,module:n.moduleName,formPage:n.formPage},null,8,["panel","module","formPage"]))),128))]),_:1}))]),y("div",ce,[y("div",fe,[q(p,{onClick:$,disabled:v.value||e.value.formSaving},{default:_(()=>[V("Cancel")]),_:1},8,["disabled"]),q(p,{type:"primary",onClick:Z,disabled:v.value||e.value.formSaving,loading:e.value.formSaving},{default:_(()=>[V("Save")]),_:1},8,["disabled","loading"])])])],64)}}};export{be as default};
