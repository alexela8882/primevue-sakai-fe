import{I as P,J as D,a3 as re,B as de,K as ce,a5 as me,s as E,a as fe,r as _,a7 as a,a9 as ve,E as ge,Y as _e,G as pe,c as T,o as i,j as u,e as N,d as k,w as F,F as c,k as y,i as t,m as S,S as ke,f as w,g as z}from"./index-557ccd93.js";import{v as ye}from"./Validate-390cd3ee.js";import{u as he}from"./index-e8729e86.js";const Fe={class:"relative min-h-full p-3"},Se={class:"sticky bottom-0 right-0 py-2 surface-50"},be={class:"flex justify-content-end gap-2 px-3 py-1"},Ce={__name:"Form",props:{config:Object},setup(r){const o=r,B=P(()=>D(()=>import("./Field-fbc85af7.js"),["assets/Field-fbc85af7.js","assets/index-557ccd93.js","assets/index-cb49da02.css","assets/Validate-390cd3ee.js","assets/Editor-faad0546.js","assets/Field-30426f23.css"])),O=P(()=>D(()=>import("./FormPanel-2fd70636.js"),["assets/FormPanel-2fd70636.js","assets/index-557ccd93.js","assets/index-cb49da02.css","assets/FormPanel-d63a1f32.css"])),I=P(()=>D(()=>import("./QuoteLineItem-3fb4901a.js"),["assets/QuoteLineItem-3fb4901a.js","assets/index-557ccd93.js","assets/index-cb49da02.css"])),V=re(),j=he(),A=de(),W=ce(),{formatLookupOptions:xe,getPicklistFields:Pe,getLookupFields:De,transformFormValues:h,transformDate:Ee,transformForSaving:G,getAllHiddenFieldsAndPanels:H,controllingFieldChecker:J,getAllDisabledFields:K,checkSetValRule:Q}=me(),{fetchPicklist:Ne,fetchLookup:Ve,saveForm:U,setFormReset:q,saveFormValues:Y}=V,{getCachedFormData:X,getFormReset:M}=E(V),{getItem:b}=E(j),{fetchModuleFields:Z,fetchModulePanels:$}=A,{removeTab:ee}=W,{getModuleByName:p}=E(A),{validateForm:ae,errorChecker:le}=ye(),R=fe(),te=_(a.fill(Array(10),1)),m=_(!0);_(!1);const e=_({fields:[],panels:[],values:{main:{}},lookup:{},errors:{main:{}},hidden:{fields:[],panels:[]},disabled:[],formName:o.config.name,formSaving:!1}),n=_();_([]),ve("form",e),ge(async()=>{console.log("mounted",m.value);let s=X.value(o.config.name);if(n.value=a.includes(o.config.name,"edit")?"edit":"create",console.log("tmpData",s),s)e.value=a.merge(e.value,a.cloneDeep(s)),o.config.name==M.value&&(e.value.values.main=h(e.value.fields,b.value,n.value),q(""));else{a.isEmpty(p.value(o.config._module).fields)&&await Z(o.config._module),a.isEmpty(p.value(o.config._module).panels)&&await $(o.config._module);let v=p.value(o.config._module);e.value.fields=v.fields,e.value.panels=v.panels;let d=a.find(e.value.fields,{name:"sales_type_id"});if(d){let g=J(d,e.value.fields,p.value(o.config._module).mainEntity);console.log("form",g)}oe()}m.value=!1}),_e(()=>{console.log("before unmount"),U(e.value)}),pe(()=>M.value,(s,v)=>{s==o.config.name&&(e.value.values.main=h(o.config.module.fields),q(""))});const oe=()=>{let s=a.chain(e.value.fields).filter({quick:!0}).map("_id").value(),v=n.value=="create"?null:b.value,d=h(e.value.fields,v,n.value),g=Q(e.value.fields,d,p.value(o.config._module).mainEntity);e.value.values.main=a.merge(a.cloneDeep(d),a.cloneDeep(g)),e.value.hidden=H(e.value.panels,e.value.fields,e.value.values.main,n.value),e.value.disabled=K(e.value.fields,e.value.values.main,n.value),a.forEach(e.value.panels,function(l,f){e.value.panels[f].quick=!1,a.forEach(l.sections,function(x,C){e.value.panels[f].sections[C].quick=!1;let L=x.field_ids[0];x.field_ids.length>1&&L.concat(x.field_ids[1]),a.filter(L,function(ue){if(a.includes(s,ue))return!0}).length>0&&(e.value.panels[f].quick=!0,e.value.panels[f].sections[C].quick=!0)}),n.value=="create"&&(e.value.values[l.panelName]=[],e.value.errors[l.panelName]=[])}),console.log(m.value),console.log("done initialize")},se=()=>{m.value=!0;let s=a.includes(o.config.name,"edit")?"edit":"create";e.value.values.main=h(e.value.fields,b.value,s),m.value=!1},ie=async()=>{let s=a.get(o.config,"maximized",!1);if(e.value.formSaving=!0,e.value.errors.main=ae(e.value.values.main,e.value.fields,s),le(e.value.errors.main)){let d=G(e.value.values.main,e.value.fields,s);(await Y(d,o.config.base_module)).status==200&&(R.add({severity:"success",summary:"Success Message",detail:"Record added",life:3e3}),e.value.formSaving=!1,ne(o.config))}else R.add({severity:"error",summary:"Error Message",detail:"Please check the form again",life:3e3}),e.value.formSaving=!1},ne=async s=>{await ee(s)};return(s,v)=>{const d=T("Skeleton"),g=T("el-button");return i(),u(c,null,[N("div",Fe,[m.value?S("",!0):(i(),k(ke,{key:0},{fallback:F(()=>[(i(!0),u(c,null,y(te.value,(l,f)=>(i(),k(d,{key:f,height:"2rem",class:"mb-2",borderRadius:"16px"}))),128))]),default:F(()=>[t(a).filter(e.value.panels,{quick:!0}).length==1&&t(a).get(r.config,"maximized",!1)==!1?(i(!0),u(c,{key:0},y(t(a).filter(e.value.fields,{quick:!0}),l=>(i(),u(c,{key:l._id},[t(a).includes(e.value.hidden.fields,l._id)?S("",!0):(i(),k(t(B),{key:0,keyName:"main",config:l,module:r.config._module,formPage:n.value},null,8,["config","module","formPage"]))],64))),128)):(i(),u(c,{key:1},[(i(!0),u(c,null,y(t(a).filter(e.value.panels,function(l){if(!t(a).includes(e.value.hidden.panels,l.panelName)&&t(a).endsWith(l.controllerMethod,"@index")&&(t(a).get(r.config,"maximized",!1)==!1&&l.quick||t(a).get(r.config,"maximized",!1)==!0))return!0}),l=>(i(),k(t(O),{key:l._id,panel:l,quickAdd:!t(a).get(r.config,"maximized",!1),module:r.config._module,formPage:n.value},null,8,["panel","quickAdd","module","formPage"]))),128)),(i(!0),u(c,null,y(t(a).filter(e.value.panels,function(l){if(!t(a).includes(e.value.hidden.panels,l.panelName)&&t(a).endsWith(l.controllerMethod,"@show")&&t(a).get(r.config,"maximized",!1)==!0)return!0}),l=>(i(),u(c,{key:l._id},[t(a).includes(["SalesOpptItem"],l.entityName)?(i(!0),u(c,{key:0},y(l.sections,f=>(i(),u("div",{key:f._id,class:"flex flex-column px-1 py-2 mt-2"},[l.entityName=="SalesOpptItem"?(i(),k(t(I),{key:0,panel:l,module:r.config._module,formPage:n.value},null,8,["panel","module","formPage"])):S("",!0)]))),128)):S("",!0)],64))),128))],64))]),_:1}))]),N("div",Se,[N("div",be,[w(g,{onClick:se,disabled:m.value||e.value.formSaving},{default:F(()=>[z("Reset")]),_:1},8,["disabled"]),w(g,{type:"primary",onClick:ie,disabled:m.value||e.value.formSaving,loading:e.value.formSaving},{default:F(()=>[z("Save")]),_:1},8,["disabled","loading"])])])],64)}}};export{Ce as default};
