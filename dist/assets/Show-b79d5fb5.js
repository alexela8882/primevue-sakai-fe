import{_ as Pe,c as w,o as d,j as g,f as a,e as i,I as B,J as C,r as c,N as Ke,B as Ae,K as ze,a3 as Re,U as Ue,s as se,E as We,G as O,i as s,t as S,w as v,F as P,k as U,d as h,l as qe,m as W,S as K,v as Ge}from"./index-2f40471b.js";import{L as oe}from"./ListViewLoader-eec98b10.js";import{D as Je}from"./DataTableLoader-a929a2da.js";const He={},Qe={class:"flex gap-2"},Xe={class:"flex flex-column gap-2 w-full"},Ye={class:"flex flex-column gap-2 w-full"},Ze={class:"flex flex-column gap-2 w-full"},el={class:"flex flex-column gap-2 w-full"},ll={class:"flex flex-column gap-2 w-full"};function al(ne,q){const p=w("Skeleton");return d(),g("div",null,[a(p,{height:"3rem",class:"mb-2"}),i("div",Qe,[i("div",Xe,[a(p,{height:"10rem"}),a(p,{height:"10rem"}),a(p,{height:"10rem"})]),i("div",Ye,[a(p,{height:"10rem"})]),i("div",Ze,[a(p,{height:"10rem"}),a(p,{height:"10rem"})]),i("div",el,[a(p,{height:"10rem"}),a(p,{height:"10rem"}),a(p,{height:"10rem"}),a(p,{height:"10rem"})]),i("div",ll,[a(p,{height:"10rem"}),a(p,{height:"10rem"})])])])}const tl=Pe(He,[["render",al]]),il={class:"mt-3"},sl={key:0,class:"flex align-items-center justify-content-center",style:{height:"60vh !important"}},ol={key:1},nl={class:"text-primary-700"},ul={key:0,class:"my-4"},dl={class:"flex flex-column md:flex-row justify-content-between mt-3 gap-2"},rl={class:"flex align-items-center gap-2"},cl={class:"flex align-items-center gap-2"},vl={key:1,class:"mt-2 mb-4"},ml={class:"md:flex align-items-center justify-content-between gap-1"},pl={class:"w-7"},_l=i("div",{class:"text-xl mb-2"},"Will search through:",-1),gl={class:"text-sm"},bl={class:"p-inputgroup flex-1 mb-2 md:mb-0"},fl={class:"material-icons"},hl=i("div",{class:"text-color-secondary p-2"},"VIEW SETTINGS",-1),wl={class:"flex align-items-center text-color-secondary p-2 cursor-pointer"},yl={class:"material-icons mr-2"},xl=i("div",{class:"text-color-secondary p-2"},"LIST VIEW CONTROLS",-1),Fl={class:"flex align-items-center text-color-secondary p-2 cursor-pointer"},Sl={class:"material-icons mr-2"},kl={key:0,class:"flex align-items-center justify-content-center",style:{height:"60vh !important"}},Vl={key:1},Kl={__name:"Show",setup(ne){const q=B(()=>C(()=>import("./ViewFiltersDialogMain-d96f7419.js"),["assets/ViewFiltersDialogMain-d96f7419.js","assets/index-2f40471b.js","assets/index-d5e7f8f7.css","assets/index.esm-c3e8228d.js","assets/ViewFiltersDialogMain-bbe8a5f0.css"])),p=B(()=>C(()=>import("./ListViewFilterContent-8f151090.js"),["assets/ListViewFilterContent-8f151090.js","assets/index-2f40471b.js","assets/index-d5e7f8f7.css"])),ue=B(()=>C(()=>import("./DynamicDataTableMain-02ec36b0.js"),["assets/DynamicDataTableMain-02ec36b0.js","assets/index-2f40471b.js","assets/index-d5e7f8f7.css","assets/Validate-1e200014.js","assets/DynamicDataTableMain-5df8962c.css"])),de=B(()=>C(()=>import("./DynamicKanban-a114fd57.js"),["assets/DynamicKanban-a114fd57.js","assets/index-2f40471b.js","assets/index-d5e7f8f7.css","assets/DynamicKanban-13545c00.css"])),re=c(0),E=c(!1),T=c(null),_=c(!1),k=c(!1),o=c(),y=c("new"),x=c(!1),D=c(0),ce=Ke(),r=c({}),V=c(),b=c(),A=c(),G=c(),z=c(),f=c(),J=Ae(),H=ze(),ve=Re(),me=Ue(),{listViewFilterOverlay:Dl,viewFiltersDialogLoading:L,viewFiltersDialogSwitch:M,viewFiltersDialog:$,moduleLoading:pe,collectionLoading:_e,getModule:Ll,getModules:ge,getBaseModule:m,getCollection:Ml,_getViewFilters:be,getViewFilters:Il,_getDefaultViewFilter:fe,getDefaultViewFilter:El,_getViewFilterIds:he,__getViewFilter:Q,getViewFilter:Tl,_getSearchFields:we,_getSearchKeyFields:$l,_getSearchKeyFieldIds:ye,_getFieldDetailsById:xe}=se(J),{searchModule:Fe,_fetchModule:X,fetchModule:jl,fetchModules:Nl,fetchBaseModule:Se}=J,{getTabs:I}=se(H),{addTab:ke,toggleWindows:Y,maximizeTab:Bl}=H,{setFormReset:Ve}=ve,Z=c(!1),ee=c(!1),De=c([{label:"New",icon:"add",command:e=>{console.log(e),y.value="new",D.value+=1,L.value=!0,M.value=!0,$.value=!0}},{label:"Edit table settings",icon:"table_chart",command:e=>{console.log(e),y.value="edit-table",D.value+=1,L.value=!0,M.value=!0,$.value=!0}},{label:"Edit kanban settings",icon:"view_kanban",command:e=>{console.log(e),y.value="edit-kanban",D.value+=1,L.value=!0,M.value=!0,$.value=!0}}]),Le=c([{label:"Table view",icon:"table_chart",command:e=>{console.log(e),r.value.currentDisplay="table"}},{label:"Kanban view",icon:"view_kanban",disabled:!1,command:e=>{console.log(e),r.value.group_by!==null?r.value.currentDisplay="kanban":(y.value="edit-kanban",D.value+=1,L.value=!0,M.value=!0,$.value=!0)}},{label:"Split view",icon:"vertical_split",disabled:!0,command:e=>{console.log(e)}}]),Me=async e=>{await j(e)},le=async e=>{_.value=!0;let l=1;e.jump?l=o.meta&&o.meta.pagination:l=e.event.page+1;let n=Object.assign({},{moduleName:m.value.name,viewFilter:b.value,page:l>1?l:null,limit:e.per_page,search:T.value,searchFields:ae(),reuse:!0});o.value=await X(n),_.value=!1},Ie=async e=>{const l=e.value;await le({event:e,jump:!0,per_page:l})},Ee=async e=>{let l=Object.assign({},{type:"module-form",style:"window",name:`${e.name}-window-create-form`,label:`${e.label} Form`,_module:e.name,expanded:!1,opened:!1,mode:"modal",opened_order:null});I.value.findIndex((u,F)=>u.name===l.name)==-1?await ke(l,!0):Te(e)},Te=(e,l)=>{me.require({group:"templating",header:"Unsaved "+e.mainEntity+" Alert",message:e.mainEntity,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-outlined",rejectLabel:"Continue",acceptLabel:"Create New "+e.mainEntity,accept:()=>{let n=I.value.findIndex(u=>u.name===`${e.name}-window-create-form`);Ve(`${e.name}-window-create-form`),Y(I.value[n])},reject:()=>{let n=I.value.findIndex(u=>u.name===`${e.name}-window-create-form`);Y(I.value[n])}})},j=async e=>{k.value=!0,_.value=!0,await Se(ce.params.id);let l=Object.assign({},{moduleName:m.value.name,viewFilter:e?e._id:b.value&&b.value,page:null,limit:e?e.pageSize:V.value&&V.value.pageSize,reuse:!0});const n=await X(l);o.value=n,re.value=o.value.viewFilters.length,e?r.value=Q.value(e._id,o.value):r.value=fe.value(o.value),V.value=r.value&&r.value,b.value=V.value._id,A.value=Ge(()=>he.value(o.value)),G.value=we.value(o.value);let u=o.value.viewFilters.find(F=>F.isDefault);u&&u.search_fields&&u.search_fields.length>0?f.value=u.search_fields:f.value=ye.value(o.value),k.value=!1,_.value=!1},$e=e=>e.find(n=>n._id===m.value._id),je=async()=>{k.value=!0;let e=Object.assign({},{module:m.value.name,search:T.value,viewFilter:b.value,searchFields:ae(),selectedSearchKeyIds:f.value});const l=await Fe(e);l&&(o.value=l),k.value=!1,E.value=!1},ae=()=>{let e=[];return f.value.map(l=>{let n=Object.assign({},{"searchFields[]":l});e.push(n)}),e},Ne=async e=>{await j(e)};return We(async()=>{await j(null)}),O(b,async(e,l)=>{console.log(l),console.log(e),l&&(console.log("change view filter"),r.value=Q.value(e,o.value),await j(r.value))}),O(A,(e,l)=>{e&&(A.value=e.value)}),O(()=>ge.value,async(e,l)=>{let n=$e(e);y.value!==null&&(y.value==="new"?V.value=n.viewFilters[n.viewFilters.length-1]:(console.log("re-initialize"),V.value=n.viewFilters.find(u=>u._id===b.value))),y.value=null},{deep:!0}),O(()=>f.value,async(e,l)=>{z.value=[],e.map(n=>{let u=Object.assign({},{fields:o.value.fields,_id:n}),F=xe.value(u);z.value.push(F.label)})}),(e,l)=>{const n=w("ProgressSpinner"),u=w("Skeleton"),F=w("el-option"),te=w("el-select"),Be=w("el-popover"),Ce=w("el-input"),N=w("Button"),ie=w("Menu");return d(),g(P,null,[i("div",il,[s(pe)?(d(),g("div",sl,[a(n)])):(d(),g("div",ol,[i("h4",nl,S(s(m).label),1),i("div",null,[s(_e)?(d(),g("div",ul,[i("div",dl,[i("div",rl,[a(u,{width:"10rem",height:"2.5rem"}),a(u,{width:"10rem",height:"2.5rem"})]),i("div",cl,[a(u,{width:"10rem",height:"2.5rem"}),a(u,{width:"3rem",height:"2.5rem"}),a(u,{width:"3rem",height:"2.5rem"}),a(u,{width:"3rem",height:"2.5rem"}),a(u,{width:"8rem",height:"2.5rem"})])])])):(d(),g("div",vl,[i("div",ml,[i("div",pl,[a(te,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=t=>b.value=t),disabled:_.value,"collapse-tags":"",placeholder:"Select View Filters",style:{"max-width":"150px"},class:"mr-2"},{default:v(()=>[(d(!0),g(P,null,U(s(be)(o.value),t=>(d(),h(F,{key:t._id,label:t.filterName,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),a(Ce,{onKeypress:l[2]||(l[2]=qe(t=>je(),["enter"])),onBlur:l[3]||(l[3]=t=>E.value=!1),onFocus:l[4]||(l[4]=t=>E.value=!0),modelValue:T.value,"onUpdate:modelValue":l[5]||(l[5]=t=>T.value=t),disabled:_.value,placeholder:"Search The List...",style:{"max-width":"500px"}},{prepend:v(()=>[a(Be,{visible:E.value,placement:"bottom",width:400},{reference:v(()=>[a(te,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=t=>f.value=t),disabled:_.value,multiple:"","collapse-tags":"","max-collapse-tags":0,filterable:"",placeholder:"Select Fields",style:{"max-width":"150px"}},{default:v(()=>[(d(!0),g(P,null,U(G.value,t=>(d(),h(F,{key:t._id,label:t.label,value:t._id,disabled:f.value.length>=3&&!f.value.includes(t._id)},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","disabled"])]),default:v(()=>[i("div",null,[_l,(d(!0),g(P,null,U(z.value,(t,R)=>(d(),g("div",{key:R},[i("div",gl,S(t),1)]))),128))])]),_:1},8,["visible"])]),_:1},8,["modelValue","disabled"])]),i("div",null,[i("div",bl,[a(N,{onClick:l[6]||(l[6]=t=>ee.value.toggle(t)),disabled:_.value,type:"button","aria-haspopup":"true","aria-controls":"tbl_overlay_menu2",class:"material-icon border-round-md mr-2"},{icon:v(()=>[i("div",fl,S(r.value.currentDisplay===null||r.value.currentDisplay==="table"?"table_chart":"view_kanban"),1)]),_:1},8,["disabled"]),a(ie,{ref_key:"tblMenu2",ref:ee,id:"tbl_overlay_menu2",class:"mt-2",model:Le.value,popup:!0},{start:v(()=>[hl]),item:v(({item:t,label:R,props:Oe})=>[i("div",wl,[i("div",yl,S(t.icon),1),i("div",null,S(t.label),1)])]),_:1},8,["model"]),a(N,{onClick:l[7]||(l[7]=t=>Z.value.toggle(t)),loading:s(L),disabled:_.value,type:"button",icon:"pi pi-cog","aria-haspopup":"true","aria-controls":"tbl_overlay_menu",class:"border-round-md mr-2"},null,8,["loading","disabled"]),a(ie,{ref_key:"tblMenu",ref:Z,id:"tbl_overlay_menu",class:"mt-2",model:De.value,popup:!0},{start:v(()=>[xl]),item:v(({item:t,label:R,props:Oe})=>[i("div",Fl,[i("div",Sl,S(t.icon),1),i("div",null,S(t.label),1)])]),_:1},8,["model"]),a(N,{onClick:l[8]||(l[8]=t=>x.value=!0),disabled:x.value||_.value,icon:"pi pi-filter","aria-label":"Submit",class:"list-view-filter-btn border-round-md mr-2"},null,8,["disabled"]),s(m).name!="salesquotes"?(d(),h(N,{key:0,class:"border-round-md mr-2",disabled:_.value,icon:"pi pi-plus",onClick:l[9]||(l[9]=t=>Ee(s(m))),label:`New ${s(m).label}`},null,8,["disabled","label"])):W("",!0)])])])]))]),k.value?(d(),g("div",kl,[a(n)])):(d(),g("div",Vl,[r.value.currentDisplay===null||r.value.currentDisplay==="table"?(d(),h(K,{key:0},{fallback:v(()=>[a(Je)]),default:v(()=>[(d(),h(s(ue),{key:s(m)._id,mode:"edit",moduleId:s(m)._id,moduleEntityName:s(m).mainEntity,moduleName:s(m).name,modulePermissions:s(m).permissions,moduleLabel:s(m).label,viewFilter:r.value,fields:r.value.fields,data:o.value.data,pagination:o.value.meta&&o.value.meta.pagination,collectionLoading:_.value,sidebar:x.value,onToggleSidebar:l[11]||(l[11]=t=>x.value=!x.value),onPaginate:le,onLimitPage:Ie},{"list-view-filter":v(()=>[(d(),h(K,null,{fallback:v(()=>[a(oe)]),default:v(()=>[a(s(p),{onApplyFilters:l[10]||(l[10]=t=>Ne(t)),baseModule:s(m),module:o.value},null,8,["baseModule","module"])]),_:1}))]),_:1},8,["moduleId","moduleEntityName","moduleName","modulePermissions","moduleLabel","viewFilter","fields","data","pagination","collectionLoading","sidebar"]))]),_:1})):r.value.currentDisplay==="kanban"?(d(),h(K,{key:1},{fallback:v(()=>[a(tl)]),default:v(()=>[a(s(de),{viewFilterId:r.value._id,groupBy:r.value.group_by,summarizeBy:r.value.summarize_by,moduleName:s(m).name,moduleLabel:s(m).label,fields:r.value.fields,module:o.value,data:o.value.data,collectionLoading:k.value,sidebar:x.value,onToggleSidebar:l[12]||(l[12]=t=>x.value=!x.value)},{"list-view-filter":v(()=>[(d(),h(K,null,{fallback:v(()=>[a(oe)]),default:v(()=>[a(s(p),{baseModule:s(m),module:o.value},null,8,["baseModule","module"])]),_:1}))]),_:1},8,["viewFilterId","groupBy","summarizeBy","moduleName","moduleLabel","fields","module","data","collectionLoading","sidebar"])]),_:1})):W("",!0)]))]))]),s(M)?(d(),h(s(q),{key:D.value,mode:y.value,selectedViewFilter:b.value,module:o.value,onSavedViewfilter:l[13]||(l[13]=t=>Me(t))},null,8,["mode","selectedViewFilter","module"])):W("",!0)],64)}}};export{Kl as default};
