import{a3 as H,s as T,bX as e,bY as F,I as R,J as V,r as E,E as G,Y as U,G as W,a9 as J,c as X,o as k,d as L,w as B,j as A,F as O,k as C,i as y,S as K,m as Q}from"./index-6d47cf9b.js";function Z(){const _=H(),{getPicklist:p}=T(_);function S(s){return e.reduce(s,function(l,a,t){return a.field_type.name=="picklist"&&l.push(a.listName),l},[])}function q(s){return e.reduce(s,function(l,a,t){return a.field_type.name=="lookupModel"&&(e.get(a.rules,"ss_dropdown",!1)||e.get(a.rules,"ms_dropdown",!1)||e.get(a.rules,"ss_list_view",!1)||e.get(a.rules,"checkbox",!1)||e.get(a.rules,"checkbox_inline",!1)||e.get(a.rules,"radiobutton",!1)||e.get(a.rules,"radiobutton_inline",!1))&&l.push(a.uniqueName),l},[])}function D(s,l,a){let t=!1,n="",i=e.reduce(s.values,function(f,o,u){if(o.level){t=!0;let g=!1;if(o.level==2&&e.get(s.values,u-1+".level",0)==1?n=s.values[u-1].name:o.level==1&&(e.get(s.values,u+1+".level",1)==2?g=!0:n=""),!g){let r=e.findIndex(f,{label:n});r>-1?f[r].options.push(e.merge(o,{value:o.name})):f.push({label:n,options:[e.merge(o,{value:o.name})]})}}else{let g=a;if(e.isNil(a)&&(g=e.find(l,{uniqueName:s.field})),g){let r=x(o,g);f.push(r)}}return f},[]);return{group:t,options:i}}function x(s,l){let a=e.get(l,"fieldGlue"," "),t=e.get(l,"relation.displayFieldName",[]),n=s;e.isArray(s)||(n=[s]);let i=e.reduce(n,function(f,o,u){let g=[],r=e.has(l,"relation.popupDisplayFieldName")?l.relation.popupDisplayFieldName:l.relation.displayFieldName;return e.forEach(r,function(c,d){c=="firstName"&&r[d+1]=="lastName"?g.push(e.join(e.values(e.pick(o,["firstName","lastName"]))," ")):(c=="lastName"&&r[d-1]!="firstName"||c!="lastName")&&!e.isNil(o[c])&&!e.isEmpty(o[c])&&g.push(o[c])}),f.push(e.merge(o,{value:e.join(e.values(e.pick(o,t)),a),poupDisplayValues:g})),f},[]);return e.isArray(s)?i:i[0]}function P(s,l,a){let t={};return e.isNil(a)||a=="create"?t=j(s,!0):a=="show"?t=h(s,l,!0):a=="update"&&(t=h(s,l,!1)),t}function j(s,l){return e.reduce(s,function(a,t,n){if(t.field_type.name=="percentage"){let i=e.get(t,"rules.default_value",!1)?t.rules.default_value*100:0;a[t.name]=l?i+"%":i}else t.field_type.name=="number"||t.field_type.name=="currency"?a[t.name]=e.get(t,"rules.default_value",!1)?Y(t.rules.default_value,t.rules,l):0:t.field_type.name=="boolean"?a[t.name]=e.get(t,"rules.default_value",!1):t.field_type.name=="date"||t.field_type.name=="date_time"?a[t.name]=e.get(t,"rules.default_value",!1)?M(t.rules.default_value,t.rules,l):null:t.field_type.name=="picklist"?a[t.name]=e.get(t,"rules.default_value",!1)?b(t.rules,t.listName):null:a[t.name]=null;return a},{})}function h(s,l,a){return e.reduce(s,function(t,n,i){if(!e.isNil(l[n.name])&&!e.isEmpty(l[n.name]))n.field_type.name=="date"||n.field_type.name=="date_time"?t[n.name]=M(l[n.name],n.rules,a):n.field_type.name=="picklist"?t[n.name]=a?l[n.name]:b(n.rules,n.listName,l[n.name]):t[n.name]=l[n.name];else if(n.field_type.name=="percentage"||n.field_type.name=="number"||n.field_type.name=="currency"||n.field_type.name=="formula"||n.field_type.name=="rollUpSummary")if(e.isNumber(l[n.name]))if(n.field_type.name=="percentage"){let f=l[n.name]*100;t[n.name]=a?f+"%":f}else t[n.name]=Y(l[n.name],n.rules,a);else if(e.isString(l[n.name]))if(n.field_type.name=="percentage"){let f=e.toNumber(l[n.name])*100;t[n.name]=a?f+"%":f}else t[n.name]=Y(e.toNumber(l[n.name]),n.rules,a);else result[n.name]=0;else t[n.name]=null;return t},{})}function Y(s,l,a){let t=s;if(a)if(e.has(l,"decimal")){t=e.round(s,l.decimal);let n=e.split(t,".",2);n.length>1?n[1].length<l.decimal&&(n[1]=e.pad(n[1],l.decimal,"0")):n.push(e.pad("",l.decimal,"0")),l.decimal>0?e.get(l,"comma_separated",!1)?t=e.toInteger(n[0]).toLocaleString()+"."+n[1]:t=e.toInteger(n[0])+"."+n[1]:e.get(l,"comma_separated",!1)?t=e.toInteger(n[0]).toLocaleString():t=e.toInteger(n[0])}else e.get(l,"comma_separated",!1)&&(t=e.toInteger(s).toLocaleString());else e.has(l,"decimal")&&(t=e.round(s,l.decimal));return t}function M(s,l,a){let t=s;if(a)if(e.has(l,"date_selection"))l.date_selection=="month"?t=F(e.trim(s)).format("YYYY MMM"):l.date_selection=="week"&&(t=F(e.trim(s)).format("YYYY [Week] ww"));else{let i=e.get(l,"date_only",!1)?"MM/DD/YYYY":"MM/DD/YYYY HH:mm:ss";if(e.has(l,"date_format")){let f=[],o="";if(e.includes(l.date_format,"-")?(f=e.split(l.date_format,"-"),o="-"):e.includes(l.date_format,"/")?(f=e.split(l.date_format,"/"),o="/"):o=",",i="",o==","){var n=e.split(l.date_format,",");f=e.split(n[0]," "),e.forEach(f,function(u){u=e.trim(u),u=="M"?i=i+"MMM":u=="F"?i=i+"MMMM":u=="d"?i=i+"DD":u=="j"&&(i=i+"D"),i=i+" "}),e.trim(n[1])=="Y"?i=e.trim(i)+", YYYY":e.trim(n[1])=="y"&&(i=e.trim(i)+", YY")}else e.forEach(f,function(u){u=="m"?i=i+"MM":u=="M"?i=i+"MMM":u=="n"?i=i+"M":u=="F"?i=i+"MMMM":u=="d"?i=i+"DD":u=="j"?i=i+"D":u=="Y"?i=i+"YYYY":u=="y"&&(i=i+"YY"),i=i+o}),i=e.trimEnd(i,o)}t=F(e.trim(s)).format(i)}else e.has(l,"default_value")&&(l.default_value.type=="computed"?t=Date():t=e.trim(l.default_value.value)),e.get(l,"date_only",!1)?t=F(e.trim(t)).format("YYYY-MM-DD"):t=F(e.trim(t)).format("YYYY-MM-DD HH:mm:ss");return t}function N(s){return!!(e.get(s,"ms_dropdown",!1)||e.get(s,"checkbox",!1)||e.get(s,"checkbox_inline",!1)||e.get(s,"ms_list_view",!1))}function b(s,l,a){let t=e.get(p.value,l+".values",[]);if(t){if(N(s)){if(a)return e.filter(t,function(i){if(e.includes(a,i.value))return!0})}else if(a)return e.find(t,{value:a})}else return null}return{getPicklistFields:S,getLookupFields:q,transformFormValues:P,formatLookupOptions:D,transformNumberCurrency:Y,transformDate:M,checkFieldIfMultipleSelect:N,getModuleValues:h}}const $={__name:"Form",props:{config:Object},setup(_){const p=_,S=R(()=>V(()=>import("./Field-9802713a.js"),["assets/Field-9802713a.js","assets/index-6d47cf9b.js","assets/index-cb49da02.css","assets/Editor-77a6f47d.js","assets/Field-2c5fd7b8.css"])),q=R(()=>V(()=>import("./FormPanel-f03dfb8f.js"),["assets/FormPanel-f03dfb8f.js","assets/index-6d47cf9b.js","assets/index-cb49da02.css","assets/FormPanel-bfb8ca10.css"])),D=H(),{formatLookupOptions:x,getPicklistFields:P,getLookupFields:j,transformFormValues:h,transformDate:Y}=Z(),{fetchPicklist:M,fetchLookup:N,saveForm:b,setFormReset:s}=D,{getCachedFormData:l,getFormReset:a}=T(D),t=E(e.fill(Array(10),1)),n=E(!0),i=E({fields:[],panels:[],values:{main:{},mutable:[]},lookup:{},errors:{main:{},mutable:[]},formName:p.config.name}),f=E([]);G(async()=>{let r=l.value(p.config.name);if(r)i.value=e.merge(i.value,e.cloneDeep(r)),p.config.name==a.value&&(i.value.values.main=h(p.config.module.fields),s("")),n.value=!1;else{i.value.fields=p.config.module.fields,i.value.panels=p.config.module.panels;let c=P(p.config.module.fields),d=j(p.config.module.fields);await o(c,d),i.value.values.main=h(p.config.module.fields),g()}}),U(()=>{console.log("before unmount"),b(i.value)}),W(()=>a.value,(r,c)=>{r==p.config.name&&(i.value.values.main=h(p.config.module.fields),s(""))});const o=async(r,c)=>{const d=[];r.length>0&&d.push(M(r)),c.length>0&&e.forEach(c,function(m){d.push(u(m))}),await Promise.all(d)},u=r=>new Promise((c,d)=>{const m=N(r);e.has(i.value.lookup,m.id)||(i.value.lookup[m.field]=x(e.cloneDeep(m),i.value.fields)),c()}),g=()=>{let r=e.chain(i.value.fields).filter({quick:!0}).map("_id").value();console.log("initialize"),e.forEach(i.value.panels,function(c,d){i.value.panels[d].quick=!1,e.forEach(c.sections,function(m,w){i.value.panels[d].sections[w].quick=!1;let I=m.field_ids[0];m.field_ids.length>1&&I.concat(m.field_ids[1]),e.filter(I,function(z){if(e.includes(r,z))return!0}).length>0&&(i.value.panels[d].quick=!0,i.value.panels[d].sections[w].quick=!0)})}),n.value=!1};return J("form",i),(r,c)=>{const d=X("Skeleton");return n.value?Q("",!0):(k(),L(K,{key:0},{fallback:B(()=>[(k(!0),A(O,null,C(t.value,(m,w)=>(k(),L(d,{key:w,height:"2rem",class:"mb-2",borderRadius:"16px"}))),128))]),default:B(()=>[y(e).filter(i.value.panels,{quick:!0}).length==1&&_.config.style=="window"?(k(!0),A(O,{key:0},C(y(e).filter(i.value.fields,{quick:!0}),m=>(k(),L(y(S),{key:m._id,config:m},null,8,["config"]))),128)):(k(!0),A(O,{key:1},C(y(e).filter(i.value.panels,function(m){if(!y(e).includes(f.value,m._id)&&y(e).endsWith(m.controllerMethod,"@index")&&(_.config.style=="window"&&m.quick||_.config.style!="window"&&!m.quick))return!0}),m=>(k(),L(y(q),{quickAdd:_.config.style=="window",key:m._id,panel:m},null,8,["quickAdd","panel"]))),128))]),_:1}))}}},te=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"}));export{te as F,Z as h};
