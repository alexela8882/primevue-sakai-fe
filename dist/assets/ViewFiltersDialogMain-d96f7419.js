import{r as S,B as I,s as K,E as R,G as M,c as F,o as q,j as Z,e,f as _,aa as V,i as l,t as c,n as W,w as k,g as X,d as P,m as Y,p as ae}from"./index-2f40471b.js";import{u as ee,a as le,c as L,b as te}from"./index.esm-c3e8228d.js";const oe={class:"flex flex-column gap-4"},re={class:"mt-4 flex justify-content-between"},ne={class:"p-float-label"},de=e("label",null,"Filter name *",-1),ue={class:"p-error text-sm my-2"},ce={class:"p-float-label"},me=e("label",null,"Query type",-1),pe={class:"p-error text-sm my-2"},be={class:"flex align-items-center justify-content-between"},ve={class:"flex align-items-center gap-2"},ge={class:"p-float-label"},_e=e("label",null,"Sort field *",-1),fe={class:"p-error text-sm my-2"},ye={class:"p-float-label"},we=e("label",null,"Sort order *",-1),Ve={class:"p-error text-sm my-2"},Se={class:"p-float-label"},Fe=e("label",null,"Items per page *",-1),he={class:"p-error text-sm my-2"},xe={class:"flex flex-wrap p-2 align-items-center gap-3"},$e={class:"flex-1 flex flex-column gap-2"},Te={class:"font-bold"},Le={__name:"TableSettings",props:{mode:String,baseModule:Object,module:Object,selectedViewFilter:String,saveTrigger:Number},emits:["save-viewfilter"],setup(o,{emit:D}){const t=o,b=S(!1),v=S(null),{values:j,errors:i,defineComponentBinds:d,isSubmitting:h,setFieldValue:a,handleSubmit:O}=ee({validationSchema:le({filterName:L().label("Filter name").required(),sortField:L().label("Sort field").required(),sortOrder:L().label("Sort order").required(),pageSize:L().label("Items per page").required(),queryType:L().label("Query Type").required(),pickList:te().label("Pick list fields").min(2,"Please add at least 2 field").required()})}),x=S(null),$=d("filterName"),f=d("sortField"),r=d("sortOrder"),w=d("pageSize"),z=d("queryType");d("pickList");const m=I(),{viewFiltersDialogLoading:B,viewFiltersDialog:E,viewFilterData:G,perPageItems:C,getBaseModule:se,_getDefaultViewFilter:Q,__getViewFilter:A,_getViewFilters:U,getViewFilters:H,getReconstructedViewFilter:J}=K(m),{addViewFilter:n}=m,y=O(async s=>{B.value=!0;const g=Object.assign({},{mode:t.mode,baseModule:t.baseModule,viewFilter:t.selectedViewFilter,type:"table",data:s}),u=await n(g);D("save-viewfilter",u.viewFilter),B.value=!1,E.value=!1}),p=s=>{console.log(s),a("filterName",s.filterName),a("sortField",s.sortField?s.sortField:"created_at"),a("sortOrder",s.sortOrder),a("pageSize",s.pageSize?s.pageSize:15),a("queryType",s.queryType?s.queryType:"all");const g=t.module.fields.filter(u=>!s.fields.some(T=>T._id===u._id));v.value=[g,s.fields],a("pickList",s.fields.map(u=>u._id))};return R(()=>{B.value=!1,x.value=t.selectedViewFilter,t.mode==="new"?(v.value=[t.module.fields,[]],a("queryType","all"),a("pageSize",15),a("sortOrder","ASC"),a("sortField","created_at")):t.mode==="edit-table"&&p(Q.value(t.module))}),M(v,(s,g)=>{G.value.data.fields=s[1].map(u=>u._id),b.value&&a("pickList",s[1].map(u=>u._id))}),M(x,(s,g)=>{if(t.mode==="edit-table"){const u=A.value(s,t.module);p(u)}}),M(()=>t.saveTrigger,(s,g)=>{y()}),(s,g)=>{const u=F("InputText"),T=F("Dropdown"),ie=F("PickList");return q(),Z("form",oe,[e("div",re,[e("div",null,[e("span",ne,[_(u,V(l($),{class:`${l(i).filterName?"p-invalid":"border-primary"}`,style:{"min-width":"50vh"}}),null,16,["class"]),de]),e("div",ue,c(l(i).filterName||" "),1)]),e("div",null,[e("span",ce,[_(T,V(l(z),{class:[`${l(i).queryType?"p-invalid":"border-primary"}`,"w-full md:w-16rem mr-2"],options:[{label:"All",value:"all"},{label:"Owned",value:"owned"}],optionLabel:"label",optionValue:"value"}),null,16,["class"]),me]),e("div",pe,c(l(i).queryType||" "),1)])]),e("div",be,[e("div",ve,[e("div",null,[e("span",ge,[_(T,V(l(f),{options:o.module.fields,optionLabel:"label",optionValue:"name",dataKey:"_id",filter:"",class:["w-full md:w-12rem mr-2",`${l(i).sortField?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),_e]),e("div",fe,c(l(i).sortField||" "),1)]),e("div",null,[e("span",ye,[_(T,V(l(r),{options:[{label:"Ascending",value:"ASC"},{label:"Descending",value:"DESC"}],optionLabel:"label",optionValue:"value",class:["w-full md:w-12rem mr-2",`${l(i).sortOrder?"p-invalid":"border-primary"}`]}),null,16,["class"]),we]),e("div",Ve,c(l(i).sortOrder||" "),1)])]),e("div",null,[e("span",Se,[_(T,V(l(w),{options:l(C),optionLabel:"label",optionValue:"value",class:["w-full md:w-12rem mr-2",`${l(i).pageSize?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),Fe]),e("div",he,c(l(i).pageSize||" "),1)])]),e("div",{class:W(["border-1 border-round-md p-4",`${l(i).pickList?"border-red-600":"border-primary"}`])},[e("div",{class:W(["text-sm mb-4",{"p-error":l(i).pickList}])},c(l(i).pickList||"View filter fields"),3),_(ie,{modelValue:v.value,"onUpdate:modelValue":g[0]||(g[0]=N=>v.value=N),onSelectionChange:g[1]||(g[1]=N=>b.value=!0),responsive:"",listStyle:"height:342px",dataKey:"_id"},{sourceheader:k(()=>[X(" Available Fields ")]),targetheader:k(()=>[X(" Visible Fields ")]),item:k(N=>[e("div",xe,[e("div",$e,[e("span",Te,c(N.item.label),1)])])]),_:1},8,["modelValue"])],2)])}}},ke={class:"flex flex-column gap-4"},De={class:"flex flex-column gap-4 mx-auto mt-6"},ze={class:"p-float-label"},Me=e("label",null,"Titles",-1),qe={class:"p-error text-sm my-2"},Oe={class:"p-float-label"},Be=e("label",null,"Summarize By",-1),Ce={class:"p-error text-sm my-2"},Ne={class:"p-float-label"},je=e("label",null,"Group By *",-1),Ae={class:"p-error text-sm my-2"},Pe={__name:"KanbanSettings",props:{mode:String,baseModule:Object,module:Object,selectedViewFilter:String,saveTrigger:Number},emits:["save-viewfilter"],setup(o,{emit:D}){const t=o,b=S(),v=S(null),{values:j,errors:i,defineComponentBinds:d,isSubmitting:h,setFieldValue:a,handleSubmit:O}=ee({validationSchema:le({group_by:L().label("Group By").required(),title_ids:te().label("Titles").required()})}),x=d("title_ids"),$=d("summarize_by"),f=d("group_by"),r=I(),{viewFiltersDialogLoading:w,viewFiltersDialog:z,viewFilterData:m,perPageItems:B,getBaseModule:E,getDefaultViewFilter:G,__getViewFilter:C,_getViewFilters:se,getViewFilters:Q,getReconstructedViewFilter:A}=K(r),{addViewFilter:U}=r,H=O(async n=>{w.value=!0;const y=Object.assign({},{baseModule:t.baseModule,viewFilter:t.selectedViewFilter,type:"kanban",data:n}),p=await U(y);D("save-viewfilter",p.viewFilter),w.value=!1,z.value=!1}),J=n=>{let y=[];n.title_ids&&n.title_ids.length>0?y=n.title_ids:y=b.value.filter(p=>p.title).map(p=>p._id),a("title_ids",y),a("summarize_by",n.summarize_by),a("group_by",n.group_by)};return R(()=>{w.value=!1,v.value=t.selectedViewFilter;const n=C.value(t.selectedViewFilter,t.module);b.value=n.fields}),M(v,(n,y)=>{const p=C.value(n,t.module);J(A.value(p))}),M(()=>t.saveTrigger,(n,y)=>{H()}),(n,y)=>{const p=F("MultiSelect"),s=F("Dropdown");return q(),Z("div",ke,[e("div",De,[e("div",null,[e("span",ze,[_(p,V(l(x),{options:b.value,optionLabel:"label",optionValue:"_id",filter:"",mutiple:"",class:["w-full md:w-22rem mr-2",`${l(i).title_ids?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),Me]),e("div",qe,c(l(i).title_ids||" "),1)]),e("div",null,[e("span",Oe,[_(s,V(l($),{options:b.value,optionLabel:"label",optionValue:"name",filter:"",class:["w-full md:w-22rem mr-2",`${l(i).summarize_by?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),Be]),e("div",Ce,c(l(i).summarize_by||" "),1)]),e("div",null,[e("span",Ne,[_(s,V(l(f),{options:b.value,optionLabel:"label",optionValue:"_id",filter:"",class:["w-full md:w-22rem mr-2",`${l(i).group_by?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),je]),e("div",Ae,c(l(i).group_by||" "),1)])])])}}};const Ie={class:"flex align-items-center text-2xl"},Ke={class:"material-icons mr-2"},Re={class:"flex align-items-center justify-content-end my-2"},Qe={__name:"ViewFiltersDialogMain",props:{mode:String,selectedViewFilter:String,module:Object},emits:["saved-viewfilter"],setup(o,{emit:D}){const t=o,b=S(0),v=S(0),j=S(!1),i=I(),{viewFiltersDialogLoading:d,viewFiltersDialog:h,getBaseModule:a,getViewFilters:O}=K(i),x=()=>{t.mode==="new"||t.mode==="edit-table"?b.value++:t.mode==="edit-kanban"&&v.value++},$=f=>{D("saved-viewfilter",f)};return R(()=>{}),(f,r)=>{const w=F("Button"),z=F("Dialog");return q(),P(z,{visible:l(h),"onUpdate:visible":r[5]||(r[5]=m=>ae(h)?h.value=m:null),modal:"",maximizable:"",style:{width:"70vw"},class:"view-filter-dialog"},{header:k(()=>[e("div",Ie,[e("div",Ke,c(o.mode==="edit-table"?"table_chart":"view_kanban"),1),e("div",null,c(o.mode==="edit-table"||o.mode==="new"?"Table":"Kanban")+" Settings — "+c(l(a).label),1)])]),footer:k(()=>[e("div",Re,[_(w,{onClick:r[4]||(r[4]=m=>h.value=!1),outlined:"",disabled:j.value||l(d),label:"Cancel",class:"border-round-3xl py-2 px-4 border-color-primary",size:"small"},null,8,["disabled"]),_(w,{onClick:x,disabled:l(d),loading:l(d),label:"Save",class:"reddot-primary border-round-3xl py-2 px-4 text-surface-50"},null,8,["disabled","loading"])])]),default:k(()=>[o.mode==="new"||o.mode==="edit-table"?(q(),P(Le,{key:0,mode:o.mode,baseModule:l(a),module:o.module,selectedViewFilter:o.selectedViewFilter,saveTrigger:b.value,onSaveLoading:r[0]||(r[0]=m=>f.saveLoad(f.payload)),onSaveViewfilter:r[1]||(r[1]=m=>$(m))},null,8,["mode","baseModule","module","selectedViewFilter","saveTrigger"])):Y("",!0),o.mode==="edit-kanban"?(q(),P(Pe,{key:1,mode:o.mode,baseModule:l(a),module:o.module,selectedViewFilter:o.selectedViewFilter,saveTrigger:v.value,onSaveLoading:r[2]||(r[2]=m=>f.saveLoad(f.payload)),onSaveViewfilter:r[3]||(r[3]=m=>$(m))},null,8,["mode","baseModule","module","selectedViewFilter","saveTrigger"])):Y("",!0)]),_:1},8,["visible"])}}};export{Qe as default};
