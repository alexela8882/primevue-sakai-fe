import{M as xe,O as Se,B as le,s as R,r as s,v as W,q as Ie,a as De,N as Ce,a4 as Ee,a5 as Me,a8 as Fe,G as Ne,E as Te,a2 as o,a9 as X,aa as Le,c as h,o as n,j as d,f as v,w as k,e as b,g as P,t as x,m as F,d as Z,x as ee,F as G,k as ae,i as I,n as te,T as Re,y as Ve,I as je,J as Be}from"./index-f956d2f5.js";import{v as Oe}from"./Validate-2e5413e3.js";const ze=xe("moduleDynamicTableStore",()=>{const u=Se(),V=le(),{jsonDbUrl:j}=R(u);R(V);const r=s(!1),y=s([]),D=W(()=>y.value),B=W(()=>w=>{const a=y.value.find(N=>N.module===w);return a?a.content:null});return{getDropdownLists:D,getDropdown:B,fetchDropdownLists:async w=>{r.value=!0;const a=await Ie(`${j.value}/${w}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(a.status===200&&a.data&&!y.value.find(C=>C.module===w)){let C=Object.assign({},{module:w,content:a.data});y.value.push(C)}r.value=!1}}});const Ae={key:0,style:{"white-space":"normal"}},Ue=["onDblclick"],$e={key:0},Pe={key:0},Ge={key:0,class:"mr-1"},Je={key:1,class:"mr-1"},qe={key:2,class:"mr-1"},He={key:1},Ye={key:1,class:"edit-icon cursor-pointer pi pi-pencil ml-3"},Ke={key:2,class:"edit-icon cursor-pointer pi pi-lock ml-3"},Qe={key:0,class:"md:flex justify-content-between font-light"},We={class:"flex align-items-center px-3"},Xe={class:"text-sm text-color-secondary"},Ze={class:"text-sm text-color-secondary"},ea=b("div",{class:"text-700"}," No records found ",-1),aa={style:{overflow:"scroll","max-height":"100%"}},ta=b("div",{class:"ddt-div-1 shadow-4 bg-white"},null,-1),la={key:0,style:{width:"100vw",position:"fixed",bottom:"0",left:"0",height:"54px","text-align":"center","margin-left":"90px",padding:"12px"},class:"shadow-2 align-items-center"},ua={__name:"DynamicDataTableMain",props:{mode:String,sidebar:Boolean,moduleId:String,moduleEntityName:String,moduleName:String,modulePermissions:{type:Array,default:[]},moduleLabel:String,data:Array,pagination:Object,pageItems:Array,rows:Number,pages:Number,viewFilter:Object,fields:Array,collectionLoading:Boolean},emits:["toggle-sidebar","paginate","limit-page"],setup(u,{emit:V}){const j=je(()=>Be(()=>import("./Field-7d68320f.js"),["assets/Field-7d68320f.js","assets/index-f956d2f5.js","assets/index-40ff91a8.css","assets/Validate-2e5413e3.js","assets/Editor-92f51c1d.js","assets/Field-7433004a.css"])),r=u,y=V,D=s([]);if(r.viewFilter){let e=Object.assign({},{field:r.viewFilter.sortField,order:r.viewFilter.sortOrder=="ASC"?1:-1});D.value.push(e)}const B=De();s(),s(0);const O=s(null),w=s(null);s(!1);const a=s({rowId:null,field:null,rowIndex:null,columnIndex:null});Ce();const N=s(),C=s(),J=s();s(),s();const q=s(),T=s(),H=s(),oe=le(),se=Ee(),ie=ze(),{getModule:Y,getCollection:oa,getBaseModule:E,getEntity:sa}=R(oe),{massUpdateRecords:ne}=se;R(ie);const{validateField:ue,errorChecker:re}=Oe(),{transformLookupValue:z,transformFieldForSaving:de}=Me();s([{label:"View",icon:"pi pi-fw pi-search",command:()=>console.log(T.value)},{label:"Delete",icon:"pi pi-fw pi-times",command:()=>console.log(T.value)}]);const ce=s([{label:"View",icon:"pi pi-reply",command:e=>{if(r.modulePermissions.includes("show")){const t=Object.assign({},{name:"modules.pages.detail",params:{name:r.moduleName,id:r.moduleId,pageid:H.value._id}});Fe.push(t)}else B.add({severity:"warn",summary:"Attention",detail:"You don't have permission please contact administrator.",life:1e4})}},{label:"Change Owner",icon:"pi pi-user",command:e=>{},visible:r.moduleEntityName===E.value.mainEntity},{label:"Update",icon:"pi pi-refresh",disabled:!r.modulePermissions.includes("update"),command:e=>{},visible:r.moduleEntityName===E.value.mainEntity},{label:"Delete",icon:"pi pi-times",disabled:!r.modulePermissions.includes("delete"),command:e=>{},visible:r.moduleEntityName===E.value.mainEntity}]),pe=s([{label:"10",value:10},{label:"15",value:15},{label:"20",value:20},{label:"25",value:25},{label:"30",value:30},{label:"35",value:35},{label:"40",value:40},{label:"45",value:45},{label:"50",value:50}]),i=s({values:{},errors:{}}),f=s({}),g=s(),K=s(["owner_id","created_at","updated_at","created_by","updated_by"]),me=async(e,t,c)=>{y("paginate",{event:e,jump:t,per_page:c})},ve=async e=>{y("limit-page",e)},ge=e=>{},fe=(e,t)=>{J.value.toggle(e),H.value=t},be=(e,t,c)=>{if(console.log(e),!o.includes(K.value,t.name)&&(a.value.rowId=e.data._id,a.value.rowIndex=e.index,a.value.columnIndex=c,a.value.field=t,!o.has(i.value.values,e.data._id))){let p=o.cloneDeep(e.data);t.field_type.name=="lookupModel"&&(p[t.name]=z(p[t.name],t)),i.value.values[e.data._id]=o.cloneDeep(p),i.value.errors[e.data._id]={},i.value.errors[e.data._id][e.field]=[]}},ye=()=>{f.value={},i.value={},g.value=o.cloneDeep(r.data)};Ne(()=>r.data,(e,t)=>{g.value=e}),Te(async()=>{g.value=o.cloneDeep(r.data),console.log(g.value)}),X(O,e=>{if(console.log(e.target&&e.target.attributes.class.value),e.target){if(e.target.attributes.class&&(e.target.attributes.class.value==="p-dropdown-item"||e.target.attributes.class.value==="p-dropdown-filter p-inputtext p-component"||e.target.attributes.class.value==="p-checkbox-box"||e.target.attributes.class.value==="p-checkbox-box p-focus"||e.target.attributes.class.value==="p-icon p-checkbox-icon undefined"||e.target.attributes.class.value==="p-multiselect-header"||e.target.attributes.class.value==="p-multiselect-empty-message"||e.target.attributes.class.value==="p-icon p-multiselect-close-icon"||e.target.attributes.class.value==="p-multiselect-close p-link"||e.target.attributes.class.value==="p-datepicker-other-month"||e.target.attributes.class.value==="p-datepicker-header"||e.target.attributes.class.value==="p-monthpicker-month"||e.target.attributes.class.value==="p-datepicker-month p-link"||e.target.attributes.class.value==="p-yearpicker-year"||e.target.attributes.class.value==="p-datepicker-year p-link"||e.target.attributes.class.value==="p-icon p-datepicker-prev-icon"||e.target.attributes.class.value==="p-icon p-datepicker-next-icon"||e.target.attributes.class.value==="p-datepicker-prev p-link"||e.target.attributes.class.value==="p-datepicker-next p-link"||e.target.attributes.class.value==="p-datepicker p-component p-ripple-disabled"||e.target.attributes.class.value==="p-datepicker-group"||e.target.attributes.class.value==="p-dialog-header"||e.target.attributes.class.value==="p-dialog-title"||e.target.attributes.class.value==="p-dialog-footer"||e.target.attributes.class.value==="p-confirm-dialog-message"||e.target.attributes.class.value==="p-icon p-dialog-header-close-icon"||e.target.attributes.class.value==="p-confirm-dialog-icon pi pi-exclamation-triangle"||e.target.attributes.class.value==="p-dialog-mask p-component-overlay p-component-overlay-enter"||e.target.attributes.class.value==="p-button-label"||e.target.attributes.class.value==="p-button p-component p-confirm-dialog-reject p-button-secondary p-button-outlined")||e.target.attributes["data-pc-section"]&&(e.target.attributes["data-pc-section"].value==="item"||e.target.attributes["data-pc-section"].value==="filterinput"||e.target.attributes["data-pc-section"].value==="option"||e.target.attributes["data-pc-section"].value==="daylabel"))return;y("toggle-sidebar",!1)}}),document.addEventListener("keydown",function(e){e.key==="Escape"&&(console.log("Escape key pressed",e),A())}),X(w,e=>{let t=o.get(e,"target.classList",[]);console.log(e.target.parentElement.className,t),!o.includes(t,"p-inputtext")&&!o.includes(t,"el-input__inner")&&!o.includes(t,"el-select-dropdown__ite")&&!o.includes(t,"fieldInputSelection")&&!o.includes(t,"lookupSelected")&&!o.includes(t,"lookupInput")&&!o.includes(t,"lookupRemoveBtn")&&!o.includes(t,"lookupSelection")&&e.target.parentElement.className!="el-icon el-select__caret el-select__icon"?(console.log("click outside"),A()):console.log("clicked inside field")});const A=()=>{if(a.value.rowId!=null){let e=o.find(Y.value.fields,{name:a.value.field.name});if(console.log(i.value.values[a.value.rowId][a.value.field.name]),i.value.errors[a.value.rowId][a.value.field.name]=ue(i.value.values[a.value.rowId],e,Y.value.fields),re(i.value.errors[a.value.rowId])){let c=o.findIndex(g.value,{_id:a.value.rowId}),p=i.value.values[a.value.rowId][a.value.field.name],_=g.value[c][a.value.field.name];a.value.field.field_type.name=="picklist"?p=o.isArray(i.value.values[a.value.rowId][a.value.field.name])?o.join(o.map(i.value.values[a.value.rowId][a.value.field.name],"value"),", "):i.value.values[a.value.rowId][a.value.field.name].value:a.value.field.field_type.name=="lookupModel"&&(p=z(i.value.values[a.value.rowId][a.value.field.name],a.value.field,!0),_=z(g.value[c][a.value.field.name],a.value.field,!0)),p!=_&&(console.log(a.value.field,p,_),a.value.field.field_type.name=="picklist"?(console.log("picklist changed",i.value.values[a.value.rowId][a.value.field.name].value),g.value[c][a.value.field.name]=i.value.values[a.value.rowId][a.value.field.name].value):g.value[c][a.value.field.name]=i.value.values[a.value.rowId][a.value.field.name],o.has(f.value,a.value.rowId)?o.has(f.value[a.value.rowId],a.value.field.name)||f.value[a.value.rowId].push(a.value.field.name):f.value[a.value.rowId]=[a.value.field.name]),a.value={rowId:null,field:null,rowIndex:null,columnIndex:null}}}},we=s(!1),_e=async()=>{we.value=!0;let e=o.reduce(f.value,function(c,p,_){let L={_id:_};return o.forEach(p,function(M){L[M]=de(i.value.values[_][M],o.find(r.fields,{name:M}))}),c.push(L),c},[]);(await ne(e,E.value.name)).status==200&&(f.value={},i.value={values:{},errors:{}})};return Le("form",i),(e,t)=>{const c=h("Column"),p=h("Button"),_=h("Menu"),L=h("Dropdown"),M=h("Divider"),he=h("Paginator"),ke=h("DataTable"),Q=h("el-button");return n(),d(G,null,[v(ke,{selection:q.value,"onUpdate:selection":t[3]||(t[3]=l=>q.value=l),contextMenuSelection:T.value,"onUpdate:contextMenuSelection":t[4]||(t[4]=l=>T.value=l),multiSortMeta:D.value,"onUpdate:multiSortMeta":t[5]||(t[5]=l=>D.value=l),onRowContextmenu:ge,tableClass:"editable-cells-table module-table",value:g.value,loading:u.collectionLoading,stripedRows:"",resizableColumns:"",columnResizeMode:"fit",sortMode:"multiple",removableSort:"",scrollable:"",scrollHeight:"60vh",class:"dynamic-tbl",style:{"min-height":"60vh !important"}},{footer:k(()=>[u.pagination?(n(),d("div",Qe,[b("div",We,[b("div",Xe,[P(" Items per page: "),v(L,{onChange:t[0]||(t[0]=l=>ve(l)),modelValue:u.pagination.per_page,"onUpdate:modelValue":t[1]||(t[1]=l=>u.pagination.per_page=l),options:pe.value,optionLabel:"label",optionValue:"value",placeholder:"Select a page",class:"filled-dropdown"},null,8,["modelValue","options"])]),v(M,{type:"solid",layout:"vertical"}),b("div",Ze,x(u.pagination.current_page)+" - "+x(u.pagination.total_pages)+" of "+x(u.pagination.total)+" items ",1)]),v(he,{onPage:t[2]||(t[2]=l=>me(l,!1,u.pagination.per_page)),template:"JumpToPageDropdown PrevPageLink NextPageLink",rows:u.pagination&&u.pagination.per_page,totalRecords:u.pagination&&u.pagination.total,rowsPerPageOptions:[5,10,15,20,25,30],class:"custom-paginator"},null,8,["rows","totalRecords"])])):F("",!0)]),empty:k(()=>[ea]),default:k(()=>[u.mode==="edit"?(n(),Z(c,{key:0,frozen:"",headerClass:"custom-header bg-primary-100 text-color-secondary",style:ee(`min-width: 60px; ${N.value}`),bodyClass:"text-center py-1",selectionMode:"multiple"},null,8,["style"])):F("",!0),(n(!0),d(G,null,ae(u.fields,(l,U)=>(n(),Z(c,{key:l._id,field:l.name,header:l.label,sortable:"",sorticon:"check",style:{"min-width":"200px !important"},bodyClass:`text-color-secondary ${l.field_type.name=="lookupModel"?"lookupColumn":""}`,headerClass:"bg-primary-100 text-color-secondary"},{body:k(m=>[a.value.rowId==m.data._id&&a.value.field.name==m.field?(n(),d("div",Ae,[v(I(j),{ref_for:!0,ref_key:"fieldEditingRef",ref:w,config:l,keyName:m.data._id,inline:!0,type:"tableForm",module:I(E).name,onChangeValue:A},null,8,["config","keyName","module"])])):(n(),d("div",{key:1,class:te(["py-2",{"cell-edited":I(o).find(f.value,function(S,$){if($==m.data._id&&I(o).includes(S,l.name))return!0})}]),onDblclick:S=>be(m,l,U)},[b("div",{class:te(["flex align-items-center px-2",m.data[l.name]?"justify-content-between":"justify-content-end"])},[m.data[l.name]?(n(),d("div",$e,[l.relation?(n(),d("span",Pe,[(n(!0),d(G,null,ae(l.relation.displayFieldName,(S,$)=>(n(),d("span",{key:$},[l.rules.ss_pop_up?(n(),d("span",Ge,x(m.data[l.name][S]),1)):l.rules.ss_dropdown?(n(),d("span",Je,[b("span",null,x(m.data[l.name][S]),1)])):(n(),d("span",qe,[b("span",null,x(m.data[l.name][S]),1)]))]))),128))])):(n(),d("span",He,x(m.data[l.name]),1))])):F("",!0),I(o).includes(K.value,l.name)?(n(),d("i",Ke)):(n(),d("i",Ye))],2)],42,Ue))]),_:2},1032,["field","header","bodyClass"]))),128)),v(c,{frozen:"",alignFrozen:"right",exportable:!1,style:ee(`min-width: 60px; ${C.value}`),bodyClass:"text-color-secondary text-center py-1",headerClass:"bg-primary-100 text-color-secondary"},{body:k(l=>[v(p,{class:"menu-btn",icon:"pi pi-ellipsis-v",text:"",size:"small",onClick:U=>fe(U,l.data),"aria-haspopup":"true","aria-controls":"overlay_menu",style:{"font-size":".3rem",padding:"2px 0","background-color":"transparent"}},null,8,["onClick"]),v(_,{ref_key:"menu",ref:J,id:"overlay_menu","data-value":l,model:ce.value,popup:!0},null,8,["data-value","model"])]),_:1},8,["style"]),v(Re,{name:"lvf-slide-fade"},{default:k(()=>[u.sidebar?(n(),d("div",{key:0,ref_key:"listViewFilterRef",ref:O,class:"ddt-slot-1 shadow-4 bg-white"},[b("div",aa,[Ve(e.$slots,"list-view-filter")]),ta],512)):F("",!0)]),_:3})]),_:3},8,["selection","contextMenuSelection","multiSortMeta","value","loading"]),I(o).isEmpty(f.value)?F("",!0):(n(),d("div",la,[v(Q,{onClick:ye},{default:k(()=>[P("Cancel")]),_:1}),v(Q,{type:"primary",onClick:_e},{default:k(()=>[P("Save")]),_:1})]))],64)}}};export{ua as default};
