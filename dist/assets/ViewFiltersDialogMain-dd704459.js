import{r as y,B as K,s as R,E,G as B,c as S,o as D,j as A,e,f,aa as F,i as l,t as p,m as I,n as Y,w as T,g as Z,d as P,p as ie}from"./index-b308c080.js";import{u as ee,a as le,c as M,b as te}from"./index.esm-bea0fbfa.js";const ae={class:"flex flex-column gap-4"},oe={class:"mt-4 flex justify-content-between"},de={class:"p-float-label"},ne=e("label",null,"Filter name *",-1),re={class:"p-error text-sm my-2"},ue={key:0,class:"hidden"},ce={class:"p-float-label"},me=e("label",null,"View filters",-1),pe={class:"flex align-items-center justify-content-between"},be={class:"flex align-items-center gap-2"},ve={class:"p-float-label"},ge=e("label",null,"Sort field *",-1),fe={class:"p-error text-sm my-2"},_e={class:"p-float-label"},we=e("label",null,"Sort order *",-1),Ve={class:"p-error text-sm my-2"},ye={class:"p-float-label"},Fe=e("label",null,"Items per page *",-1),Se={class:"p-error text-sm my-2"},he={class:"flex flex-wrap p-2 align-items-center gap-3"},xe={class:"flex-1 flex flex-column gap-2"},$e={class:"font-bold"},Le={__name:"TableSettings",props:{mode:String,baseModule:Object,module:Object,selectedViewFilter:String,saveTrigger:Number},emits:["save-viewfilter"],setup(i,{emit:z}){const s=i,b=y(!1),v=y(null),{values:N,errors:a,defineComponentBinds:u,isSubmitting:h,setFieldValue:o,handleSubmit:O}=ee({validationSchema:le({filterName:M().label("Filter name").required(),sortField:M().label("Sort field").required(),sortOrder:M().label("Sort order").required(),pageSize:M().label("Items per page").required(),pickList:te().label("Pick list fields").min(1,"Please add at least 1 field").required()})}),w=y(null),x=u("filterName"),_=u("sortField"),d=u("sortOrder"),V=u("pageSize");u("pickList");const $=K(),{viewFiltersDialogLoading:c,viewFiltersDialog:G,viewFilterData:U,perPageItems:H,getBaseModule:C,_getDefaultViewFilter:J,__getViewFilter:Q,_getViewFilters:j,getViewFilters:W,getReconstructedViewFilter:X}=R($),{addViewFilter:q}=$,r=O(async t=>{c.value=!0;const n=Object.assign({},{mode:s.mode,baseModule:s.baseModule,viewFilter:s.selectedViewFilter,type:"table",data:t}),m=await q(n);z("save-viewfilter",m.viewFilter),c.value=!1,G.value=!1}),g=t=>{console.log(t),o("filterName",t.filterName),o("sortField",t.sortField?t.sortField:"created_at"),o("sortOrder",t.sortOrder),o("pageSize",t.pageSize?t.pageSize:15);const n=s.module.fields.filter(m=>!t.fields.some(L=>L._id===m._id));v.value=[n,t.fields],o("pickList",t.fields.map(m=>m._id))};return E(()=>{c.value=!1,w.value=s.selectedViewFilter,s.mode==="new"?(v.value=[s.module.fields,[]],o("pageSize",15),o("sortOrder","ASC"),o("sortField","created_at")):s.mode==="edit-table"&&g(J.value(s.module))}),B(v,(t,n)=>{U.value.data.fields=t[1].map(m=>m._id),b.value&&o("pickList",t[1].map(m=>m._id))}),B(w,(t,n)=>{if(s.mode==="edit-table"){const m=Q.value(t,s.module);g(m)}}),B(()=>s.saveTrigger,(t,n)=>{r()}),(t,n)=>{const m=S("InputText"),L=S("Dropdown"),se=S("PickList");return D(),A("form",ae,[e("div",oe,[e("div",null,[e("span",de,[f(m,F(l(x),{class:`${l(a).filterName?"p-invalid":"border-primary"}`,style:{"min-width":"50vh"}}),null,16,["class"]),ne]),e("div",re,p(l(a).filterName||" "),1)]),i.mode==="edit-table"?(D(),A("div",ue,[e("span",ce,[f(L,{modelValue:w.value,"onUpdate:modelValue":n[0]||(n[0]=k=>w.value=k),options:l(j)(i.module),optionLabel:"filterName",optionValue:"_id",class:"w-full md:w-16rem mr-2"},null,8,["modelValue","options"]),me])])):I("",!0)]),e("div",pe,[e("div",be,[e("div",null,[e("span",ve,[f(L,F(l(_),{options:i.module.fields,optionLabel:"label",optionValue:"name",dataKey:"_id",filter:"",class:["w-full md:w-12rem mr-2",`${l(a).sortField?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),ge]),e("div",fe,p(l(a).sortField||" "),1)]),e("div",null,[e("span",_e,[f(L,F(l(d),{options:[{label:"Ascending",value:"ASC"},{label:"Descending",value:"DESC"}],optionLabel:"label",optionValue:"value",class:["w-full md:w-12rem mr-2",`${l(a).sortOrder?"p-invalid":"border-primary"}`]}),null,16,["class"]),we]),e("div",Ve,p(l(a).sortOrder||" "),1)])]),e("div",null,[e("span",ye,[f(L,F(l(V),{options:l(H),optionLabel:"label",optionValue:"value",class:["w-full md:w-12rem mr-2",`${l(a).pageSize?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),Fe]),e("div",Se,p(l(a).pageSize||" "),1)])]),e("div",{class:Y(["border-1 border-round-md p-4",`${l(a).pickList?"border-red-600":"border-primary"}`])},[e("div",{class:Y(["text-sm mb-4",{"p-error":l(a).pickList}])},p(l(a).pickList||"View filter fields"),3),f(se,{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=k=>v.value=k),onSelectionChange:n[2]||(n[2]=k=>b.value=!0),responsive:"",listStyle:"height:342px",dataKey:"_id"},{sourceheader:T(()=>[Z(" Available Fields ")]),targetheader:T(()=>[Z(" Visible Fields ")]),item:T(k=>[e("div",he,[e("div",xe,[e("span",$e,p(k.item.label),1)])])]),_:1},8,["modelValue"])],2)])}}},ke={class:"flex flex-column gap-4"},De={class:"flex flex-column gap-4 mx-auto mt-6"},Te={class:"p-float-label"},ze=e("label",null,"Titles",-1),Me={class:"p-error text-sm my-2"},Be={class:"p-float-label"},Oe=e("label",null,"Summarize By",-1),Ne={class:"p-error text-sm my-2"},Ce={class:"p-float-label"},je=e("label",null,"Group By *",-1),qe={class:"p-error text-sm my-2"},Pe={__name:"KanbanSettings",props:{mode:String,baseModule:Object,module:Object,selectedViewFilter:String,saveTrigger:Number},emits:["save-viewfilter"],setup(i,{emit:z}){const s=i,b=y(),v=y(null),{values:N,errors:a,defineComponentBinds:u,isSubmitting:h,setFieldValue:o,handleSubmit:O}=ee({validationSchema:le({group_by:M().label("Group By").required(),title_ids:te().label("Titles").required()})}),w=u("title_ids"),x=u("summarize_by"),_=u("group_by"),d=K(),{viewFiltersDialogLoading:V,viewFiltersDialog:$,viewFilterData:c,perPageItems:G,getBaseModule:U,getDefaultViewFilter:H,__getViewFilter:C,_getViewFilters:J,getViewFilters:Q,getReconstructedViewFilter:j}=R(d),{addViewFilter:W}=d,X=O(async r=>{V.value=!0;const g=Object.assign({},{baseModule:s.baseModule,viewFilter:s.selectedViewFilter,type:"kanban",data:r}),t=await W(g);z("save-viewfilter",t.viewFilter),V.value=!1,$.value=!1}),q=r=>{let g=[];r.title_ids&&r.title_ids.length>0?g=r.title_ids:g=b.value.filter(t=>t.title).map(t=>t._id),o("title_ids",g),o("summarize_by",r.summarize_by),o("group_by",r.group_by)};return E(()=>{V.value=!1,v.value=s.selectedViewFilter;const r=C.value(s.selectedViewFilter,s.module);b.value=r.fields}),B(v,(r,g)=>{const t=C.value(r,s.module);q(j.value(t))}),B(()=>s.saveTrigger,(r,g)=>{X()}),(r,g)=>{const t=S("MultiSelect"),n=S("Dropdown");return D(),A("div",ke,[e("div",De,[e("div",null,[e("span",Te,[f(t,F(l(w),{options:b.value,optionLabel:"label",optionValue:"_id",filter:"",mutiple:"",class:["w-full md:w-22rem mr-2",`${l(a).title_ids?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),ze]),e("div",Me,p(l(a).title_ids||" "),1)]),e("div",null,[e("span",Be,[f(n,F(l(x),{options:b.value,optionLabel:"label",optionValue:"name",filter:"",class:["w-full md:w-22rem mr-2",`${l(a).summarize_by?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),Oe]),e("div",Ne,p(l(a).summarize_by||" "),1)]),e("div",null,[e("span",Ce,[f(n,F(l(_),{options:b.value,optionLabel:"label",optionValue:"_id",filter:"",class:["w-full md:w-22rem mr-2",`${l(a).group_by?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),je]),e("div",qe,p(l(a).group_by||" "),1)])])])}}};const Ae={class:"flex align-items-center text-2xl"},Ie={class:"material-icons mr-2"},Ke={class:"flex align-items-center justify-content-end my-2"},Ge={__name:"ViewFiltersDialogMain",props:{mode:String,selectedViewFilter:String,module:Object},emits:["saved-viewfilter"],setup(i,{emit:z}){const s=i,b=y(0),v=y(0),N=y(!1),a=K(),{viewFiltersDialogLoading:u,viewFiltersDialog:h,getBaseModule:o,getViewFilters:O}=R(a),w=()=>{s.mode==="new"||s.mode==="edit-table"?b.value++:s.mode==="edit-kanban"&&v.value++},x=_=>{z("saved-viewfilter",_)};return E(()=>{}),(_,d)=>{const V=S("Button"),$=S("Dialog");return D(),P($,{visible:l(h),"onUpdate:visible":d[5]||(d[5]=c=>ie(h)?h.value=c:null),modal:"",maximizable:"",style:{width:"70vw"},class:"view-filter-dialog"},{header:T(()=>[e("div",Ae,[e("div",Ie,p(i.mode==="edit-table"?"table_chart":"view_kanban"),1),e("div",null,p(i.mode==="edit-table"||i.mode==="new"?"Table":"Kanban")+" Settings — "+p(l(o).label),1)])]),footer:T(()=>[e("div",Ke,[f(V,{onClick:d[4]||(d[4]=c=>h.value=!1),outlined:"",disabled:N.value||l(u),label:"Cancel",class:"border-round-3xl py-2 px-4 border-color-primary",size:"small"},null,8,["disabled"]),f(V,{onClick:w,disabled:l(u),loading:l(u),label:"Save",class:"reddot-primary border-round-3xl py-2 px-4 text-surface-50"},null,8,["disabled","loading"])])]),default:T(()=>[i.mode==="new"||i.mode==="edit-table"?(D(),P(Le,{key:0,mode:i.mode,baseModule:l(o),module:i.module,selectedViewFilter:i.selectedViewFilter,saveTrigger:b.value,onSaveLoading:d[0]||(d[0]=c=>_.saveLoad(_.payload)),onSaveViewfilter:d[1]||(d[1]=c=>x(c))},null,8,["mode","baseModule","module","selectedViewFilter","saveTrigger"])):I("",!0),i.mode==="edit-kanban"?(D(),P(Pe,{key:1,mode:i.mode,baseModule:l(o),module:i.module,selectedViewFilter:i.selectedViewFilter,saveTrigger:v.value,onSaveLoading:d[2]||(d[2]=c=>_.saveLoad(_.payload)),onSaveViewfilter:d[3]||(d[3]=c=>x(c))},null,8,["mode","baseModule","module","selectedViewFilter","saveTrigger"])):I("",!0)]),_:1},8,["visible"])}}};export{Ge as default};
