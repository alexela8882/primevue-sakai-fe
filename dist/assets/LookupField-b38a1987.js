import{B as ne,s as se,a3 as ie,a5 as ue,r as m,a as ce,E as re,a7 as e,aY as de,c as h,V as me,W as ve,o as a,j as i,i as l,n as P,F as x,k as w,d as C,w as V,g as pe,t as p,e as u,x as R,m as Q,f as z,q as K}from"./index-acce2284.js";const fe={key:1,class:"flex align-items-center lookupSelected",style:{width:"100%"}},ye={class:"flex justify-content-between lookupSelected",style:{width:"100%"}},ke={class:"flex flex-colum ml-2 lookupSelected"},ge=u("i",{class:"pi pi-times lookupRemoveBtn"},null,-1),he=[ge],xe=u("i",{class:"pi pi-search"},null,-1),_e={class:"flex align-items-center lookupSelection"},Se={class:"lookupSelection"},Ve={key:0,class:"font-medium lookupSelection"},Ne={key:1,class:"text-sm text-color-secondary lookupSelection"},be={class:"flex align-items-center lookupSelection"},Ee={class:"lookupSelection"},we={key:0,class:"font-medium lookupSelection"},Ce={key:1,class:"text-sm text-color-secondary lookupSelection"},De={class:"flex justify-content-center"},Le={class:"flex flex-column mt-1"},Fe={__name:"LookupField",props:{field:Object,keyName:String,module:String,inline:Boolean,entity:String},emits:["changeValue"],setup(t,{emit:M}){const d=t,W=ne(),{getModules:q}=se(W),Y=ie(),{fetchLookupPaginated:Z}=Y,{formatLookupOptions:$,extractFieldinExpressionFormat:H,extractEntityinExpressionFormat:J}=ue(),f=m({}),X=m(),D=m(""),N=m({}),A=m({}),_=m(!1),b=m(1),L=m(!0),y=m(!1),O=async s=>{_.value||(_.value=!0,F())},B=m([]),ee=ce();re(()=>{if(e.get(d.field,"rules.ms_pop_up",!1)&&(y.value=!0),f.value=e.find(q.value,{mainEntity:d.field.relation.entity_id.name}),e.has(d.field,"filterQuery")){var s=d.field.filterQuery,c=s.match(/(\%[a-zA-Z0-9_\:\.\#]*\%)/gi);e.forEach(c,function(o){var k=e.trim(o,"%"),T=H(k),S=J(k);e.isEmpty(S)&&(S=e.find(q.value,{name:d.module}).mainEntity),B.value.push({field:T,entity:S})})}});const le=async s=>{b.value=s,F()},U=()=>{_.value=!1};let E=null;const F=async()=>{L.value=!0,E&&E.cancel("Previous search canceled"),E=K.CancelToken.source();try{let s={fieldId:d.field.uniqueName,page:b.value,moduleName:d.module,search:D.value,cancelToken:E},c=[];if(e.isEmpty(B.value)||e.forEach(B.value,function(o){if(!e.isEmpty(n.value.values.main[o.field])&&!e.isNull(n.value.values.main[o.field])){let k=o.entity+"::"+o.field;s[k]=e.isArray(n.value.values.main[o.field])?e.map(n.value.values.main[o.field],"_id"):n.value.values.main[o.field]._id}else c.push(o.field)}),e.isEmpty(c)){let o=await Z(s);N.value=$(o.data,[],d.field),A.value=e.cloneDeep(e.get(o,"meta.pagination",{}))}else ee.add({severity:"error",summary:"Error",detail:"Please select "+e.join(c,", "),position:"top-center",life:3e3});L.value=!1}catch(s){K.isCancel(s)?console.log("Request canceled:",s.message):console.error("Error fetching data:",s)}},te=async()=>{b.value=1,await F()},G=s=>{y.value?e.remove(n.value.values[d.keyName][d.field.name],function(c,o){return o==s}):n.value.values[d.keyName][d.field.name]=null,M("changeValue")},I=s=>{y.value||U(),M("changeValue")},n=de("form");return(s,c)=>{const o=h("el-tag"),k=h("el-button"),T=h("el-input"),S=h("Skeleton"),j=h("Listbox"),ae=h("el-pagination"),oe=me("click-outside");return ve((a(),i("div",{class:P(["lookupField",{invalid:!l(e).isEmpty(l(e).get(l(n).errors[t.keyName],t.field.name,[]))}])},[l(e).isEmpty(l(n).values[t.keyName][t.field.name])?Q("",!0):(a(),i("div",{key:0,class:P(["selectedValue",y.value?"multiple":"single flex align-items-center"]),onClick:O},[y.value?(a(!0),i(x,{key:0},w(X.value,(r,v)=>(a(),C(o,{class:"mr-1",closable:"",key:r.value,onClose:g=>G(v)},{default:V(()=>[pe(p(r.value),1)]),_:2},1032,["onClose"]))),128)):(a(),i("div",fe,[u("div",{class:"material-icons text-white ml-2 lookupSelected",style:R("background:"+l(e).get(f.value,"color","#0091D0"))},p(l(e).get(f.value,"icon","person")),5),u("div",ye,[u("span",ke,p(l(n).values[t.keyName][t.field.name].value),1),u("span",{class:"flex flex-colum mr-2 lookupRemoveBtn",onClick:G},he)])]))],2)),z(T,{modelValue:D.value,"onUpdate:modelValue":c[0]||(c[0]=r=>D.value=r),onClick:O,onKeyup:te,class:"lookupInput",disabled:l(n).formSaving,placeholder:"Please input"},{append:V(()=>[z(k,null,{default:V(()=>[xe]),_:1})]),_:1},8,["modelValue","disabled"]),_.value?(a(),i("div",{key:1,class:P(["lookupOverlay p-overlaypanel p-component",{open:_.value==!0,"w-full":!t.inline,"w-auto":t.inline}])},[L.value?(a(!0),i(x,{key:0},w(l(e).fill(Array(10),"i"),(r,v)=>(a(),C(S,{key:v,height:"2rem",width:t.inline?"300px":"100%",class:"m-2",borderRadius:"5px"},null,8,["width"]))),128)):N.value.group?(a(),C(j,{key:1,modelValue:l(n).values[t.keyName][t.field.name],"onUpdate:modelValue":[c[1]||(c[1]=r=>l(n).values[t.keyName][t.field.name]=r),I],multiple:y.value,options:l(e).get(N.value,"options",[]),optionLabel:"value",optionGroupLabel:"label",optionGroupChildren:"options",listStyle:"max-height:300px"},{option:V(r=>[u("div",_e,[u("div",{class:"material-icons text-white mr-2 lookupSelection",style:R("background:"+l(e).get(f.value,"color","#0091D0"))},p(l(e).get(f.value,"icon","person")),5),u("div",Se,[(a(!0),i(x,null,w(r.option.poupDisplayValues,(v,g)=>(a(),i(x,{key:g},[g==0?(a(),i("span",Ve,p(v),1)):(a(),i("div",Ne,p(v),1))],64))),128))])])]),_:1},8,["modelValue","multiple","options"])):(a(),C(j,{key:2,modelValue:l(n).values[t.keyName][t.field.name],"onUpdate:modelValue":[c[2]||(c[2]=r=>l(n).values[t.keyName][t.field.name]=r),I],multiple:y.value,options:l(e).get(N.value,"options",[]),optionLabel:"value",listStyle:"max-height:300px"},{option:V(r=>[u("div",be,[u("div",{class:"material-icons text-white mr-2 lookupSelection",style:R("background:"+l(e).get(f.value,"color","#0091D0"))},p(l(e).get(f.value,"icon","person")),5),u("div",Ee,[(a(!0),i(x,null,w(r.option.poupDisplayValues,(v,g)=>(a(),i(x,{key:g},[g==0?(a(),i("span",we,p(v),1)):(a(),i("div",Ce,p(v),1))],64))),128))])])]),_:1},8,["modelValue","multiple","options"])),u("div",De,[u("div",Le,[z(ae,{small:"",background:"",layout:"prev, pager, next","default-page-size":10,"current-page":b.value,total:l(e).get(A.value,"total",0),onCurrentChange:le},null,8,["current-page","total"])])])],2)):Q("",!0)],2)),[[oe,U]])}}};export{Fe as default};
