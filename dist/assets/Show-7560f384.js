import{_ as Oe,c as h,o as u,j as b,f as a,e as i,I as B,J as C,r,N as Ke,B as Pe,K as Re,a3 as Ae,U as ze,s as oe,E as Ue,G as E,i as o,t as k,w as c,F as O,k as U,d as f,l as We,m as W,S as K,v as qe}from"./index-c093ce25.js";import{L as ne}from"./ListViewLoader-0720c618.js";import{D as Ge}from"./DataTableLoader-14993c34.js";const Je={},He={class:"flex gap-2"},Qe={class:"flex flex-column gap-2 w-full"},Xe={class:"flex flex-column gap-2 w-full"},Ye={class:"flex flex-column gap-2 w-full"},Ze={class:"flex flex-column gap-2 w-full"},el={class:"flex flex-column gap-2 w-full"};function ll(ue,q){const _=h("Skeleton");return u(),b("div",null,[a(_,{height:"3rem",class:"mb-2"}),i("div",He,[i("div",Qe,[a(_,{height:"10rem"}),a(_,{height:"10rem"}),a(_,{height:"10rem"})]),i("div",Xe,[a(_,{height:"10rem"})]),i("div",Ye,[a(_,{height:"10rem"}),a(_,{height:"10rem"})]),i("div",Ze,[a(_,{height:"10rem"}),a(_,{height:"10rem"}),a(_,{height:"10rem"}),a(_,{height:"10rem"})]),i("div",el,[a(_,{height:"10rem"}),a(_,{height:"10rem"})])])])}const al=Oe(Je,[["render",ll]]),tl={class:"mt-3"},il={key:0,class:"flex align-items-center justify-content-center",style:{height:"60vh !important"}},sl={key:1},ol={class:"text-primary-700"},nl={key:0,class:"my-4"},ul={class:"flex flex-column md:flex-row justify-content-between mt-3 gap-2"},dl={class:"flex align-items-center gap-2"},rl={class:"flex align-items-center gap-2"},cl={key:1,class:"mt-2 mb-4"},vl={class:"md:flex align-items-center justify-content-between gap-1"},ml={class:"w-7"},_l=i("div",{class:"text-xl mb-2"},"Will search through:",-1),pl={class:"text-sm"},gl={class:"p-inputgroup flex-1 mb-2 md:mb-0"},bl={class:"material-icons"},fl=i("div",{class:"text-color-secondary p-2"},"VIEW SETTINGS",-1),hl={class:"flex align-items-center text-color-secondary p-2 cursor-pointer"},wl={class:"material-icons mr-2"},yl=i("div",{class:"text-color-secondary p-2"},"LIST VIEW CONTROLS",-1),Fl={class:"flex align-items-center text-color-secondary p-2 cursor-pointer"},xl={class:"material-icons mr-2"},Vl={key:0,class:"flex align-items-center justify-content-center",style:{height:"60vh !important"}},kl={key:1},Kl={__name:"Show",setup(ue){const q=B(()=>C(()=>import("./ViewFiltersDialogMain-845e3cb5.js"),["assets/ViewFiltersDialogMain-845e3cb5.js","assets/index-c093ce25.js","assets/index-cb49da02.css","assets/index.esm-205d716e.js","assets/ViewFiltersDialogMain-bbe8a5f0.css"])),_=B(()=>C(()=>import("./ListViewFilterContent-a96be577.js"),["assets/ListViewFilterContent-a96be577.js","assets/index-c093ce25.js","assets/index-cb49da02.css"])),de=B(()=>C(()=>import("./DynamicDataTableMain-0a49d006.js"),["assets/DynamicDataTableMain-0a49d006.js","assets/index-c093ce25.js","assets/index-cb49da02.css","assets/Validate-aa9d6bb0.js","assets/DynamicDataTableMain-5df8962c.css"])),re=B(()=>C(()=>import("./DynamicKanban-5e30b820.js"),["assets/DynamicKanban-5e30b820.js","assets/index-c093ce25.js","assets/index-cb49da02.css","assets/DynamicKanban-13545c00.css"])),ce=r(0),T=r(!1),$=r(null),g=r(!1),S=r(!1),n=r(),w=r("new"),y=r(!1),D=r(0),ve=Ke(),v=r({}),F=r(),p=r(),P=r(),G=r(),R=r(),x=r(),J=Pe(),H=Re(),me=Ae(),_e=ze(),{listViewFilterOverlay:Sl,viewFiltersDialogLoading:L,viewFiltersDialogSwitch:M,viewFiltersDialog:j,moduleLoading:pe,collectionLoading:ge,getModule:Dl,getModules:be,getBaseModule:m,getCollection:Ll,_getViewFilters:fe,getViewFilters:Ml,_getDefaultViewFilter:he,getDefaultViewFilter:Il,_getViewFilterIds:we,__getViewFilter:Q,getViewFilter:El,_getSearchFields:ye,_getSearchKeyFields:Tl,_getSearchKeyFieldIds:Fe,_getFieldDetailsById:xe}=oe(J),{searchModule:Ve,_fetchModule:X,fetchModule:$l,fetchModules:jl,fetchBaseModule:ke}=J,{getTabs:I}=oe(H),{addTab:Se,toggleWindows:Y,maximizeTab:Nl}=H,{setFormReset:De}=me,Z=r(!1),ee=r(!1),Le=r([{label:"New",icon:"add",command:e=>{console.log(e),w.value="new",D.value+=1,L.value=!0,M.value=!0,j.value=!0}},{label:"Edit table settings",icon:"table_chart",command:e=>{console.log(e),w.value="edit-table",D.value+=1,L.value=!0,M.value=!0,j.value=!0}},{label:"Edit kanban settings",icon:"view_kanban",command:e=>{console.log(e),w.value="edit-kanban",D.value+=1,L.value=!0,M.value=!0,j.value=!0}}]),Me=r([{label:"Table view",icon:"table_chart",command:e=>{console.log(e),v.value.currentDisplay="table"}},{label:"Kanban view",icon:"view_kanban",disabled:!1,command:e=>{console.log(e),v.value.group_by!==null?v.value.currentDisplay="kanban":(w.value="edit-kanban",D.value+=1,L.value=!0,M.value=!0,j.value=!0)}},{label:"Split view",icon:"vertical_split",disabled:!0,command:e=>{console.log(e)}}]),le=async e=>{g.value=!0;let l=1;e.jump?l=n.meta&&n.meta.pagination:l=e.event.page+1;let s=Object.assign({},{moduleName:m.value.name,viewFilter:p.value,page:l>1?l:null,limit:e.per_page,search:$.value,searchFields:te(),reuse:!0});n.value=await X(s),g.value=!1},Ie=async e=>{const l=e.value;await le({event:e,jump:!0,per_page:l})},Ee=async e=>{let l=Object.assign({},{type:"module-form",style:"window",name:`${e.name}-window-create-form`,label:`${e.label} Form`,_module:e.name,expanded:!1,opened:!1,mode:"modal",opened_order:null});I.value.findIndex((d,V)=>d.name===l.name)==-1?await Se(l,!0):Te(e)},Te=(e,l)=>{_e.require({group:"templating",header:"Unsaved "+e.mainEntity+" Alert",message:e.mainEntity,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-outlined",rejectLabel:"Continue",acceptLabel:"Create New "+e.mainEntity,accept:()=>{let s=I.value.findIndex(d=>d.name===`${e.name}-window-create-form`);De(`${e.name}-window-create-form`),Y(I.value[s])},reject:()=>{let s=I.value.findIndex(d=>d.name===`${e.name}-window-create-form`);Y(I.value[s])}})},A=async e=>{S.value=!0,g.value=!0,await ke(ve.params.id);let l=Object.assign({},{moduleName:m.value.name,viewFilter:p.value&&p.value,page:null,limit:F.value&&F.value.pageSize,reuse:!0});const s=await X(l);n.value=s,ce.value=n.value.viewFilters.length,e?v.value=Q.value(e,n.value):v.value=he.value(n.value),F.value=v.value&&v.value,p.value=F.value._id,P.value=qe(()=>we.value(n.value)),G.value=ye.value(n.value);let d=n.value.viewFilters.find(V=>V.isDefault);d&&d.search_fields&&d.search_fields.length>0?x.value=d.search_fields:x.value=Fe.value(n.value),S.value=!1,g.value=!1},$e=e=>e.find(s=>s._id===m.value._id),ae=()=>{const e=m.value.viewFilters.find(l=>l._id===p.value);F.value=e,p.value=e&&e._id},je=async()=>{S.value=!0;let e=Object.assign({},{module:m.value.name,search:$.value,viewFilter:p.value,searchFields:te(),selectedSearchKeyIds:x.value});const l=await Ve(e);l&&(n.value=l),S.value=!1,T.value=!1},te=()=>{let e=[];return x.value.map(l=>{let s=Object.assign({},{"searchFields[]":l});e.push(s)}),e};return Ue(async()=>{await A(null)}),E(p,async(e,l)=>{e&&(console.log("view filter"),ae(),await A(e))}),E(P,(e,l)=>{e&&(P.value=e.value)}),E(()=>be.value,async(e,l)=>{let s=$e(e);s.meta.per_page!==F.value&&(w.value==="new"&&(F.value=s.viewFilters[s.viewFilters.length-1],p.value=F.value._id),v.value=Q.value(p.value,s)),w.value=null},{deep:!0}),E(()=>w.value,async(e,l)=>{ae(),e===null&&await A(p.value)}),E(()=>x.value,async(e,l)=>{R.value=[],e.map(s=>{let d=Object.assign({},{fields:n.value.fields,_id:s}),V=xe.value(d);R.value.push(V.label)})}),(e,l)=>{const s=h("ProgressSpinner"),d=h("Skeleton"),V=h("el-option"),ie=h("el-select"),Ne=h("el-popover"),Be=h("el-input"),N=h("Button"),se=h("Menu");return u(),b(O,null,[i("div",tl,[o(pe)?(u(),b("div",il,[a(s)])):(u(),b("div",sl,[i("h4",ol,k(o(m).label),1),i("div",null,[o(ge)?(u(),b("div",nl,[i("div",ul,[i("div",dl,[a(d,{width:"10rem",height:"2.5rem"}),a(d,{width:"10rem",height:"2.5rem"})]),i("div",rl,[a(d,{width:"10rem",height:"2.5rem"}),a(d,{width:"3rem",height:"2.5rem"}),a(d,{width:"3rem",height:"2.5rem"}),a(d,{width:"3rem",height:"2.5rem"}),a(d,{width:"8rem",height:"2.5rem"})])])])):(u(),b("div",cl,[i("div",vl,[i("div",ml,[a(ie,{modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=t=>p.value=t),disabled:g.value,"collapse-tags":"",placeholder:"Select View Filters",style:{"max-width":"150px"},class:"mr-2"},{default:c(()=>[(u(!0),b(O,null,U(o(fe)(n.value),t=>(u(),f(V,{key:t._id,label:t.filterName,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),a(Be,{onKeypress:l[2]||(l[2]=We(t=>je(),["enter"])),onBlur:l[3]||(l[3]=t=>T.value=!1),onFocus:l[4]||(l[4]=t=>T.value=!0),modelValue:$.value,"onUpdate:modelValue":l[5]||(l[5]=t=>$.value=t),disabled:g.value,placeholder:"Search The List...",style:{"max-width":"500px"}},{prepend:c(()=>[a(Ne,{visible:T.value,placement:"bottom",width:400},{reference:c(()=>[a(ie,{modelValue:x.value,"onUpdate:modelValue":l[1]||(l[1]=t=>x.value=t),disabled:g.value,multiple:"","collapse-tags":"","max-collapse-tags":0,filterable:"",placeholder:"Select Fields",style:{"max-width":"150px"}},{default:c(()=>[(u(!0),b(O,null,U(G.value,t=>(u(),f(V,{key:t._id,label:t.label,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),default:c(()=>[i("div",null,[_l,(u(!0),b(O,null,U(R.value,(t,z)=>(u(),b("div",{key:z},[i("div",pl,k(t),1)]))),128))])]),_:1},8,["visible"])]),_:1},8,["modelValue","disabled"])]),i("div",null,[i("div",gl,[a(N,{onClick:l[6]||(l[6]=t=>ee.value.toggle(t)),disabled:g.value,type:"button","aria-haspopup":"true","aria-controls":"tbl_overlay_menu2",class:"material-icon border-round-md mr-2"},{icon:c(()=>[i("div",bl,k(v.value.currentDisplay===null||v.value.currentDisplay==="table"?"table_chart":"view_kanban"),1)]),_:1},8,["disabled"]),a(se,{ref_key:"tblMenu2",ref:ee,id:"tbl_overlay_menu2",class:"mt-2",model:Me.value,popup:!0},{start:c(()=>[fl]),item:c(({item:t,label:z,props:Ce})=>[i("div",hl,[i("div",wl,k(t.icon),1),i("div",null,k(t.label),1)])]),_:1},8,["model"]),a(N,{onClick:l[7]||(l[7]=t=>Z.value.toggle(t)),loading:o(L),disabled:g.value,type:"button",icon:"pi pi-cog","aria-haspopup":"true","aria-controls":"tbl_overlay_menu",class:"border-round-md mr-2"},null,8,["loading","disabled"]),a(se,{ref_key:"tblMenu",ref:Z,id:"tbl_overlay_menu",class:"mt-2",model:Le.value,popup:!0},{start:c(()=>[yl]),item:c(({item:t,label:z,props:Ce})=>[i("div",Fl,[i("div",xl,k(t.icon),1),i("div",null,k(t.label),1)])]),_:1},8,["model"]),a(N,{onClick:l[8]||(l[8]=t=>y.value=!0),disabled:y.value||g.value,icon:"pi pi-filter","aria-label":"Submit",class:"list-view-filter-btn border-round-md mr-2"},null,8,["disabled"]),o(m).name!="salesquotes"?(u(),f(N,{key:0,class:"border-round-md mr-2",disabled:g.value,icon:"pi pi-plus",onClick:l[9]||(l[9]=t=>Ee(o(m))),label:`New ${o(m).label}`},null,8,["disabled","label"])):W("",!0)])])])]))]),S.value?(u(),b("div",Vl,[a(s)])):(u(),b("div",kl,[v.value.currentDisplay===null||v.value.currentDisplay==="table"?(u(),f(K,{key:0},{fallback:c(()=>[a(Ge)]),default:c(()=>[(u(),f(o(de),{key:o(m)._id,mode:"edit",moduleId:o(m)._id,moduleEntityName:o(m).mainEntity,moduleName:o(m).name,moduleLabel:o(m).label,viewFilter:v.value,fields:v.value.fields,data:n.value.data,pagination:n.value.meta&&n.value.meta.pagination,collectionLoading:g.value,sidebar:y.value,onToggleSidebar:l[10]||(l[10]=t=>y.value=!y.value),onPaginate:le,onLimitPage:Ie},{"list-view-filter":c(()=>[(u(),f(K,null,{fallback:c(()=>[a(ne)]),default:c(()=>[a(o(_),{baseModule:o(m),module:n.value},null,8,["baseModule","module"])]),_:1}))]),_:1},8,["moduleId","moduleEntityName","moduleName","moduleLabel","viewFilter","fields","data","pagination","collectionLoading","sidebar"]))]),_:1})):v.value.currentDisplay==="kanban"?(u(),f(K,{key:1},{fallback:c(()=>[a(al)]),default:c(()=>[a(o(re),{viewFilterId:v.value._id,groupBy:v.value.group_by,summarizeBy:v.value.summarize_by,moduleName:o(m).name,moduleLabel:o(m).label,fields:v.value.fields,module:n.value,data:n.value.data,collectionLoading:S.value,sidebar:y.value,onToggleSidebar:l[11]||(l[11]=t=>y.value=!y.value)},{"list-view-filter":c(()=>[(u(),f(K,null,{fallback:c(()=>[a(ne)]),default:c(()=>[a(o(_),{baseModule:o(m),module:n.value},null,8,["baseModule","module"])]),_:1}))]),_:1},8,["viewFilterId","groupBy","summarizeBy","moduleName","moduleLabel","fields","module","data","collectionLoading","sidebar"])]),_:1})):W("",!0)]))]))]),o(M)?(u(),f(o(q),{key:D.value,mode:w.value,selectedViewFilter:p.value,module:n.value},null,8,["mode","selectedViewFilter","module"])):W("",!0)],64)}}};export{Kl as default};
