import{r as _,B as ae,a3 as te,s as D,E as de,G as oe,c as m,o,d as p,w as h,g as se,e as d,t as u,j as i,F as S,k as U,i as x,m as V,a1 as I,f as n,I as ie,J as ue}from"./index-c4eb5734.js";const ne={class:"relative flex flex-column gap-4 text-600"},re=d("div",null,"Filter by",-1),ve={class:"text-lg text-800"},fe=["onClick"],ce={class:"text-lg text-800"},me={key:0,class:"font-italic"},pe={class:"flex flex-wrap mt-2 text-xs white-space-nowrap"},ye={key:0},be={key:0},_e={key:1,class:"flex flex-wrap"},xe={key:1},ge={class:"flex justify-content-between"},ke={class:"filter-by-owner flex flex-column p-3 text-600 gap-3"},Ve=d("div",{class:"text-xl text-color-secondary"},"Filter by",-1),we={class:"flex flex-column gap-3"},Ne={class:"flex align-items-center"},Fe=["for"],Ce={class:"flex align-items-center"},he=["for"],Oe={class:"flex align-items-center justify-content-end"},Be={class:"filter-by-owner flex flex-column p-3 text-600 gap-3"},Me={class:"text-xl font-bold text-color-secondary"},Te={class:"flex flex-column gap-3"},Ae={key:0},je={for:"isBool",class:"ml-2"},Le={key:2},$e=d("label",{for:"isNull",class:"ml-2"}," Is Null ",-1),qe={class:"flex justify-content-end gap-2"},De={class:"sticky top-0"},Ue={__name:"ListViewFilterContent",props:{baseModule:Object,module:Object},emits:["apply-filters"],setup(r,{emit:E}){const P=ie(()=>ue(()=>import("./LookupField-17376770.js"),["assets/LookupField-17376770.js","assets/index-c4eb5734.js","assets/index-40ff91a8.css","assets/LookupField-373edde0.css"])),y=r,z=E,w=_(!1),f=_(!1),O=_(!1),g=_(!1),b=_(!1),N=_(y.module.viewFilters.find(t=>t.isDefault)),e=_({queryType:null,mode:"edit",queryType:N.value.queryType,filters:N.value.filters,data:{mode:"new",uuid:null,field:null,operator:null,value:null,isNull:!1},default:{uuid:null,field:null,operator:null,value:null,isNull:!1}}),B=ae(),M=te(),{_getFieldDetailsById:F}=D(B),{addViewFilter:T}=B,{getPicklist:c}=D(M),{fetchPicklist:R}=M,G=()=>{e.value.data=Object.assign({},e.value.default),e.value.data.mode="new",g.value=!1,b.value=!0},J=(t,l)=>{let s=F.value({fields:y.module.fields,_id:t.field._id}),v=F.value({fields:c.value&&c.value.filter_operators.values,_id:t.operator._id});Object.assign(e.value.data,{uuid:t.uuid,field:s,operator:v,value:Array.isArray(t.values)?t.values.map(k=>k._id):t.values,isNull:t.isNull}),e.value.data.mode="edit",g.value=!1,b.value=!0},A=async()=>{f.value=!0;let t=Object.assign({},{uuid:e.value.data.uuid,field_id:e.value.data.field._id,operator_id:e.value.data.operator._id,values:e.value.data.value,isNull:e.value.data.isNull});const l=Object.assign({},{mode:e.value.mode,baseModule:y.baseModule,viewFilter:y.module.viewFilters.find(v=>v.isDefault)._id,type:"filters",data:{mode:e.value.data.mode,queryType:e.value.queryType,filters:t}}),s=await T(l);s&&s.status===200&&(l.data.mode==="new"?H(s.data.filters[0]):K(s.data.filters[0]))},H=t=>{console.log(t),e.value.filters instanceof Array||(e.value.filters=[]),e.value.filters.push(t),b.value=!b.value,f.value=!1},K=t=>{console.log(e.value.data.field),e.value.filters.map(l=>{l.uuid===t.uuid&&Object.assign(l,t)}),f.value=!1},Q=()=>{g.value=!0,b.value=!1},C=async t=>{await R(t)},W=t=>{e.value.data.value=null},X=async()=>{w.value=!0;const t=Object.assign({},{mode:e.value.mode,baseModule:y.baseModule,viewFilter:y.module.viewFilters.find(s=>s.isDefault)._id,type:"filters",data:{queryType:e.value.queryType}}),l=await T(t);l&&l.status===200&&z("apply-filters",N.value),w.value=!1};return de(async()=>{Object.keys(c.value).length===0&&(O.value=!0,C("filter_operators"),O.value=!1),e.value.filters instanceof Array&&e.value.filters.length>0&&e.value.filters.map(t=>{const l=F.value({fields:y.module.fields,_id:t.field._id});C(l.listName)})}),oe(()=>e.value,(t,l)=>{t.data.field&&t.data.field.field_type.name==="picklist"&&C(t.data.field.listName)},{deep:!0}),(t,l)=>{const s=m("RadioButton"),v=m("Button"),k=m("Dropdown"),j=m("Checkbox"),Y=m("Calendar"),Z=m("MultiSelect"),ee=m("inputText"),le=m("Card");return o(),p(le,{style:{overflow:"hidden"},class:""},{title:h(()=>[se("Filters")]),content:h(()=>[d("div",null,[d("div",ne,[d("div",{onClick:Q,class:"flex flex-column gap-2 p-3 border-1 border-400 hover:border-600 hover:surface-100 border-round-md cursor-pointer"},[re,d("div",ve,u(e.value.queryType),1)]),e.value.filters instanceof Array&&e.value.filters.length>=1?(o(!0),i(S,{key:0},U(e.value.filters,(a,L)=>(o(),i("div",{onClick:$=>J(a,L),key:L,class:"flex flex-column gap-2 p-3 border-1 border-400 hover:border-600 bg-orange-100 hover:bg-orange-200 border-round-md cursor-pointer"},[d("div",null,u(a.field.label),1),d("div",ce,[x(c).filter_operators?(o(),i("div",me,u(a.operator.label),1)):V("",!0),d("div",pe,[Array.isArray(a.values)?(o(),i("div",ye,[a.isNull?(o(),i("div",be," Null ")):(o(),i("div",_e,[(o(!0),i(S,null,U(a.values,($,q)=>(o(),i("div",{key:q},u($.label)+u(a.values.length-1!==q?",Â ":""),1))),128))]))])):(o(),i("div",xe,u(a.isNull?"Null":a.values),1))])])],8,fe))),128)):V("",!0),d("div",ge,[d("a",{onClick:l[0]||(l[0]=a=>G()),href:"javascript:void(0);"},"add filter")])])]),(o(),p(I,{to:`${g.value?".ddt-div-1":".hidden-div"}`},[d("div",ke,[Ve,d("div",we,[d("div",Ne,[n(s,{modelValue:e.value.queryType,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.queryType=a),inputId:`All ${r.baseModule.name}`,value:"all"},null,8,["modelValue","inputId"]),d("label",{for:`All ${r.baseModule.name}`,class:"ml-2"},"All "+u(r.baseModule.name),9,Fe)]),d("div",Ce,[n(s,{modelValue:e.value.queryType,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.queryType=a),inputId:`My ${r.baseModule.name}`,value:"owned"},null,8,["modelValue","inputId"]),d("label",{for:`My ${r.baseModule.name}`,class:"ml-2"},"My "+u(r.baseModule.name),9,he)]),d("div",Oe,[n(v,{onClick:l[3]||(l[3]=a=>g.value=!1),label:"DONE",outlined:"",size:"large"})])])])],8,["to"])),(o(),p(I,{to:`${b.value?".ddt-div-1":".hidden-div"}`},[d("div",Be,[d("div",Me,u(e.value.data.mode=="new"?"Add filter":"Edit filter"),1),d("div",Te,[n(k,{modelValue:e.value.data.field,"onUpdate:modelValue":l[4]||(l[4]=a=>e.value.data.field=a),onChange:l[5]||(l[5]=a=>W(a)),options:r.module.fields,optionLabel:"label",placeholder:"Select a field",class:"w-full",filter:""},null,8,["modelValue","options"]),n(k,{modelValue:e.value.data.operator,"onUpdate:modelValue":l[6]||(l[6]=a=>e.value.data.operator=a),options:x(c).filter_operators&&x(c).filter_operators.values,optionLabel:"label",placeholder:"Select an operator",class:"w-full"},null,8,["modelValue","options"]),e.value.data.field&&e.value.data.field.field_type.name==="boolean"?(o(),i("div",Ae,[n(j,{modelValue:e.value.data.value,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.data.value=a),binary:"",variant:"filled",inputId:"isBool",disabled:e.value.data.isNull},null,8,["modelValue","disabled"]),d("label",je,u(e.value.data.value instanceof Array?e.value.data.value[0]:e.value.data.value),1)])):e.value.data.field&&e.value.data.field.field_type.name==="date"?(o(),p(Y,{key:1,modelValue:e.value.data.value,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.data.value=a),disabled:e.value.data.isNull},null,8,["modelValue","disabled"])):V("",!0),e.value.data.field&&e.value.data.field.field_type.name==="lookupModel"?(o(),i("div",Le,[n(x(P),{modelValue:e.value.data.value,"onUpdate:modelValue":l[9]||(l[9]=a=>e.value.data.value=a),field:e.value.data.field,keyName:"",formField:!1,inline:!0,module:r.module.name,optionValue:"_id",onLoad:!0,entity:e.value.data.field.entity.name},null,8,["modelValue","field","module","entity"])])):e.value.data.field&&e.value.data.field.field_type.name==="picklist"?(o(),p(Z,{key:3,modelValue:e.value.data.value,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.data.value=a),options:x(c)[e.value.data.field.listName]&&x(c)[e.value.data.field.listName].values,optionLabel:"value",optionValue:"_id",placeholder:"Select",maxSelectedLabels:3,disabled:e.value.data.isNull,class:"w-full"},null,8,["modelValue","options","disabled"])):e.value.data.field&&e.value.data.field.field_type.name==="text"?(o(),p(ee,{key:4,modelValue:e.value.data.value,"onUpdate:modelValue":l[11]||(l[11]=a=>e.value.data.value=a),disabled:e.value.data.isNull},null,8,["modelValue","disabled"])):V("",!0),d("div",null,[n(j,{modelValue:e.value.data.isNull,"onUpdate:modelValue":l[12]||(l[12]=a=>e.value.data.isNull=a),binary:"",variant:"filled",inputId:"isNull"},null,8,["modelValue"]),$e])]),d("div",qe,[n(v,{onClick:l[13]||(l[13]=a=>b.value=!1),disabled:f.value,outlined:"",label:"Cancel",severity:"secondary",size:"small"},null,8,["disabled"]),e.value.data.mode==="new"?(o(),p(v,{key:0,onClick:l[14]||(l[14]=a=>A()),disabled:!e.value.data.field||!e.value.data.operator||f.value,loading:f.value,outlined:"",label:"Done",size:"small"},null,8,["disabled","loading"])):(o(),p(v,{key:1,onClick:l[15]||(l[15]=a=>A()),disabled:!e.value.data.field||!e.value.data.operator||f.value,loading:f.value,outlined:"",label:"Update",size:"small"},null,8,["disabled","loading"]))])])],8,["to"]))]),footer:h(()=>[d("div",De,[n(v,{onClick:l[16]||(l[16]=a=>X()),loading:w.value,label:"Apply filter",size:"small"},null,8,["loading"])])]),_:1})}}};export{Ue as default};
