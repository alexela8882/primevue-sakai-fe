import{r as F,B as E,s as G,E as Q,G as B,c as x,o as C,j as ee,e,f,aa as S,i as l,t as c,n as X,w as z,g as Y,d as R,m as Z,p as oe}from"./index-6fdddc5c.js";import{u as le,a as te,c as D,b as se}from"./index.esm-e04ffe01.js";const ne={class:"flex flex-column gap-4"},re={class:"mt-4 flex justify-content-between"},de={class:"p-float-label"},ue=e("label",null,"Filter name *",-1),ce={class:"p-error text-sm my-2"},me={class:"p-float-label"},pe=e("label",null,"Query type",-1),be={class:"p-error text-sm my-2"},ve={class:"flex align-items-center justify-content-between"},ge={class:"flex align-items-center gap-2"},_e={class:"p-float-label"},fe=e("label",null,"Sort field *",-1),ye={class:"p-error text-sm my-2"},we={class:"p-float-label"},Ve=e("label",null,"Sort order *",-1),Se={class:"p-error text-sm my-2"},Fe={class:"p-float-label"},he=e("label",null,"Items per page *",-1),xe={class:"p-error text-sm my-2"},$e={class:"flex flex-wrap p-2 align-items-center gap-3"},Te={class:"flex-1 flex flex-column gap-2"},Le={class:"font-bold"},ke={__name:"TableSettings",props:{mode:String,baseModule:Object,module:Object,selectedViewFilter:String,saveTrigger:Number},emits:["save-viewfilter"],setup(a,{emit:M}){const b=F(!1),v=F(null),{values:P,errors:s,defineComponentBinds:r,isSubmitting:$,setFieldValue:i,handleSubmit:N}=le({validationSchema:te({filterName:D().label("Filter name").required(),sortField:D().label("Sort field").required(),sortOrder:D().label("Sort order").required(),pageSize:D().label("Items per page").required(),queryType:D().label("Query Type").required(),pickList:se().label("Pick list fields").min(2,"Please add at least 2 field").required()})}),w=F(null),q=r("filterName"),O=r("sortField"),h=r("sortOrder"),m=r("pageSize"),o=r("queryType");r("pickList");const T=E(),{viewFiltersDialogLoading:L,viewFiltersDialog:g,viewFilterData:U,perPageItems:j,getBaseModule:ie,_getDefaultViewFilter:H,__getViewFilter:I,_getViewFilters:J,getViewFilters:V,getReconstructedViewFilter:W}=G(T),{addViewFilter:K}=T,d=a,n=M,y=N(async t=>{L.value=!0;const _=Object.assign({},{mode:d.mode,baseModule:d.baseModule,viewFilter:d.selectedViewFilter,type:"table",data:t}),u=await K(_);n("save-viewfilter",u.viewFilter),L.value=!1,g.value=!1}),p=t=>{console.log(t),i("filterName",t.filterName),i("sortField",t.sortField?t.sortField:"created_at"),i("sortOrder",t.sortOrder),i("pageSize",t.pageSize?t.pageSize:15),i("queryType",t.queryType?t.queryType:"all");const _=d.module.fields.filter(u=>!t.fields.some(k=>k._id===u._id));v.value=[_,t.fields],i("pickList",t.fields.map(u=>u._id))};return Q(()=>{L.value=!1,w.value=d.selectedViewFilter,d.mode==="new"?(v.value=[d.module.fields,[]],i("queryType","all"),i("pageSize",15),i("sortOrder","ASC"),i("sortField","created_at")):d.mode==="edit-table"&&p(H.value(d.module))}),B(v,(t,_)=>{U.value.data.fields=t[1].map(u=>u._id),b.value&&i("pickList",t[1].map(u=>u._id))}),B(w,(t,_)=>{if(d.mode==="edit-table"){const u=I.value(t,d.module);p(u)}}),B(()=>d.saveTrigger,(t,_)=>{y()}),(t,_)=>{const u=x("InputText"),k=x("Dropdown"),ae=x("PickList");return C(),ee("form",ne,[e("div",re,[e("div",null,[e("span",de,[f(u,S(l(q),{class:`${l(s).filterName?"p-invalid":"border-primary"}`,style:{"min-width":"50vh"}}),null,16,["class"]),ue]),e("div",ce,c(l(s).filterName||" "),1)]),e("div",null,[e("span",me,[f(k,S(l(o),{class:[`${l(s).queryType?"p-invalid":"border-primary"}`,"w-full md:w-16rem mr-2"],options:[{label:"All",value:"all"},{label:"Owned",value:"owned"}],optionLabel:"label",optionValue:"value"}),null,16,["class"]),pe]),e("div",be,c(l(s).queryType||" "),1)])]),e("div",ve,[e("div",ge,[e("div",null,[e("span",_e,[f(k,S(l(O),{options:a.module.fields,optionLabel:"label",optionValue:"name",dataKey:"_id",filter:"",class:["w-full md:w-12rem mr-2",`${l(s).sortField?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),fe]),e("div",ye,c(l(s).sortField||" "),1)]),e("div",null,[e("span",we,[f(k,S(l(h),{options:[{label:"Ascending",value:"ASC"},{label:"Descending",value:"DESC"}],optionLabel:"label",optionValue:"value",class:["w-full md:w-12rem mr-2",`${l(s).sortOrder?"p-invalid":"border-primary"}`]}),null,16,["class"]),Ve]),e("div",Se,c(l(s).sortOrder||" "),1)])]),e("div",null,[e("span",Fe,[f(k,S(l(m),{options:l(j),optionLabel:"label",optionValue:"value",class:["w-full md:w-12rem mr-2",`${l(s).pageSize?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),he]),e("div",xe,c(l(s).pageSize||" "),1)])]),e("div",{class:X(["border-1 border-round-md p-4",`${l(s).pickList?"border-red-600":"border-primary"}`])},[e("div",{class:X(["text-sm mb-4",{"p-error":l(s).pickList}])},c(l(s).pickList||"View filter fields"),3),f(ae,{modelValue:v.value,"onUpdate:modelValue":_[0]||(_[0]=A=>v.value=A),onSelectionChange:_[1]||(_[1]=A=>b.value=!0),responsive:"",listStyle:"height:342px",dataKey:"_id"},{sourceheader:z(()=>[Y(" Available Fields ")]),targetheader:z(()=>[Y(" Visible Fields ")]),item:z(A=>[e("div",$e,[e("div",Te,[e("span",Le,c(A.item.label),1)])])]),_:1},8,["modelValue"])],2)])}}},De={class:"flex flex-column gap-4"},ze={class:"flex flex-column gap-4 mx-auto mt-6"},Me={class:"p-float-label"},qe=e("label",null,"Titles",-1),Oe={class:"p-error text-sm my-2"},Be={class:"p-float-label"},Ce=e("label",null,"Summarize By",-1),Ne={class:"p-error text-sm my-2"},je={class:"p-float-label"},Ae=e("label",null,"Group By *",-1),Pe={class:"p-error text-sm my-2"},Ie={__name:"KanbanSettings",props:{mode:String,baseModule:Object,module:Object,selectedViewFilter:String,saveTrigger:Number},emits:["save-viewfilter"],setup(a,{emit:M}){const b=F(),v=F(null),{values:P,errors:s,defineComponentBinds:r,isSubmitting:$,setFieldValue:i,handleSubmit:N}=le({validationSchema:te({group_by:D().label("Group By").required(),title_ids:se().label("Titles").required()})}),w=r("title_ids"),q=r("summarize_by"),O=r("group_by"),h=E(),{viewFiltersDialogLoading:m,viewFiltersDialog:o,viewFilterData:T,perPageItems:L,getBaseModule:g,getDefaultViewFilter:U,__getViewFilter:j,_getViewFilters:ie,getViewFilters:H,getReconstructedViewFilter:I}=G(h),{addViewFilter:J}=h,V=a,W=M,K=N(async n=>{m.value=!0;const y=Object.assign({},{baseModule:V.baseModule,viewFilter:V.selectedViewFilter,type:"kanban",data:n}),p=await J(y);W("save-viewfilter",p.viewFilter),m.value=!1,o.value=!1}),d=n=>{let y=[];n.title_ids&&n.title_ids.length>0?y=n.title_ids:y=b.value.filter(p=>p.title).map(p=>p._id),i("title_ids",y),i("summarize_by",n.summarize_by),i("group_by",n.group_by)};return Q(()=>{m.value=!1,v.value=V.selectedViewFilter;const n=j.value(V.selectedViewFilter,V.module);b.value=n.fields}),B(v,(n,y)=>{const p=j.value(n,V.module);d(I.value(p))}),B(()=>V.saveTrigger,(n,y)=>{K()}),(n,y)=>{const p=x("MultiSelect"),t=x("Dropdown");return C(),ee("div",De,[e("div",ze,[e("div",null,[e("span",Me,[f(p,S(l(w),{options:b.value,optionLabel:"label",optionValue:"_id",filter:"",mutiple:"",class:["w-full md:w-22rem mr-2",`${l(s).title_ids?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),qe]),e("div",Oe,c(l(s).title_ids||" "),1)]),e("div",null,[e("span",Be,[f(t,S(l(q),{options:b.value,optionLabel:"label",optionValue:"name",filter:"",class:["w-full md:w-22rem mr-2",`${l(s).summarize_by?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),Ce]),e("div",Ne,c(l(s).summarize_by||" "),1)]),e("div",null,[e("span",je,[f(t,S(l(O),{options:b.value,optionLabel:"label",optionValue:"_id",filter:"",class:["w-full md:w-22rem mr-2",`${l(s).group_by?"p-invalid":"border-primary"}`]}),null,16,["options","class"]),Ae]),e("div",Pe,c(l(s).group_by||" "),1)])])])}}};const Ke={class:"flex align-items-center text-2xl"},Re={class:"material-icons mr-2"},Ee={class:"flex align-items-center justify-content-end my-2"},Ue={__name:"ViewFiltersDialogMain",props:{mode:String,selectedViewFilter:String,module:Object},emits:["saved-viewfilter"],setup(a,{emit:M}){const b=F(0),v=F(0),P=F(!1),s=E(),{viewFiltersDialogLoading:r,viewFiltersDialog:$,getBaseModule:i,getViewFilters:N}=G(s),w=a,q=M,O=()=>{w.mode==="new"||w.mode==="edit-table"?b.value++:w.mode==="edit-kanban"&&v.value++},h=m=>{q("saved-viewfilter",m)};return Q(()=>{}),(m,o)=>{const T=x("Button"),L=x("Dialog");return C(),R(L,{visible:l($),"onUpdate:visible":o[5]||(o[5]=g=>oe($)?$.value=g:null),modal:"",maximizable:"",style:{width:"70vw"},class:"view-filter-dialog"},{header:z(()=>[e("div",Ke,[e("div",Re,c(a.mode==="edit-table"?"table_chart":"view_kanban"),1),e("div",null,c(a.mode==="edit-table"||a.mode==="new"?"Table":"Kanban")+" Settings — "+c(l(i).label),1)])]),footer:z(()=>[e("div",Ee,[f(T,{onClick:o[4]||(o[4]=g=>$.value=!1),outlined:"",disabled:P.value||l(r),label:"Cancel",class:"border-round-3xl py-2 px-4 border-color-primary",size:"small"},null,8,["disabled"]),f(T,{onClick:O,disabled:l(r),loading:l(r),label:"Save",class:"reddot-primary border-round-3xl py-2 px-4 text-surface-50"},null,8,["disabled","loading"])])]),default:z(()=>[a.mode==="new"||a.mode==="edit-table"?(C(),R(ke,{key:0,mode:a.mode,baseModule:l(i),module:a.module,selectedViewFilter:a.selectedViewFilter,saveTrigger:b.value,onSaveLoading:o[0]||(o[0]=g=>m.saveLoad(m.payload)),onSaveViewfilter:o[1]||(o[1]=g=>h(g))},null,8,["mode","baseModule","module","selectedViewFilter","saveTrigger"])):Z("",!0),a.mode==="edit-kanban"?(C(),R(Ie,{key:1,mode:a.mode,baseModule:l(i),module:a.module,selectedViewFilter:a.selectedViewFilter,saveTrigger:v.value,onSaveLoading:o[2]||(o[2]=g=>m.saveLoad(m.payload)),onSaveViewfilter:o[3]||(o[3]=g=>h(g))},null,8,["mode","baseModule","module","selectedViewFilter","saveTrigger"])):Z("",!0)]),_:1},8,["visible"])}}};export{Ue as default};
