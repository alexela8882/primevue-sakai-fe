import{B as Z,a4 as z,s as J,a5 as $,a as G,r as m,E as H,a2 as t,aa as K,c as F,o as a,j as i,f as h,e as n,g,t as x,i as y,F as _,k as b,n as U,m as W,d as X,w as T,I as Y,J as ee}from"./index-62853e10.js";import{v as te}from"./Validate-97e58e3d.js";const se={key:0,class:"flex align-items-center justify-content-center"},le={style:{height:"60vh","overflow-y":"auto","overflow-x":"hidden"}},ae=n("b",null,"Opportunity",-1),ie=n("br",null,null,-1),oe=n("b",null,"Current Account Name",-1),ne=n("p",{class:"p-text-secondary block mt-3 mb-0"},"Please select account where to transfer the opportunity:",-1),re={key:0,class:"formSectionLabel"},ue={class:"grid"},de={class:"flex justify-content-end gap-2 px-3 py-1 mt-3"},ve={__name:"TransferOpportunity",props:{record:Object},emits:["mounted","closeForm"],setup(S,{emit:w}){const C=Y(()=>ee(()=>import("./Field-e60c6453.js"),["assets/Field-e60c6453.js","assets/index-62853e10.js","assets/index-40ff91a8.css","assets/Validate-97e58e3d.js","assets/Editor-584db963.js","assets/Field-6bcdc0e6.css"])),E=Z(),D=z(),{fetchModuleFields:M,fetchModulePanels:B}=E,{getModuleByName:p}=J(E),{transferOpportunity:O}=D,{controllingFieldChecker:ce,applyAutofill:fe,transformForSaving:I}=$(),{validateForm:V,errorChecker:j}=te(),N=G(),A=w,L=S,v=m(!1),k=m(["account_id","quoteToEmail","quoteToPhoneNo","quote_to_name_id","quoteToName","billingStreet","billingZipCode","billingCity","billingState","billing_country_id","billToName","billEmail","billPhoneNo","bill_to_name_id","shippingStreet","shippingZipCode","shippingCity","shippingState","shipping_country_id","shipToName","shipEmail","shipPhoneNo","ship_to_name_id"]);m([]),m({}),m([]);const e=m({fields:[],panels:[],values:{main:{}},lookup:{},errors:{main:{}},hidden:{fields:[],panels:[]},disabled:[],formName:"transfer-opportunity-form",formSaving:!1});H(async()=>{v.value=!0,t.isEmpty(p.value("salesquotes").fields)&&await M("SalesQuote"),t.isEmpty(p.value("salesquotes").panels)&&await B("salesquotes"),t.forEach(k.value,function(s){e.value.values.main[s]=null}),e.value.fields=t.filter(p.value("salesquotes").fields,function(s){if(t.includes(k.value,s.name))return!0});let u=t.findIndex(e.value.fields,{name:"account_id"});u>-1&&(e.value.fields[u].rules.required=!0),e.value.hidden.fields=t.filter(p.value("salesquotes").fields,function(s){if(!t.includes(k.value,s.name))return!0});let r=t(e.value.fields).filter(function(s){if(s.name!="account_id")return!0}).map("_id").value();t.forEach(p.value("salesquotes").panels,function(s){let d=[];if(t.forEach(s.sections,function(l){let o=t.intersection(l.field_ids[0],r),c=[];t.has(l.field_ids,1)&&(c=t.intersection(l.field_ids[1],r));let f=t.cloneDeep(l);f.field_ids=[],o.length>0&&f.field_ids.push(o),c.length>0&&f.field_ids.push(c),(o.length>0||c.length>0)&&d.push(f)}),d.length>0){let l=t.cloneDeep(s);l.sections=d,e.value.panels.push(l)}}),v.value=!1});const q=u=>{A("closeForm",u)},Q=async()=>{if(e.value.formSaving=!0,e.value.errors.main=V(e.value.values.main,e.value.fields,e.value.hidden.fields,!0),j(e.value.errors.main)){let r=I(e.value.values.main,e.value.fields,!0);(await O(r,L.record._id)).status==200&&(N.add({severity:"success",summary:"Success Message",detail:"Record added",life:3e3}),e.value.formSaving=!1,q(!0))}else N.add({severity:"error",summary:"Error Message",detail:"Please check the form again",life:3e3}),e.value.formSaving=!1};return K("form",e),(u,r)=>{const s=F("ProgressSpinner"),d=F("el-button");return v.value?(a(),i("div",se,[h(s)])):(a(),i(_,{key:1},[n("div",le,[n("p",null,[ae,g(": "+x(S.record.name),1),ie,oe,g(": "+x(S.record.account_id.name),1)]),ne,h(y(C),{formPage:"create",module:"salesquotes",inline:!1,keyName:"main",entity:"SalesQuote",config:y(t).find(e.value.fields,{name:"account_id"})},null,8,["config"]),(a(!0),i(_,null,b(e.value.panels,l=>(a(),i("div",{key:l._id},[(a(!0),i(_,null,b(l.sections,(o,c)=>(a(),i("div",{key:o._id,class:U(["flex flex-column px-1 py-2",c>1?"mt-2":""])},[o.label?(a(),i("h6",re,x(o.label),1)):W("",!0),n("div",ue,[(a(!0),i(_,null,b(o.field_ids,(f,R)=>(a(),i("div",{key:R,class:"col flex flex-column gap-2"},[(a(!0),i(_,null,b(f,P=>(a(),X(y(C),{key:P,formPage:"create",module:"salesquotes",inline:!1,keyName:"main",entity:"SalesQuote",config:y(t).find(e.value.fields,{_id:P})},null,8,["config"]))),128))]))),128))])],2))),128))]))),128))]),n("div",de,[h(d,{onClick:r[0]||(r[0]=l=>q(!1)),disabled:v.value||e.value.formSaving},{default:T(()=>[g("Cancel")]),_:1},8,["disabled"]),h(d,{type:"primary",onClick:Q,disabled:v.value||e.value.formSaving,loading:e.value.formSaving},{default:T(()=>[g("Transfer")]),_:1},8,["disabled","loading"])])],64))}}};export{ve as default};
