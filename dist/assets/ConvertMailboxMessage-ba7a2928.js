import{C as be,_ as ge,r,v as ye,s as j,A as O,z as xe,c as V,o as n,j as d,e as o,f as m,w as h,t as c,i as s,m as p,F as E,k as I,Z as Me,n as Ve,d as T,S as G,a5 as he}from"./index-3c3245ef.js";import{u as we,a as q,c as H}from"./index.esm-3db80cf2.js";import{u as ke}from"./index-a271a816.js";import{u as Ce}from"./index-ca65599b.js";import{T as J}from"./TwoColumnList-47ae1963.js";const Ne={class:"flex flex-column gap-3 m-4"},Ee={class:"flex align-items-center"},Ie=o("label",{class:"ml-2"},"Choose existing",-1),qe={class:"flex align-items-center"},Se={key:0},Fe={class:"flex flex-column gap-3 m-4"},De={class:"flex align-items-center"},Be=o("label",{class:"ml-2"},"Create new",-1),$e=o("h3",null,"Quick add",-1),je=o("div",{class:"text-l text-700 font-bold bg-primary-50 p-2 mb-4"},"All required fields",-1),Oe={class:"grid"},Te={class:"p-float-label"},Re={key:0,class:"text-red-600"},Le=o("h3",null,"Detailed add",-1),Ae={key:0},Ue={class:"text-l text-700 font-bold bg-primary-50 p-2"},ze={class:"flex flex-column mt-4"},Pe={key:0},Qe={key:1},Ze={class:"p-2 border-top-1 border-200"},Ge={class:"flex align-items-center justify-content-end my-2 gap-2"},al={__name:"ConvertMailboxMessage",props:{convertModule:Object,mailboxMessage:Object},emits:["update-timeout"],setup(K,{emit:W}){const v=K,R=be(()=>ge(()=>import("./SectionFields-4cdd46fa.js"),["assets/SectionFields-4cdd46fa.js","assets/index-3c3245ef.js","assets/index-d1288d3d.css","assets/index-a271a816.js"]));r({test:"initial value"}),r();const w=r({}),y=r({}),L=r(!0),A=r([]),S=r([]),X=r(0),x=r([]),u=r(null),_=r(),{values:He,errors:M,setErrors:Je,setFieldError:Y,ErrorBag:Ke,defineComponentBinds:F,isSubmitting:ee,setFieldValue:le,handleSubmit:oe,meta:k}=we({});F("field0"),r({field_1:F("test_fields.field_1")});const U=ye(),te=ke(),ae=Ce(),{getEntityByName:z,getFieldDetailsByUname:se,getCollection:ne,getModule:ie,convertMailboxLoading:D}=j(U),{getItemPanels:de,getRelatedListsByCname:We}=j(te),{getMailFolderMessages:ue}=j(ae),{fetchModule:re,convertMailboxToInquiry:ce,insertModuleFromMailbox:me}=U,P=async()=>{D.value=!1,await re(v.convertModule.name),x.value=ie.value.fields,x.value.map(e=>Object.assign(e,{...e,data:{value:null}}));const l={};x.value.map(e=>{if(e.rules&&e.rules.required){l[e.uniqueName]=q().label(e.label).required();let a=Object.assign({},{[e.uniqueName]:q().label(e.label).required()});console.log(a)}else l[e.uniqueName]=q().label(e.label).nullable();y.value[e.uniqueName]=F(`${e.uniqueName}`),le(`${e.uniqueName}`,null)}),w.value=l,w.value=H(l),console.log(w.value),S.value=x.value.filter(e=>e.rules&&e.rules.required),X.value=S.value.length,H().shape({field_1:q().label("Field 1").required()}),A.value=de.value.filter(e=>e.controllerMethod.includes("@index")),setTimeout(()=>{L.value=!1,W("update-timeout")},100)},ve=async()=>{_.value==1?Q(null):_e()},Q=l=>{let e=null;l!==null?e=l:e=u.value;const a=z.value(v.convertModule.name);let i=null;const f=v.mailboxMessage.from.emailAddress.name,b=v.mailboxMessage.from.emailAddress.address;i=Object.assign({},{_id:`${Date.now()}`,source_id:"Email",dateRequested:"01-06-2024",dateResponded:"01-06-2024",assigned_to_id:e.owner_id,description:`This is a test from converted mailbox - ${Date.now()}`,type_id:a.mainEntity,link_id:e._id,email_id:v.mailboxMessage.id,name:f,email:b,conversation_id:v.mailboxMessage.conversationId}),pe(i)},_e=async()=>{const l=await C();if(l.inner)console.log(moduleRes);else{let a={_id:Date.now()};Object.keys(l).forEach(b=>{if(l[b]!==null){const N=se.value(b).name,t=l[b];a[N]=t}}),a.owner_id={_id:"5bb104ed678f71061f6451f8",firstName:"Ninoy",lastName:"Cahayon",email:"ninoy.cahayon@escolifesciences.com"};const i={module:v.convertModule,data:a},f=await me(i);f&&f.status===200&&Q(i.data)}},C=oe((l,e)=>{Object.keys(y.value).forEach((a,i)=>{y.value[a].modelValue!==null&&Y(a,null)});try{return w.value.validateSync(l,{abortEarly:!1}),l}catch(a){return a.inner.map(i=>{i.path+"",i.message,e.setFieldError(i.path,i.message)}),a}}),pe=async l=>{const e=await ce(l);e&&e.status===200&&ue.value.value.find(a=>{if(a.id===l.email_id){let i={...a,convertedToInquiry:!0};Object.assign(a,i)}})};return O(()=>_.value,(l,e)=>{l==2&&(u.value=null)}),O(()=>u.value,(l,e)=>{l&&(_.value=1)}),O(()=>v.convertModule,(l,e)=>{console.log(l),P()}),xe(()=>{P(),console.log(z.value(v.convertModule.name))}),(l,e)=>{const a=V("RadioButton"),i=V("Dropdown"),f=V("Divider"),b=V("InputText"),N=V("Button");return n(),d("div",null,[o("div",Ne,[o("div",Ee,[m(a,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),inputId:"ingredient1",name:"1",value:1,disabled:""},null,8,["modelValue"]),Ie]),m(i,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),options:s(ne).data,optionLabel:"owner_id.email",optionvalue:"_id",filter:"",placeholder:"Select",class:"w-full"},{option:h(t=>[o("div",qe,[o("div",null,c(t.option.owner_id.email)+" ("+c(t.option.company)+")",1)])]),_:1},8,["modelValue","options"]),u.value?(n(),d("div",Se,[o("div",null,c(u.value.firstName)+" "+c(u.value.lastName),1),o("div",null," Owner: "+c(u.value.owner_id.firstName)+" "+c(u.value.owner_id.lastName),1),o("div",null,"Company: "+c(u.value.company),1),o("div",null,"Status: "+c(u.value.status_id),1),o("div",null,"Country: "+c(u.value.country_id.name),1)])):p("",!0)]),m(f),o("div",Fe,[o("div",De,[m(a,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t),name:"2",value:2},null,8,["modelValue"]),Be]),o("div",null,[$e,je,o("div",Oe,[(n(!0),d(E,null,I(S.value,(t,B)=>(n(),d("div",{key:B,class:"col-6"},[o("span",Te,[m(b,Me({"onUpdate:modelValue":e[3]||(e[3]=g=>s(C)())},y.value[t.uniqueName],{class:["w-full border-left-3",`${!s(M)[t.uniqueName]&&s(k).touched?"border-green-600":"border-red-600"}`]}),null,16,["class"]),o("label",null,c(t.label),1)]),s(M)[t.uniqueName]?(n(),d("small",Re,c(s(M)[t.uniqueName]),1)):p("",!0)]))),128))]),Le,(n(!0),d(E,null,I(A.value,(t,B)=>(n(),d("div",{key:B,class:"flex flex-column gap-1"},[(n(!0),d(E,null,I(t.sections,(g,Z)=>(n(),d("div",{key:Z,class:Ve(`${Z!==0&&"mt-4"}`)},[o("div",null,[o("div",null,[g.sectionLabel?(n(),d("div",Ae,[o("div",Ue,c(g.sectionLabel),1)])):p("",!0)]),o("div",ze,[t.controllerMethod.indexOf("@index")>-1?(n(),d("div",Pe,[g.field_ids.length>0?(n(),T(G,{key:0},{fallback:h(()=>[m(J)]),default:h(()=>[m(s(R),{mode:"edit",source:"Email",fieldIds:g.field_ids,newModuleFields:x.value,moduleValidationInputs:y.value,moduleValidationErrors:s(M),moduleValidationMeta:s(k),onValidateSyncFunc:e[4]||(e[4]=$=>s(C)())},null,8,["fieldIds","newModuleFields","moduleValidationInputs","moduleValidationErrors","moduleValidationMeta"])]),_:2},1024)):p("",!0),g.additional_fields.length>0?(n(),d("div",Qe,[(n(!0),d(E,null,I(g.additional_fields,($,fe)=>(n(),d("div",{key:fe},[$.ids.length>0?(n(),T(G,{key:0},{fallback:h(()=>[m(J)]),default:h(()=>[m(s(R),{mode:"edit",source:"Email",fieldIds:$.ids,newModuleFields:x.value,moduleValidationInputs:y.value,moduleValidationErrors:s(M),moduleValidationMeta:s(k),onValidateSyncFunc:e[5]||(e[5]=Xe=>s(C)())},null,8,["fieldIds","newModuleFields","moduleValidationInputs","moduleValidationErrors","moduleValidationMeta"])]),_:2},1024)):p("",!0)]))),128))])):p("",!0)])):p("",!0)])])],2))),128))]))),128))])]),L.value?p("",!0):(n(),T(he,{key:0,to:".mailbox-dialog-footer"},[o("div",Ze,[o("div",Ge,[m(N,{onClick:e[6]||(e[6]=t=>l.$emit("trigger-dialog")),disabled:s(D),outlined:"",label:"Cancel",class:"border-round-3xl py-2 px-4 border-color-primary",size:"small"},null,8,["disabled"]),m(N,{onClick:e[7]||(e[7]=t=>ve()),disabled:!_.value||_.value==2&&!s(k).valid,loading:s(D)||s(ee),label:"Proceed",class:"border-round-3xl py-2 px-4"},null,8,["disabled","loading"])])])]))])}}};export{al as default};
