import{M as be,O as we,B as ee,s as O,r as n,v as K,q as he,I as ke,J as xe,N as Ie,a5 as Se,a6 as Ce,G as De,E as Ee,a7 as o,a8 as Q,a9 as Me,c as h,o as s,j as u,f as p,w as k,e as g,g as G,t as I,m as j,d as W,x as X,F as J,k as Y,i as E,n as Z,T as Fe,y as Ne}from"./index-c093ce25.js";import{v as je}from"./Validate-aa9d6bb0.js";const Le=be("moduleDynamicTableStore",()=>{const d=we(),M=ee(),{jsonDbUrl:r}=O(d);O(M);const L=n(!1),y=n([]),T=K(()=>y.value),V=K(()=>x=>{const _=y.value.find(F=>F.module===x);return _?_.content:null});return{getDropdownLists:T,getDropdown:V,fetchDropdownLists:async x=>{L.value=!0;const _=await he(`${r.value}/${x}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(_.status===200&&_.data&&!y.value.find(S=>S.module===x)){let S=Object.assign({},{module:x,content:_.data});y.value.push(S)}L.value=!1}}});const Te={key:0,style:{"white-space":"normal"}},Ve=["onDblclick"],Re={key:0},Be={key:0},Oe={key:0,class:"mr-1"},ze={key:1,class:"mr-1"},Ae={href:"javascript:void(0);",style:{color:"red"}},$e={key:2,class:"mr-1"},Ue={href:"javascript:void(0);"},Ge={key:1},Je={key:1,class:"edit-icon cursor-pointer pi pi-pencil ml-3"},Pe={key:2,class:"edit-icon cursor-pointer pi pi-lock ml-3"},qe={key:0,class:"md:flex justify-content-between font-light"},He={class:"flex align-items-center px-3"},Ke={class:"text-sm text-color-secondary"},Qe={class:"text-sm text-color-secondary"},We=g("div",{class:"text-700"}," No records found ",-1),Xe={style:{overflow:"scroll","max-height":"100%"}},Ye=g("div",{class:"ddt-div-1 shadow-4 bg-white"},null,-1),Ze={key:0,style:{width:"100vw",position:"fixed",bottom:"0",left:"0",height:"54px","text-align":"center","margin-left":"90px",padding:"12px"},class:"shadow-2 align-items-center"},oa={__name:"DynamicDataTableMain",props:{mode:String,sidebar:Boolean,moduleId:String,moduleEntityName:String,moduleName:String,moduleLabel:String,data:Array,pagination:Object,pageItems:Array,rows:Number,pages:Number,viewFilter:Object,fields:Array,collectionLoading:Boolean},emits:["toggle-sidebar","paginate","limit-page"],setup(d,{emit:M}){const r=d,L=ke(()=>xe(()=>import("./Field-a03c18c1.js"),["assets/Field-a03c18c1.js","assets/index-c093ce25.js","assets/index-cb49da02.css","assets/Validate-aa9d6bb0.js","assets/Editor-d83f0cdf.js","assets/Field-3940f18b.css"])),y=n([]);if(r.viewFilter){let a=Object.assign({},{field:r.viewFilter.sortField,order:r.viewFilter.sortOrder=="ASC"?1:-1});y.value.push(a)}n(),n(0);const T=n(null),V=n(null);n(!1);const e=n({rowId:null,field:null,rowIndex:null,columnIndex:null});Ie();const x=n(),_=n(),F=n();n(),n();const S=n(),R=n(),C=n(),ae=ee(),le=Le(),{getModule:P,getCollection:ea,getBaseModule:B,getEntity:aa}=O(ae);O(le);const{validateField:te,errorChecker:oe}=je(),{transformLookupValue:z,transformFieldForSaving:ne}=Se();n([{label:"View",icon:"pi pi-fw pi-search",command:()=>console.log(R.value)},{label:"Delete",icon:"pi pi-fw pi-times",command:()=>console.log(R.value)}]);const ie=n([{label:"View",icon:"pi pi-reply",command:a=>{console.log(a),console.log(C.value);const l=Object.assign({},{name:"modules.pages.detail",params:{name:r.moduleName,id:r.moduleId,pageid:C.value._id}});Ce.push(l)}},{label:"Change Owner",icon:"pi pi-user",command:a=>{console.log(a),console.log(C.value)},visible:r.moduleEntityName===B.value.mainEntity},{label:"Update",icon:"pi pi-refresh",command:a=>{console.log(a),console.log(C.value)},visible:r.moduleEntityName===B.value.mainEntity},{label:"Delete",icon:"pi pi-times",command:a=>{console.log(a),console.log(C.value)},visible:r.moduleEntityName===B.value.mainEntity}]),se=n([{label:"10",value:10},{label:"15",value:15},{label:"20",value:20},{label:"25",value:25},{label:"30",value:30},{label:"35",value:35},{label:"40",value:40},{label:"45",value:45},{label:"50",value:50}]),i=n({values:{},errors:{}}),b=n({}),f=n(),q=n(["owner_id","created_at","updated_at","created_by","updated_by"]),de=async(a,l,c)=>{M("paginate",{event:a,jump:l,per_page:c})},ue=async a=>{M("limit-page",a)},re=a=>{},ce=(a,l)=>{F.value.toggle(a),C.value=l},me=(a,l,c)=>{if(console.log(a),!o.includes(q.value,l.name)&&(e.value.rowId=a.data._id,e.value.rowIndex=a.index,e.value.columnIndex=c,e.value.field=l,!o.has(i.value.values,a.data._id))){let m=o.cloneDeep(a.data);l.field_type.name=="lookupModel"&&(m[l.name]=z(m[l.name],l)),i.value.values[a.data._id]=o.cloneDeep(m),i.value.errors[a.data._id]={},i.value.errors[a.data._id][a.field]=[]}},ve=()=>{b.value={},i.value={},f.value=o.cloneDeep(r.data)};De(()=>r.data,(a,l)=>{f.value=a}),Ee(async()=>{f.value=o.cloneDeep(r.data),console.log(f.value)}),Q(T,a=>{a.target&&a.target.attributes.class.value!=="p-dropdown-item"&&M("toggle-sidebar",!1)}),document.addEventListener("keydown",function(a){a.key==="Escape"&&(console.log("Escape key pressed",a),A())}),Q(V,a=>{let l=o.get(a,"target.classList",[]);console.log(a.target.parentElement.className,l),!o.includes(l,"p-inputtext")&&!o.includes(l,"el-input__inner")&&!o.includes(l,"el-select-dropdown__ite")&&!o.includes(l,"fieldInputSelection")&&!o.includes(l,"lookupSelected")&&!o.includes(l,"lookupInput")&&!o.includes(l,"lookupRemoveBtn")&&!o.includes(l,"lookupSelection")&&a.target.parentElement.className!="el-icon el-select__caret el-select__icon"?(console.log("click outside"),A()):console.log("clicked inside field")});const A=()=>{if(e.value.rowId!=null){let a=o.find(P.value.fields,{name:e.value.field.name});if(console.log(i.value.values[e.value.rowId][e.value.field.name]),i.value.errors[e.value.rowId][e.value.field.name]=te(i.value.values[e.value.rowId],a,P.value.fields),oe(i.value.errors[e.value.rowId])){let c=o.findIndex(f.value,{_id:e.value.rowId}),m=i.value.values[e.value.rowId][e.value.field.name],w=f.value[c][e.value.field.name];e.value.field.field_type.name=="picklist"?m=o.isArray(i.value.values[e.value.rowId][e.value.field.name])?o.join(o.map(i.value.values[e.value.rowId][e.value.field.name],"value"),", "):i.value.values[e.value.rowId][e.value.field.name].value:e.value.field.field_type.name=="lookupModel"&&(m=z(i.value.values[e.value.rowId][e.value.field.name],e.value.field,!0),w=z(f.value[c][e.value.field.name],e.value.field,!0)),m!=w&&(console.log(e.value.field,m,w),e.value.field.field_type.name=="picklist"?(console.log("picklist changed",i.value.values[e.value.rowId][e.value.field.name].value),f.value[c][e.value.field.name]=i.value.values[e.value.rowId][e.value.field.name].value):f.value[c][e.value.field.name]=i.value.values[e.value.rowId][e.value.field.name],o.has(b.value,e.value.rowId)?o.has(b.value[e.value.rowId],e.value.field.name)||b.value[e.value.rowId].push(e.value.field.name):b.value[e.value.rowId]=[e.value.field.name]),e.value={rowId:null,field:null,rowIndex:null,columnIndex:null}}}},pe=n(!1),fe=()=>{pe.value=!0;let a=o.reduce(b.value,function(l,c,m){let w={_id:m};return o.forEach(c,function(N){w[N]=ne(i.value.values[m][N],o.find(r.fields,{name:N}))}),l.push(w),l},[]);console.log(a)};return Me("form",i),(a,l)=>{const c=h("Column"),m=h("Button"),w=h("Menu"),N=h("Dropdown"),ge=h("Divider"),ye=h("Paginator"),_e=h("DataTable"),H=h("el-button");return s(),u(J,null,[p(_e,{selection:S.value,"onUpdate:selection":l[3]||(l[3]=t=>S.value=t),contextMenuSelection:R.value,"onUpdate:contextMenuSelection":l[4]||(l[4]=t=>R.value=t),multiSortMeta:y.value,"onUpdate:multiSortMeta":l[5]||(l[5]=t=>y.value=t),onRowContextmenu:re,tableClass:"editable-cells-table module-table",value:f.value,loading:d.collectionLoading,stripedRows:"",resizableColumns:"",columnResizeMode:"fit",sortMode:"multiple",removableSort:"",scrollable:"",scrollHeight:"60vh",class:"dynamic-tbl",style:{"min-height":"60vh !important"}},{footer:k(()=>[d.pagination?(s(),u("div",qe,[g("div",He,[g("div",Ke,[G(" Items per page: "),p(N,{onChange:l[0]||(l[0]=t=>ue(t)),modelValue:d.pagination.per_page,"onUpdate:modelValue":l[1]||(l[1]=t=>d.pagination.per_page=t),options:se.value,optionLabel:"label",optionValue:"value",placeholder:"Select a page",class:"filled-dropdown"},null,8,["modelValue","options"])]),p(ge,{type:"solid",layout:"vertical"}),g("div",Qe,I(d.pagination.current_page)+" - "+I(d.pagination.total_pages)+" of "+I(d.pagination.total)+" items ",1)]),p(ye,{onPage:l[2]||(l[2]=t=>de(t,!1,d.pagination.per_page)),template:"JumpToPageDropdown PrevPageLink NextPageLink",rows:d.pagination&&d.pagination.per_page,totalRecords:d.pagination&&d.pagination.total,rowsPerPageOptions:[5,10,15,20,25,30],class:"custom-paginator"},null,8,["rows","totalRecords"])])):j("",!0)]),empty:k(()=>[We]),default:k(()=>[d.mode==="edit"?(s(),W(c,{key:0,frozen:"",headerClass:"custom-header bg-primary-100 text-color-secondary",style:X(`min-width: 60px; ${x.value}`),bodyClass:"text-center py-1",selectionMode:"multiple"},null,8,["style"])):j("",!0),(s(!0),u(J,null,Y(d.fields,(t,$)=>(s(),W(c,{key:t._id,field:t.name,header:t.label,sortable:"",sorticon:"check",style:{"min-width":"200px !important"},bodyClass:`text-color-secondary ${t.field_type.name=="lookupModel"?"lookupColumn":""}`,headerClass:"bg-primary-100 text-color-secondary"},{body:k(v=>[e.value.rowId==v.data._id&&e.value.field.name==v.field?(s(),u("div",Te,[p(E(L),{ref_for:!0,ref_key:"fieldEditingRef",ref:V,config:t,keyName:v.data._id,inline:!0,type:"tableForm",module:E(B).name,onChangeValue:A},null,8,["config","keyName","module"])])):(s(),u("div",{key:1,class:Z(["py-2",{"cell-edited":E(o).find(b.value,function(D,U){if(U==v.data._id&&E(o).includes(D,t.name))return!0})}]),onDblclick:D=>me(v,t,$)},[g("div",{class:Z(["flex align-items-center px-2",v.data[t.name]?"justify-content-between":"justify-content-end"])},[v.data[t.name]?(s(),u("div",Re,[t.relation?(s(),u("span",Be,[(s(!0),u(J,null,Y(t.relation.displayFieldName,(D,U)=>(s(),u("span",{key:U},[t.rules.ss_pop_up?(s(),u("span",Oe,I(v.data[t.name][D]),1)):t.rules.ss_dropdown?(s(),u("span",ze,[g("a",Ae,I(v.data[t.name][D]),1)])):(s(),u("span",$e,[g("a",Ue,I(v.data[t.name][D]),1)]))]))),128))])):(s(),u("span",Ge,I(v.data[t.name]),1))])):j("",!0),E(o).includes(q.value,t.name)?(s(),u("i",Pe)):(s(),u("i",Je))],2)],42,Ve))]),_:2},1032,["field","header","bodyClass"]))),128)),p(c,{frozen:"",alignFrozen:"right",exportable:!1,style:X(`min-width: 60px; ${_.value}`),bodyClass:"text-color-secondary text-center py-1",headerClass:"bg-primary-100 text-color-secondary"},{body:k(t=>[p(m,{class:"menu-btn",icon:"pi pi-ellipsis-v",text:"",size:"small",onClick:$=>ce($,t.data),"aria-haspopup":"true","aria-controls":"overlay_menu",style:{"font-size":".3rem",padding:"2px 0","background-color":"transparent"}},null,8,["onClick"]),p(w,{ref_key:"menu",ref:F,id:"overlay_menu","data-value":t,model:ie.value,popup:!0},null,8,["data-value","model"])]),_:1},8,["style"]),p(Fe,{name:"lvf-slide-fade"},{default:k(()=>[d.sidebar?(s(),u("div",{key:0,ref_key:"listViewFilterRef",ref:T,class:"ddt-slot-1 shadow-4 bg-white"},[g("div",Xe,[Ne(a.$slots,"list-view-filter")]),Ye],512)):j("",!0)]),_:3})]),_:3},8,["selection","contextMenuSelection","multiSortMeta","value","loading"]),E(o).isEmpty(b.value)?j("",!0):(s(),u("div",Ze,[p(H,{onClick:ve},{default:k(()=>[G("Cancel")]),_:1}),p(H,{type:"primary",onClick:fe},{default:k(()=>[G("Save")]),_:1})]))],64)}}};export{oa as default};
