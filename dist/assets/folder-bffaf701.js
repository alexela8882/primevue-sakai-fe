import{r as c,N as le,u as oe,B as se,s as F,v as V,G as E,E as ne,c as g,o as m,j as h,e,t as n,f as a,w as b,d as ae,i as r,g as ie,k as re,n as L,m as ue,F as de,I as ce,J as ve}from"./index-54e8fe55.js";import{u as pe,U as fe}from"./index-e6303673.js";const me={key:0,class:"flex justify-content-center",style:{height:"60vh !important"}},_e={class:"flex flex-column align-items-center justify-content-center text-center mt-n6"},ge={key:1,class:"flex justify-content-center",style:{height:"60vh !important"}},he={class:"flex flex-column align-items-center justify-content-center text-center mt-n6"},xe=e("div",null,"Please wait...",-1),ke={style:{height:"85vh !important","overflow-y":"scroll"}},ye={class:"flex flex-column gap-3 m-3"},be={class:"flex align-items-center justify-content-between"},we={class:"flex align-items-center gap-1"},Me=e("div",{class:"text-2xl text-primary font-bold"},"Mailbox",-1),Ce={class:"font-bold"},Ie={class:"p-input-icon-left w-full"},Le=e("i",{class:"pi pi-search"},null,-1),Pe={class:"flex align-items-center gap-3 m-3"},Se=["onClick"],Te={class:"flex align-items-center justify-content-between gap-6"},$e={class:"flex flex-column gap-1"},qe={class:"font-bold"},Be={class:"flex flex-column gap-2 align-self-start"},Re={key:0},Ne={key:1,class:"p-4 white-space-nowrap overflow-hidden text-overflow-ellipsis"},je={class:"flex align-items-center gap-3 m-3"},Ae={style:{height:"85vh !important","overflow-y":"scroll"},class:"p-4 w-full"},ze={__name:"folder",setup(Fe){const O=ce(()=>ve(()=>import("./MailboxMessage-d34c2f23.js"),["assets/MailboxMessage-d34c2f23.js","assets/index-54e8fe55.js","assets/index-d5e7f8f7.css","assets/index-e6303673.js","assets/MailboxMessage-ab1c47ca.css"])),v=c(),x=c(),w=c(),p=c(),k=c(),u=c(),z=le(),U=oe(),M=c();c();const P=se(),S=pe(),{getBaseModule:D}=F(P),{mailFolderLoading:G,getSkipValue:f,getPreviousLink:C,getMailFolder:_,getMailFolderMessages:d}=F(S),{fetchMailFolder:J,fetchMailFolderMessages:H,folderMailMessagesNavigate:T,fetchConversationMessages:Ve}=S,{fetchBaseModuleByField:K}=P,Q={auth:{clientId:"393bd73e-ac09-4f31-a723-f4e981a027ce"}},y=new fe(Q);y.handleRedirectCallback((l,t)=>{});const $=V(()=>Number(f.value)+1),q=V(()=>{const l=Number(f.value)+10;return l>_.value.totalItemCount?_.value.totalItemCount:l}),W=async()=>{v.value="Trying to sign you in";var l={scopes:["user.read","mail.send"]};await y.loginPopup(l).then(t=>{I()}).catch(t=>{x.value=t})},X=async l=>{console.log(l),k.value=l},I=async()=>{if(v.value="Retrieving your messages",y.getAccount()){var l={scopes:["user.read","mail.send"]};await y.acquireTokenSilent(l).then(t=>{u.value=t.accessToken,B(),v.value=null,x.value=null}).catch(t=>{if(t.name==="InteractionRequiredAuthError")return y.acquireTokenPopup(l).then(s=>{u.value=s.accessToken}).catch(s=>{x.value=s})})}},B=async()=>{v.value="Retrieving your messages",await J(u.value,z.params.id),await H(u.value,_.value),p.value=d.value.value,v.value=null},R=()=>{console.log(d.value["@odata.nextLink"]),T(u.value,d.value["@odata.nextLink"])},N=()=>{if(console.log(f.value),f.value){console.log(C.value);let t=C.value.split("24").find(i=>i.toLowerCase().indexOf("skip=")>-1),s=C.value.replace(t,`skip=${f.value-10}`);T(u.value,s)}};return E(()=>w.value,(l,t)=>{if(l){let s=d.value.value.filter(i=>{if(i.subject.toLowerCase().indexOf(l)>-1||i.from.emailAddress.name.toLowerCase().indexOf(l)>-1||i.from.emailAddress.address.toLowerCase().indexOf(l)>-1)return i});p.value=s}else p.value=d.value.value}),E(()=>d.value,(l,t)=>{p.value=l.value,l.value.map((s,i)=>{i===0&&(k.value=s)})}),ne(async()=>{await I(),u.value||await W(),B(),await K({field:"name",value:"inquiries"}),M.value=D.value}),(l,t)=>{const s=g("Button"),i=g("ProgressSpinner"),Y=g("InputText"),j=g("SplitterPanel"),Z=g("Splitter"),ee=g("BlockUI");return x.value?(m(),h("div",me,[e("div",_e,[e("div",null,n(x.value),1),e("div",null,[a(s,{link:""},{default:b(()=>[ie("Refresh page to retry")]),_:1})])])])):v.value?(m(),h("div",ge,[e("div",he,[a(i),e("div",null,n(v.value),1),xe])])):(m(),ae(ee,{key:2,blocked:r(G)},{default:b(()=>[a(Z,null,{default:b(()=>[a(j,{class:"flex",size:5},{default:b(()=>[e("div",ke,[e("div",null,[e("div",ye,[e("div",be,[e("div",we,[Me,e("div",Ce,"("+n(r(_).displayName)+")",1)]),e("div",null,[e("i",{onClick:t[0]||(t[0]=o=>I()),class:"cursor-pointer pi pi-refresh"})])]),e("div",null,[e("div",null,[e("span",Ie,[Le,a(Y,{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=o=>w.value=o),placeholder:"Search",class:"w-full"},null,8,["modelValue"])])])])]),e("div",Pe,[e("div",null,n($.value)+" - "+n(q.value)+" of ("+n(r(_).totalItemCount)+")",1),e("div",null,[a(s,{onClick:t[2]||(t[2]=o=>N()),disabled:r(f)==0,icon:"pi pi-chevron-left",text:"",rounded:""},null,8,["disabled"]),a(s,{onClick:t[3]||(t[3]=o=>R()),disabled:!r(d)["@odata.nextLink"],icon:"pi pi-chevron-right",text:"",rounded:""},null,8,["disabled"])])]),e("div",null,[p.value&&p.value.length>0?(m(!0),h(de,{key:0},re(p.value,(o,A)=>(m(),h("div",{key:A,onClick:te=>X(o),class:L(["p-4 cursor-pointer border-1 border-300 border-x-none white-space-nowrap overflow-hidden text-overflow-ellipsis",`${o.convertedToInquiry&&"bg-primary-50"} ${A!==0&&"border-top-none"} ${o.id===(k.value&&k.value.id)&&"bg-primary-100"}`])},[e("div",Te,[e("div",$e,[e("div",qe,n(o.from.emailAddress.name),1),e("div",{class:L(["text-overflow-ellipsis w-14rem overflow-hidden",`${!o.isRead&&"font-bold"}`])},n(o.subject),3)]),e("div",Be,[e("div",{class:L(["text-xs text-700",`${!o.isRead&&"font-bold"}`])},n(o.receivedDateTime),3),o.convertedToInquiry?(m(),h("div",Re,[a(s,{onClick:te=>r(U).push({name:"modules.pages.detail",params:{name:"inquiries",id:M.value._id,pageid:o.inquiry_id}}),label:"View inquiry",size:"small",outlined:""},null,8,["onClick"])])):ue("",!0)])])],10,Se))),128)):(m(),h("div",Ne," No messages found "))]),e("div",je,[e("div",null,n($.value)+" - "+n(q.value)+" of ("+n(r(_).totalItemCount)+")",1),e("div",null,[a(s,{onClick:t[4]||(t[4]=o=>N()),disabled:r(f)==0,icon:"pi pi-chevron-left",text:"",rounded:""},null,8,["disabled"]),a(s,{onClick:t[5]||(t[5]=o=>R()),disabled:!r(d)["@odata.nextLink"],icon:"pi pi-chevron-right",text:"",rounded:""},null,8,["disabled"])])])])])]),_:1}),a(j,{class:"flex",size:75},{default:b(()=>[e("div",Ae,[a(r(O),{token:u.value,message:k.value,inquiryModuleInfo:M.value},null,8,["token","message","inquiryModuleInfo"])])]),_:1})]),_:1})]),_:1},8,["blocked"]))}}};export{ze as default};
