import{U as ne,r as y,B as re,a4 as ve,s as z,E as ce,G as fe,c as v,o as d,d as b,w as F,g as pe,e as o,t as n,f as i,j as u,F as E,k as R,i as g,m as N,h as me,a1 as G,I as ye,J as be,a2 as w}from"./index-62853e10.js";const _e={class:"relative flex flex-column gap-4 text-600"},ge=o("div",null,"Filter by",-1),xe={class:"text-lg text-800"},ke=["onClick"],we={class:"flex justify-content-between text-lg text-800"},Ve={class:"text-600"},Ce={key:0,class:"font-italic"},he={class:"flex flex-wrap text-xs white-space-nowrap mt-1"},Fe={key:0},Ne={key:0},je={key:1,class:"flex flex-wrap"},Oe={key:1},Me={class:"flex justify-content-between"},Be={class:"filter-by-owner flex flex-column p-3 text-600 gap-3"},Te=o("div",{class:"text-xl text-color-secondary"},"Filter by",-1),Le={class:"flex flex-column gap-3"},Ae={class:"flex align-items-center"},qe=["for"],Ue={class:"flex align-items-center"},$e=["for"],De={class:"flex align-items-center justify-content-end"},Ie={class:"filter-by-owner flex flex-column text-600 gap-3 overflow-y-scroll overflow-x-hidden h-full"},Se={style:{"z-index":"99 !important"},class:"sticky top-0 p-3 surface-0 border-bottom-1 border-200"},Pe={class:"text-xl font-bold text-color-secondary"},ze={class:"flex flex-column gap-3 p-3 mb-8"},Ee={key:0},Re={for:"isBool",class:"ml-2"},Ge={key:2},Je=o("label",{for:"isNull",class:"ml-2"}," Is Null ",-1),Ye={class:"absolute bottom-0 w-full p-3 surface-0 border-top-1 border-200"},He={class:"flex justify-content-end gap-2"},Ke={class:"sticky top-0"},We={__name:"ListViewFilterContent",props:{baseModule:Object,module:Object},emits:["apply-filters"],setup(r,{emit:J}){const Y=ye(()=>be(()=>import("./LookupField-b3e2b969.js"),["assets/LookupField-b3e2b969.js","assets/index-62853e10.js","assets/index-40ff91a8.css","assets/LookupField-25914620.css"])),c=r,H=J,L=ne(),j=y(!1),O=y(!1),f=y(!1),A=y(!1),x=y(!1),p=y(!1),k=y(c.module.viewFilters.find(t=>t.isDefault)),e=y({queryType:null,mode:"edit",queryType:k.value.queryType,filters:k.value.filters,data:{mode:"new",uuid:null,field:null,operator:null,value:null,isNull:!1},default:{uuid:null,field:null,operator:null,value:null,isNull:!1}}),q=re(),U=ve(),{_getFieldDetailsById:M}=z(q),{addViewFilter:B}=q,{getPicklist:m}=z(U),{fetchPicklist:K}=U,Q=(t,l)=>{L.require({message:"Are you sure you want to proceed?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined",rejectLabel:"Cancel",acceptLabel:"Proceed",accept:()=>{$([l.uuid])},reject:()=>{console.log("Cancel deletion")}})},W=()=>{L.require({message:"You are about to remove all filters.",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined",rejectLabel:"Cancel",acceptLabel:"Proceed",accept:async()=>{const t=k.value.filters.map(l=>l.uuid);await $(t)},reject:()=>{console.log("Cancel remove all")}})},$=async t=>{j.value=!0;const l=Object.assign({},{mode:"delete",baseModule:c.baseModule,viewFilter:k.value._id,type:"filters",data:{mode:"delete",queryType:e.value.queryType,filters:t}});let _=(await B(l)).data,V=e.value.filters.filter(C=>!_.includes(C.uuid));e.value.filters=V,p.value=!1,j.value=!1},X=()=>{e.value.data=Object.assign({},e.value.default),e.value.data.mode="new",x.value=!1,p.value=!0},Z=(t,l)=>{let s=M.value({fields:c.module.fields,_id:t.field._id}),_=M.value({fields:m.value&&m.value.filter_operators.values,_id:t.operator._id});Object.assign(e.value.data,{uuid:t.uuid,field:s,operator:_,value:s.field_type.name=="picklist"&&w.isArray(t.values)?w.map(t.values,"_id"):t.values,isNull:t.isNull}),e.value.data.mode="edit",x.value=!1,p.value=!0},D=async()=>{f.value=!0;let t=Object.assign({},{uuid:e.value.data.uuid,field_id:e.value.data.field._id,operator_id:e.value.data.operator._id,values:w.isArray(e.value.data.value)&&w.has(e.value.data.value,"0._id")?w.map(e.value.data.value,"_id"):e.value.data.value,isNull:e.value.data.isNull});const l=Object.assign({},{mode:e.value.mode,baseModule:c.baseModule,viewFilter:c.module.viewFilters.find(_=>_.isDefault)._id,type:"filters",data:{mode:e.value.data.mode,queryType:e.value.queryType,filters:t}}),s=await B(l);s&&s.status===200&&(l.data.mode==="new"?ee(s.data.filters[0]):l.data.mode==="edit"&&le(s.data.filters[0]))},ee=t=>{console.log(t),e.value.filters instanceof Array||(e.value.filters=[]),e.value.filters.push(t),console.log(e.value.filters),p.value=!p.value,f.value=!1},le=t=>{e.value.filters.map(l=>{l.uuid===t.uuid&&Object.assign(l,t)}),f.value=!1},ae=()=>{x.value=!0,p.value=!1},T=async t=>{await K(t)},te=t=>{e.value.data.value=null},oe=async()=>{O.value=!0;const t=Object.assign({},{mode:e.value.mode,baseModule:c.baseModule,viewFilter:c.module.viewFilters.find(s=>s.isDefault)._id,type:"filters",data:{queryType:e.value.queryType}}),l=await B(t);l&&l.status===200&&H("apply-filters",k.value),O.value=!1};return ce(async()=>{Object.keys(m.value).length===0&&(A.value=!0,T("filter_operators"),A.value=!1),e.value.filters instanceof Array&&e.value.filters.length>0&&e.value.filters.map(t=>{const l=M.value({fields:c.module.fields,_id:t.field._id});T(l.listName)})}),fe(()=>e.value,(t,l)=>{t.data.field&&t.data.field.field_type.name==="picklist"&&T(t.data.field.listName)},{deep:!0}),(t,l)=>{const s=v("Button"),_=v("BlockUI"),V=v("RadioButton"),C=v("Dropdown"),I=v("Checkbox"),de=v("Calendar"),se=v("MultiSelect"),ie=v("inputText"),ue=v("Card");return d(),b(ue,{style:{overflow:"hidden"},class:""},{title:F(()=>[pe("Filters")]),content:F(()=>[o("div",null,[o("div",_e,[o("div",{onClick:ae,class:"flex flex-column gap-2 p-3 border-1 border-400 hover:border-600 hover:surface-100 border-round-md cursor-pointer"},[ge,o("div",xe,n(e.value.queryType),1)]),i(_,{blocked:j.value},{default:F(()=>[e.value.filters instanceof Array&&e.value.filters.length>=1?(d(!0),u(E,{key:0},R(e.value.filters,(a,S)=>(d(),u("div",{onClick:h=>Z(a,S),key:S,class:"flex flex-column gap-2 p-3 border-1 border-400 hover:border-600 bg-orange-100 hover:bg-orange-200 border-round-md cursor-pointer my-2"},[o("div",we,[o("div",null,[o("div",Ve,n(a.field.label),1),g(m).filter_operators?(d(),u("div",Ce,n(a.operator.label),1)):N("",!0),o("div",he,[Array.isArray(a.values)?(d(),u("div",Fe,[a.isNull?(d(),u("div",Ne," Null ")):(d(),u("div",je,[(d(!0),u(E,null,R(a.values,(h,P)=>(d(),u("div",{key:P},n(h.label)+n(a.values.length-1!==P?",Â ":""),1))),128))]))])):(d(),u("div",Oe,n(a.isNull?"Null":a.values),1))])]),o("div",null,[i(s,{onClick:me(h=>Q(h,a),["stop"]),icon:"pi pi-trash",severity:"danger",text:"",rounded:""},null,8,["onClick"])])])],8,ke))),128)):N("",!0)]),_:1},8,["blocked"]),o("div",Me,[o("a",{onClick:l[0]||(l[0]=a=>X()),href:"javascript:void(0);"},"add filter"),o("a",{onClick:l[1]||(l[1]=a=>W()),href:"javascript:void(0);"},"remove all")])])]),(d(),b(G,{to:`${x.value?".ddt-div-1":".hidden-div"}`},[o("div",Be,[Te,o("div",Le,[o("div",Ae,[i(V,{modelValue:e.value.queryType,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.queryType=a),inputId:`All ${r.baseModule.name}`,value:"all"},null,8,["modelValue","inputId"]),o("label",{for:`All ${r.baseModule.name}`,class:"ml-2"},"All "+n(r.baseModule.name),9,qe)]),o("div",Ue,[i(V,{modelValue:e.value.queryType,"onUpdate:modelValue":l[3]||(l[3]=a=>e.value.queryType=a),inputId:`My ${r.baseModule.name}`,value:"owned"},null,8,["modelValue","inputId"]),o("label",{for:`My ${r.baseModule.name}`,class:"ml-2"},"My "+n(r.baseModule.name),9,$e)]),o("div",De,[i(s,{onClick:l[4]||(l[4]=a=>x.value=!1),label:"DONE",outlined:"",size:"large"})])])])],8,["to"])),(d(),b(G,{to:`${p.value?".ddt-div-1":".hidden-div"}`},[o("div",Ie,[o("div",Se,[o("div",Pe,n(e.value.data.mode=="new"?"Add filter":"Edit filter"),1)]),o("div",ze,[i(C,{modelValue:e.value.data.field,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.data.field=a),onChange:l[6]||(l[6]=a=>te(a)),options:r.module.fields,optionLabel:"label",placeholder:"Select a field",class:"w-full",filter:""},null,8,["modelValue","options"]),i(C,{modelValue:e.value.data.operator,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.data.operator=a),options:g(m).filter_operators&&g(m).filter_operators.values,optionLabel:"label",placeholder:"Select an operator",class:"w-full"},null,8,["modelValue","options"]),e.value.data.field&&e.value.data.field.field_type.name==="boolean"?(d(),u("div",Ee,[i(I,{modelValue:e.value.data.value,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.data.value=a),binary:"",variant:"filled",inputId:"isBool",disabled:e.value.data.isNull},null,8,["modelValue","disabled"]),o("label",Re,n(e.value.data.value instanceof Array?e.value.data.value[0]:e.value.data.value),1)])):e.value.data.field&&e.value.data.field.field_type.name==="date"?(d(),b(de,{key:1,modelValue:e.value.data.value,"onUpdate:modelValue":l[9]||(l[9]=a=>e.value.data.value=a),disabled:e.value.data.isNull},null,8,["modelValue","disabled"])):N("",!0),e.value.data.field&&e.value.data.field.field_type.name==="lookupModel"?(d(),u("div",Ge,[i(g(Y),{modelValue:e.value.data.value,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.data.value=a),field:e.value.data.field,keyName:"",formField:!1,inline:!0,module:r.module.name,optionValue:"_id",onLoad:!0,entity:e.value.data.field.entity.name},null,8,["modelValue","field","module","entity"])])):e.value.data.field&&e.value.data.field.field_type.name==="picklist"?(d(),b(se,{key:3,modelValue:e.value.data.value,"onUpdate:modelValue":l[11]||(l[11]=a=>e.value.data.value=a),options:g(m)[e.value.data.field.listName]&&g(m)[e.value.data.field.listName].values,optionLabel:"value",optionValue:"_id",placeholder:"Select",maxSelectedLabels:3,disabled:e.value.data.isNull,class:"w-full"},null,8,["modelValue","options","disabled"])):e.value.data.field&&e.value.data.field.field_type.name==="text"?(d(),b(ie,{key:4,modelValue:e.value.data.value,"onUpdate:modelValue":l[12]||(l[12]=a=>e.value.data.value=a),disabled:e.value.data.isNull},null,8,["modelValue","disabled"])):N("",!0),o("div",null,[i(I,{modelValue:e.value.data.isNull,"onUpdate:modelValue":l[13]||(l[13]=a=>e.value.data.isNull=a),binary:"",variant:"filled",inputId:"isNull"},null,8,["modelValue"]),Je])]),o("div",Ye,[o("div",null,[o("div",He,[i(s,{onClick:l[14]||(l[14]=a=>p.value=!1),disabled:f.value,outlined:"",label:"Cancel",severity:"secondary",size:"small"},null,8,["disabled"]),e.value.data.mode==="new"?(d(),b(s,{key:0,onClick:l[15]||(l[15]=a=>D()),disabled:!e.value.data.field||!e.value.data.operator||f.value,loading:f.value,outlined:"",label:"Done",size:"small"},null,8,["disabled","loading"])):(d(),b(s,{key:1,onClick:l[16]||(l[16]=a=>D()),disabled:!e.value.data.field||!e.value.data.operator||f.value,loading:f.value,outlined:"",label:"Update",size:"small"},null,8,["disabled","loading"]))])])])])],8,["to"]))]),footer:F(()=>[o("div",Ke,[i(s,{onClick:l[17]||(l[17]=a=>oe()),loading:O.value,label:"Apply filter",size:"small"},null,8,["loading"])])]),_:1})}}};export{We as default};
